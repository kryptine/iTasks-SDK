function printf(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=e.replace("%"+(t-1),arguments[t]);return e}function init(){Ext.BLANK_IMAGE_URL=ORYX.BASE_FILE_PATH+"lib/ext-2.0.2/resources/images/default/s.gif",ORYX.Log.debug("Querying editor instances"),ORYX.Editor.setMissingClasses()}function assert(e,t){if(!e)throw t}function DMCommand(e,t){this.action=e,this.triple=t,this.toString=function(){return"Command("+e+", "+t+")"}}function DMCommandHandler(e){this.__setNext=function(){var t=this.__next;return this.__next=e,t?t:!0},this.__setNext(e),this.__invokeNext=function(e){return this.__next?this.__next.handle(e):!1},this.handle=function(e){return this.process(e)?!0:this.__invokeNext(e)},this.process=function(){return!1}}function MetaTagHandler(next){DMCommandHandler.apply(this,[next]),this.process=function(command){with(command.triple)if(!(subject instanceof ERDF.Resource&&subject.isCurrentDocument()&&object instanceof ERDF.Literal))return!1}}function _evenMoreEvilHack(e,t){if(window.ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.loadXML(e),i}if(window.XMLHttpRequest){var n=new XMLHttpRequest;return n.open("GET","data:"+(t||"application/xml")+";charset=utf-8,"+encodeURIComponent(e),!1),n.overrideMimeType&&n.overrideMimeType(t),n.send(null),n.responseXML}}function _evilSafariHack(e){var t=e,i="data:text/xml;charset=utf-8,"+encodeURIComponent(t),n=null,s=new XMLHttpRequest;return s.open("GET",i),s.onload=function(){n=s.responseXML},s.send(null),n}function jsonPath(obj,expr,arg){var P={resultType:arg&&arg.resultType||"VALUE",result:[],normalize:function(e){var t=[];return e.replace(/[\['](\??\(.*?\))[\]']/g,function(e,i){return"[#"+(t.push(i)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(e,i){return t[i]})},asPath:function(e){for(var t=e.split(";"),i="$",n=1,s=t.length;s>n;n++)i+=/^[0-9*]+$/.test(t[n])?"["+t[n]+"]":"['"+t[n]+"']";return i},store:function(e,t){return e&&(P.result[P.result.length]="PATH"==P.resultType?P.asPath(e):t),!!e},trace:function(e,t,i){if(e){var n=e.split(";"),s=n.shift();if(n=n.join(";"),t&&t.hasOwnProperty(s))P.trace(n,t[s],i+";"+s);else if("*"===s)P.walk(s,n,t,i,function(e,t,i,n,s){P.trace(e+";"+i,n,s)});else if(".."===s)P.trace(n,t,i),P.walk(s,n,t,i,function(e,t,i,n,s){"object"==typeof n[e]&&P.trace("..;"+i,n[e],s+";"+e)});else if(/,/.test(s))for(var r=s.split(/'?,'?/),o=0,a=r.length;a>o;o++)P.trace(r[o]+";"+n,t,i);else/^\(.*?\)$/.test(s)?P.trace(P.eval(s,t,i.substr(i.lastIndexOf(";")+1))+";"+n,t,i):/^\?\(.*?\)$/.test(s)?P.walk(s,n,t,i,function(e,t,i,n,s){P.eval(t.replace(/^\?\((.*?)\)$/,"$1"),n[e],e)&&P.trace(e+";"+i,n,s)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(s)&&P.slice(s,n,t,i)}else P.store(i,t)},walk:function(e,t,i,n,s){if(i instanceof Array)for(var r=0,o=i.length;o>r;r++)r in i&&s(r,e,t,i,n);else if("object"==typeof i)for(var a in i)i.hasOwnProperty(a)&&s(a,e,t,i,n)},slice:function(e,t,i,n){if(i instanceof Array){var s=i.length,r=0,o=s,a=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,i,n){r=parseInt(t||r),o=parseInt(i||o),a=parseInt(n||a)}),r=0>r?Math.max(0,r+s):Math.min(s,r),o=0>o?Math.max(0,o+s):Math.min(s,o);for(var h=r;o>h;h+=a)P.trace(h+";"+t,i,n)}},eval:function(x,_v,_vname){try{return $&&_v&&eval(x.replace(/@/g,"_v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"_v").replace(/\^/g,"_a"))}}},$=obj;return expr&&obj&&("VALUE"==P.resultType||"PATH"==P.resultType)?(P.trace(P.normalize(expr).replace(/^\$;/,""),obj,"$"),P.result.length?P.result:!1):void 0}XMLNS={ATOM:"http://www.w3.org/2005/Atom",XHTML:"http://www.w3.org/1999/xhtml",ERDF:"http://purl.org/NET/erdf/profile",RDFS:"http://www.w3.org/2000/01/rdf-schema#",RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RAZIEL:"http://b3mn.org/Raziel",SCHEMA:""};var Kickstart={started:!1,callbacks:[],alreadyLoaded:[],PATH:"",load:function(){Kickstart.kick()},kick:function(){Kickstart.started||(Kickstart.started=!0,Kickstart.callbacks.each(function(e){window.setTimeout(e,1)}))},register:function(callback){with(Kickstart)started?window.setTimeout(callback,1):Kickstart.callbacks.push(callback)},require:function(e){return Kickstart.alreadyLoaded.member(e)?!1:Kickstart.include(e)},include:function(e){var t=document.getElementsByTagNameNS(XMLNS.XHTML,"head")[0],i=document.createElementNS(XMLNS.XHTML,"script");return i.setAttributeNS(XMLNS.XHTML,"type","text/javascript"),i.src=Kickstart.PATH+e,t.appendChild(i),Kickstart.alreadyLoaded.push(e),!0}};if(!ORYX)var ORYX={};ORYX.CONFIG||(ORYX.CONFIG={}),ORYX.CONFIG.WEB_URL="org.jbpm.designer.jBPMDesigner",ORYX.CONFIG.MENU_INDEX={File:1,Edit:2,"Z-Order":3,Undo:4,Docker:5,Help:"ZZZZZZ"},ORYX.CONFIG.UUID_URL=function(e,t){return void 0===e&&(e=ORYX.UUID),void 0===t&&(t=ORYX.PROFILE),ORYX.PATH+"uuidRepository?uuid="+e+"&profile="+t+"&pp="+ORYX.PREPROCESSING},ORYX.CONFIG.TRANSFORMER_URL=function(e,t){return void 0===e&&(e=ORYX.UUID),void 0===t&&(t=ORYX.PROFILE),ORYX.PATH+"transformer?uuid="+e+"&profile="+t},ORYX.CONFIG.TASKFORMS_URL=function(e,t){return void 0===e&&(e=ORYX.UUID),void 0===t&&(t=ORYX.PROFILE),ORYX.PATH+"taskforms?uuid="+e+"&profile="+t},ORYX.CONFIG.UUID_AUTOSAVE_INTERVAL=12e4,ORYX.CONFIG.UUID_AUTOSAVE_DEFAULT=!1,ORYX.CONFIG.VERSION_URL=ORYX.CONFIG.ROOT_PATH+"VERSION",ORYX.CONFIG.LICENSE_URL=ORYX.CONFIG.ROOT_PATH+"LICENSE",ORYX.CONFIG.SERVER_HANDLER_ROOT="",ORYX.CONFIG.STENCILSET_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"",ORYX.CONFIG.MODE_READONLY="readonly",ORYX.CONFIG.MODE_FULLSCREEN="fullscreen",ORYX.CONFIG.SHOW_GRIDLINE=!0,ORYX.CONFIG.DISABLE_GRADIENT=!1,ORYX.CONFIG.PLUGINS_ENABLED=!0,ORYX.CONFIG.PLUGINS_CONFIG=ORYX.CONFIG.ROOT_PATH+"plugins",ORYX.CONFIG.PROFILE_PATH=ORYX.CONFIG.ROOT_PATH+"profiles/",ORYX.CONFIG.PLUGINS_FOLDER="Plugins/",ORYX.CONFIG.PDF_EXPORT_URL=ORYX.CONFIG.ROOT_PATH+"pdf",ORYX.CONFIG.PNML_EXPORT_URL=ORYX.CONFIG.ROOT_PATH+"pnml",ORYX.CONFIG.SIMPLE_PNML_EXPORT_URL=ORYX.CONFIG.ROOT_PATH+"simplepnmlexporter",ORYX.CONFIG.DESYNCHRONIZABILITY_URL=ORYX.CONFIG.ROOT_PATH+"desynchronizability",ORYX.CONFIG.IBPMN2BPMN_URL=ORYX.CONFIG.ROOT_PATH+"ibpmn2bpmn",ORYX.CONFIG.BPMN2YAWL_URL=ORYX.CONFIG.ROOT_PATH+"bpmn2yawl",ORYX.CONFIG.QUERYEVAL_URL=ORYX.CONFIG.ROOT_PATH+"query",ORYX.CONFIG.SYNTAXCHECKER_URL=ORYX.CONFIG.ROOT_PATH+"syntaxchecker",ORYX.CONFIG.VALIDATOR_URL=ORYX.CONFIG.ROOT_PATH+"validator",ORYX.CONFIG.AUTO_LAYOUTER_URL=ORYX.CONFIG.ROOT_PATH+"layouter",ORYX.CONFIG.SS_EXTENSIONS_FOLDER=ORYX.CONFIG.ROOT_PATH+"stencilsets/extensions/",ORYX.CONFIG.SS_EXTENSIONS_CONFIG=ORYX.CONFIG.ROOT_PATH+"stencilsets/extensions/extensions.json",ORYX.CONFIG.ORYX_NEW_URL="/new",ORYX.CONFIG.STEP_THROUGH=ORYX.CONFIG.ROOT_PATH+"stepthrough",ORYX.CONFIG.STEP_THROUGH_CHECKER=ORYX.CONFIG.ROOT_PATH+"stepthroughchecker",ORYX.CONFIG.XFORMS_EXPORT_URL=ORYX.CONFIG.ROOT_PATH+"xformsexport",ORYX.CONFIG.XFORMS_EXPORT_ORBEON_URL=ORYX.CONFIG.ROOT_PATH+"xformsexport-orbeon",ORYX.CONFIG.XFORMS_IMPORT_URL=ORYX.CONFIG.ROOT_PATH+"xformsimport",ORYX.CONFIG.BPEL_EXPORT_URL=ORYX.CONFIG.ROOT_PATH+"bpelexporter",ORYX.CONFIG.BPEL4CHOR_EXPORT_URL=ORYX.CONFIG.ROOT_PATH+"bpel4chorexporter",ORYX.CONFIG.BPEL4CHOR2BPEL_EXPORT_URL=ORYX.CONFIG.ROOT_PATH+"bpel4chor2bpelexporter",ORYX.CONFIG.TREEGRAPH_SUPPORT=ORYX.CONFIG.ROOT_PATH+"treegraphsupport",ORYX.CONFIG.XPDL4CHOR2BPEL4CHOR_TRANSFORMATION_URL=ORYX.CONFIG.ROOT_PATH+"xpdl4chor2bpel4chor",ORYX.CONFIG.RESOURCE_LIST=ORYX.CONFIG.ROOT_PATH+"resourceList",ORYX.CONFIG.BPMN_LAYOUTER=ORYX.CONFIG.ROOT_PATH+"bpmnlayouter",ORYX.CONFIG.EPC_LAYOUTER=ORYX.CONFIG.ROOT_PATH+"epclayouter",ORYX.CONFIG.BPMN2MIGRATION=ORYX.CONFIG.ROOT_PATH+"bpmn2migration",ORYX.CONFIG.BPMN20_SCHEMA_VALIDATION_ON=!0,ORYX.CONFIG.JPDLIMPORTURL=ORYX.CONFIG.ROOT_PATH+"jpdlimporter",ORYX.CONFIG.JPDLEXPORTURL=ORYX.CONFIG.ROOT_PATH+"jpdlexporter",ORYX.CONFIG.CPNTOOLSEXPORTER=ORYX.CONFIG.ROOT_PATH+"cpntoolsexporter",ORYX.CONFIG.CPNTOOLSIMPORTER=ORYX.CONFIG.ROOT_PATH+"cpntoolsimporter",ORYX.CONFIG.BPMN2XPDLPATH=ORYX.CONFIG.ROOT_PATH+"bpmn2xpdl",ORYX.CONFIG.TBPMIMPORT=ORYX.CONFIG.ROOT_PATH+"tbpmimport",ORYX.CONFIG.NAMESPACE_ORYX="http://www.b3mn.org/oryx",ORYX.CONFIG.NAMESPACE_SVG="http://www.w3.org/2000/svg",ORYX.CONFIG.CANVAS_WIDTH=3e3,ORYX.CONFIG.CANVAS_HEIGHT=2e3,ORYX.CONFIG.CANVAS_RESIZE_INTERVAL=300,ORYX.CONFIG.SELECTED_AREA_PADDING=4,ORYX.CONFIG.CANVAS_BACKGROUND_COLOR="none",ORYX.CONFIG.GRID_DISTANCE=30,ORYX.CONFIG.GRID_ENABLED=!0,ORYX.CONFIG.ZOOM_OFFSET=.1,ORYX.CONFIG.DEFAULT_SHAPE_MARGIN=60,ORYX.CONFIG.SCALERS_SIZE=7,ORYX.CONFIG.MINIMUM_SIZE=20,ORYX.CONFIG.MAXIMUM_SIZE=1e4,ORYX.CONFIG.OFFSET_MAGNET=15,ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP=14,ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM=12,ORYX.CONFIG.OFFSET_EDGE_BOUNDS=5,ORYX.CONFIG.COPY_MOVE_OFFSET=30,ORYX.CONFIG.SHOW_GRIDLINE=!0,ORYX.CONFIG.BORDER_OFFSET=14,ORYX.CONFIG.MAX_NUM_SHAPES_NO_GROUP=14,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER=30,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET=45,ORYX.CONFIG.SHAPEMENU_RIGHT="Oryx_Right",ORYX.CONFIG.SHAPEMENU_BOTTOM="Oryx_Bottom",ORYX.CONFIG.SHAPEMENU_LEFT="Oryx_Left",ORYX.CONFIG.SHAPEMENU_TOP="Oryx_Top",ORYX.CONFIG.MORPHITEM_DISABLED="Oryx_MorphItem_disabled",ORYX.CONFIG.TYPE_STRING="string",ORYX.CONFIG.TYPE_BOOLEAN="boolean",ORYX.CONFIG.TYPE_INTEGER="integer",ORYX.CONFIG.TYPE_FLOAT="float",ORYX.CONFIG.TYPE_COLOR="color",ORYX.CONFIG.TYPE_DATE="date",ORYX.CONFIG.TYPE_CHOICE="choice",ORYX.CONFIG.TYPE_DYNAMICCHOICE="dynamicchoice",ORYX.CONFIG.TYPE_DYNAMICDATAINPUT="dynamicdatainput",ORYX.CONFIG.TYPE_DYNAMICDATAOUTPUT="dynamicdatoutput",ORYX.CONFIG.TYPE_DYNAMICGATEWAYCONNECTIONS="dynamicgatewayconnections",ORYX.CONFIG.TYPE_URL="url",ORYX.CONFIG.TYPE_DIAGRAM_LINK="diagramlink",ORYX.CONFIG.TYPE_COMPLEX="complex",ORYX.CONFIG.TYPE_TEXT="text",ORYX.CONFIG.TYPE_VARDEF="vardef",ORYX.CONFIG.TYPE_EXPRESSION="expression",ORYX.CONFIG.TYPE_ACTION="action",ORYX.CONFIG.TYPE_GLOBAL="global",ORYX.CONFIG.TYPE_IMPORT="import",ORYX.CONFIG.TYPE_DATAINPUT="datainput",ORYX.CONFIG.TYPE_DATAOUTPUT="dataoutput",ORYX.CONFIG.TYPE_DATAINPUT_SINGLE="datainputsingle",ORYX.CONFIG.TYPE_DATAOUTPUT_SINGLE="dataoutputsingle",ORYX.CONFIG.TYPE_DATAASSIGNMENT="dataassignment",ORYX.CONFIG.TYPE_VISUALDATAASSIGNMENTS="visualdataassignment",ORYX.CONFIG.TYPE_CALLEDELEMENT="calledelement",ORYX.CONFIG.TYPE_CUSTOM="custom",ORYX.CONFIG.TYPE_REASSIGNMENT="reassignment",ORYX.CONFIG.TYPE_NOTIFICATIONS="notifications",ORYX.CONFIG.LABEL_LINE_DISTANCE=2,ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT=12,ORYX.CONFIG.ENABLE_MORPHMENU_BY_HOVER=!0,ORYX.CONFIG.EDITOR_ALIGN_BOTTOM=1,ORYX.CONFIG.EDITOR_ALIGN_MIDDLE=2,ORYX.CONFIG.EDITOR_ALIGN_TOP=4,ORYX.CONFIG.EDITOR_ALIGN_LEFT=8,ORYX.CONFIG.EDITOR_ALIGN_CENTER=16,ORYX.CONFIG.EDITOR_ALIGN_RIGHT=32,ORYX.CONFIG.EDITOR_ALIGN_SIZE=48,ORYX.CONFIG.EVENT_MOUSEDOWN="mousedown",ORYX.CONFIG.EVENT_MOUSEUP="mouseup",ORYX.CONFIG.EVENT_MOUSEOVER="mouseover",ORYX.CONFIG.EVENT_MOUSEOUT="mouseout",ORYX.CONFIG.EVENT_MOUSEMOVE="mousemove",ORYX.CONFIG.EVENT_DBLCLICK="dblclick",ORYX.CONFIG.EVENT_CLICK="click",ORYX.CONFIG.EVENT_KEYDOWN="keydown",ORYX.CONFIG.EVENT_KEYUP="keyup",ORYX.CONFIG.EVENT_LOADED="editorloaded",ORYX.CONFIG.EVENT_EXECUTE_COMMANDS="executeCommands",ORYX.CONFIG.EVENT_STENCIL_SET_LOADED="stencilSetLoaded",ORYX.CONFIG.EVENT_SELECTION_CHANGED="selectionchanged",ORYX.CONFIG.EVENT_SHAPEADDED="shapeadded",ORYX.CONFIG.EVENT_PROPERTY_CHANGED="propertyChanged",ORYX.CONFIG.EVENT_DRAGDROP_START="dragdrop.start",ORYX.CONFIG.EVENT_SHAPE_MENU_CLOSE="shape.menu.close",ORYX.CONFIG.EVENT_DRAGDROP_END="dragdrop.end",ORYX.CONFIG.EVENT_RESIZE_START="resize.start",ORYX.CONFIG.EVENT_RESIZE_END="resize.end",ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED="dragDocker.docked",ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW="highlight.showHighlight",ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE="highlight.hideHighlight",ORYX.CONFIG.EVENT_LOADING_ENABLE="loading.enable",ORYX.CONFIG.EVENT_LOADING_DISABLE="loading.disable",ORYX.CONFIG.EVENT_LOADING_STATUS="loading.status",ORYX.CONFIG.EVENT_OVERLAY_SHOW="overlay.show",ORYX.CONFIG.EVENT_OVERLAY_HIDE="overlay.hide",ORYX.CONFIG.EVENT_DICTIONARY_ADD="dictionary.add",ORYX.CONFIG.EVENT_TASKFORM_EDIT="taskform.edit",ORYX.CONFIG.EVENT_ARRANGEMENT_TOP="arrangement.setToTop",ORYX.CONFIG.EVENT_ARRANGEMENT_BACK="arrangement.setToBack",ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD="arrangement.setForward",ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD="arrangement.setBackward",ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED="propertyWindow.propertyChanged",ORYX.CONFIG.EVENT_LAYOUT_ROWS="layout.rows",ORYX.CONFIG.EVENT_LAYOUT_BPEL="layout.BPEL",ORYX.CONFIG.EVENT_LAYOUT_BPEL_VERTICAL="layout.BPEL.vertical",ORYX.CONFIG.EVENT_LAYOUT_BPEL_HORIZONTAL="layout.BPEL.horizontal",ORYX.CONFIG.EVENT_LAYOUT_BPEL_SINGLECHILD="layout.BPEL.singlechild",ORYX.CONFIG.EVENT_LAYOUT_BPEL_AUTORESIZE="layout.BPEL.autoresize",ORYX.CONFIG.EVENT_AUTOLAYOUT_LAYOUT="autolayout.layout",ORYX.CONFIG.EVENT_UNDO_EXECUTE="undo.execute",ORYX.CONFIG.EVENT_UNDO_ROLLBACK="undo.rollback",ORYX.CONFIG.EVENT_BUTTON_UPDATE="toolbar.button.update",ORYX.CONFIG.EVENT_LAYOUT="layout.dolayout",ORYX.CONFIG.EVENT_COLOR_CHANGE="color.change",ORYX.CONFIG.EVENT_DOCKERDRAG="dragTheDocker",ORYX.CONFIG.EVENT_SHOW_PROPERTYWINDOW="propertywindow.show",ORYX.CONFIG.EVENT_DRAG_TRACKER_DRAG="dragTracker.drag",ORYX.CONFIG.EVENT_DRAG_TRACKER_RESIZE="dragTracker.resize",ORYX.CONFIG.EVENT_DROP_SHAPE="drop.shape",ORYX.CONFIG.EVENT_SHAPE_DELETED="shape.deleted",ORYX.CONFIG.EVENT_FACADE_SELECTION_DELETION_REQUEST="facade_selection.deletion.request",ORYX.CONFIG.EVENT_NODEXML_SHOW="nodexml.show",ORYX.CONFIG.EVENT_VOICE_COMMAND="voice.command",ORYX.CONFIG.EVENT_SIMULATION_SHOW_RESULTS="simulation.showresults",ORYX.CONFIG.EVENT_SIMULATION_DISPLAY_GRAPH="simulation.displaygraph",ORYX.CONFIG.EVENT_SIMULATION_BUILD_PATH_SVG="simulation.buildpathsvg",ORYX.CONFIG.EVENT_SIMULATION_CLEAR_PATH_SVG="simulation.clearpathsvg",ORYX.CONFIG.EVENT_SIMULATION_PATH_SVG_GENERATED="simulation.pathsvggenerated",ORYX.CONFIG.EVENT_SIMULATION_ANNOTATE_PROCESS="simulation.annotateprocess",ORYX.CONFIG.EVENT_SIMULATION_SHOW_ANNOTATED_PROCESS="simulation.showannotatedprocess",ORYX.CONFIG.EVENT_NOTIFICATION_SHOW="notification.show",ORYX.CONFIG.VOICE_COMMAND_GENERATE_FORMS="voice.command.generate.forms",ORYX.CONFIG.VOICE_COMMAND_VALIDATE="voice.command.validate",ORYX.CONFIG.VOICE_COMMAND_GENERATE_IMAGE="voice.command.generate.image",ORYX.CONFIG.VOICE_COMMAND_VIEW_SOURCE="voice.command.view.source",ORYX.CONFIG.VOICE_COMMAND_ADD_TASK="voice.command.add.task",ORYX.CONFIG.VOICE_COMMAND_ADD_GATEWAY="voice.command.add.gateway",ORYX.CONFIG.VOICE_COMMAND_ADD_START_EVENT="voice.command.add.start.event",ORYX.CONFIG.VOICE_COMMAND_ADD_END_EVENT="voice.command.add.end.event",ORYX.CONFIG.VOICE_COMMAND_TASK_TYPE_USER="voice.command.task.type.user",ORYX.CONFIG.VOICE_COMMAND_TASK_TYPE_SCRIPT="voice.command.task.type.script",ORYX.CONFIG.VOICE_COMMAND_GATEWAY_TYPE_PARALLEL="voice.command.gateway.type.parallel",ORYX.CONFIG.VOICE_ENTRY_GENERATE_FORMS="create forms",ORYX.CONFIG.VOICE_ENTRY_VALIDATE="validate",ORYX.CONFIG.VOICE_ENTRY_GENERATE_IMAGE="create image",ORYX.CONFIG.VOICE_ENTRY_VIEW_SOURCE="show bpmn",ORYX.CONFIG.VOICE_ENTRY_ADD_TASK="task,test,text,that,map,10,chat,pet",ORYX.CONFIG.VOICE_ENTRY_ADD_GATEWAY="gateway",ORYX.CONFIG.VOICE_ENTRY_ADD_START_EVENT="start,bart,dark",ORYX.CONFIG.VOICE_ENTRY_ADD_END_EVENT="end,and",ORYX.CONFIG.VOICE_ENTRY_TASK_TYPE_USER="user,used",ORYX.CONFIG.VOICE_ENTRY_TASK_TYPE_SCRIPT="script,strip,red",ORYX.CONFIG.VOICE_ENTRY_GATEWAY_TYPE_PARALLEL="parallel",ORYX.CONFIG.CREATE_PATTERN="create.pattern",ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE=5,ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR="#4444FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR2="#9999FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_CORNER="corner",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE="rectangle",ORYX.CONFIG.SELECTION_VALID_COLOR="#00FF00",ORYX.CONFIG.SELECTION_INVALID_COLOR="#FF0000",ORYX.CONFIG.DOCKER_DOCKED_COLOR="#00FF00",ORYX.CONFIG.DOCKER_UNDOCKED_COLOR="#FF0000",ORYX.CONFIG.DOCKER_SNAP_OFFSET=10,ORYX.CONFIG.EDIT_OFFSET_PASTE=10,ORYX.CONFIG.KEY_CODE_X=88,ORYX.CONFIG.KEY_CODE_C=67,ORYX.CONFIG.KEY_CODE_V=86,ORYX.CONFIG.KEY_CODE_DELETE=46,ORYX.CONFIG.KEY_CODE_META=224,ORYX.CONFIG.KEY_CODE_BACKSPACE=8,ORYX.CONFIG.KEY_CODE_LEFT=37,ORYX.CONFIG.KEY_CODE_RIGHT=39,ORYX.CONFIG.KEY_CODE_UP=38,ORYX.CONFIG.KEY_CODE_DOWN=40,ORYX.CONFIG.KEY_Code_enter=12,ORYX.CONFIG.KEY_Code_left=37,ORYX.CONFIG.KEY_Code_right=39,ORYX.CONFIG.KEY_Code_top=38,ORYX.CONFIG.KEY_Code_bottom=40,ORYX.CONFIG.META_KEY_META_CTRL="metactrl",ORYX.CONFIG.META_KEY_ALT="alt",ORYX.CONFIG.META_KEY_SHIFT="shift",ORYX.CONFIG.KEY_ACTION_DOWN="down",ORYX.CONFIG.KEY_ACTION_UP="up",ORYX.CONFIG.PANEL_RIGHT_COLLAPSED=!0,ORYX.CONFIG.PANEL_LEFT_COLLAPSED=!0,ORYX.CONFIG.STENCIL_MAX_ORDER=999,ORYX.CONFIG.STENCIL_GROUP_ORDER=function(){var e={};return e["http://b3mn.org/stencilset/bpmn2.0#"]={},e["http://b3mn.org/stencilset/bpmn2.0#"].Activities={},e["http://b3mn.org/stencilset/bpmn2.0#"].Artifacts={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Catching Intermediate Events"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Connecting Objects"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Data Objects"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["End Events"]={},e["http://b3mn.org/stencilset/bpmn2.0#"].Gateways={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Service Tasks"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Start Events"]={},e["http://b3mn.org/stencilset/bpmn2.0#"].Swimlanes={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Throwing Intermediate Events"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Start Events"]=1,e["http://b3mn.org/stencilset/bpmn2.0#"]["Catching Intermediate Events"]=2,e["http://b3mn.org/stencilset/bpmn2.0#"]["Throwing Intermediate Events"]=3,e["http://b3mn.org/stencilset/bpmn2.0#"]["End Events"]=4,e["http://b3mn.org/stencilset/bpmn2.0#"].Gateways=5,e["http://b3mn.org/stencilset/bpmn2.0#"].Activities=6,e["http://b3mn.org/stencilset/bpmn2.0#"]["Service Tasks"]=7,e["http://b3mn.org/stencilset/bpmn2.0#"]["Connecting Objects"]=8,e["http://b3mn.org/stencilset/bpmn2.0#"]["Data Objects"]=9,e["http://b3mn.org/stencilset/bpmn2.0#"].Swimlanes=10,e["http://b3mn.org/stencilset/bpmn2.0#"].Artifacts=11,e["http://b3mn.org/stencilset/bpmn2.0#"].Task={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Reusable Subprocess"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Multiple instances"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Embedded Subprocess"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Data-based Exclusive (XOR) Gateway"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Start Event"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Timer Intermediate Event"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Signal Intermediate Event"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["End Event"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Error End Event"]={},e["http://b3mn.org/stencilset/bpmn2.0#"]["Sequence Flow"]={},e["http://b3mn.org/stencilset/bpmn2.0#"].Task=7,e["http://b3mn.org/stencilset/bpmn2.0#"]["Reusable Subprocess"]=8,e["http://b3mn.org/stencilset/bpmn2.0#"]["Multiple instances"]=9,e["http://b3mn.org/stencilset/bpmn2.0#"]["Embedded Subprocess"]=10,e["http://b3mn.org/stencilset/bpmn2.0#"]["Data-based Exclusive (XOR) Gateway"]=6,e["http://b3mn.org/stencilset/bpmn2.0#"]["Start Event"]=1,e["http://b3mn.org/stencilset/bpmn2.0#"]["Timer Intermediate Event"]=2,e["http://b3mn.org/stencilset/bpmn2.0#"]["Signal Intermediate Event"]=3,e["http://b3mn.org/stencilset/bpmn2.0#"]["End Event"]=4,e["http://b3mn.org/stencilset/bpmn2.0#"]["Error End Event"]=5,e["http://b3mn.org/stencilset/bpmn2.0#"]["Sequence Flow"]=11,e};var ORYX_LOGLEVEL_TRACE=5,ORYX_LOGLEVEL_DEBUG=4,ORYX_LOGLEVEL_INFO=3,ORYX_LOGLEVEL_WARN=2,ORYX_LOGLEVEL_ERROR=1,ORYX_LOGLEVEL_FATAL=0;if(!ORYX_LOGLEVEL)var ORYX_LOGLEVEL=1;var ORYX_CONFIGURATION_DELAY=100,ORYX_CONFIGURATION_WAIT_ATTEMPTS=10;if(!ORYX)var ORYX={};ORYX=Object.extend(ORYX,{PATH:ORYX.CONFIG.ROOT_PATH,alreadyLoaded:[],configrationRetries:0,availablePlugins:[],Log:{__appenders:[{append:function(e){"undefined"!=typeof console&&console.log(e)}}],trace:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_TRACE&&ORYX.Log.__log("TRACE",arguments)},debug:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_DEBUG&&ORYX.Log.__log("DEBUG",arguments)},info:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_INFO&&ORYX.Log.__log("INFO",arguments)},warn:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_WARN&&ORYX.Log.__log("WARN",arguments)},error:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_ERROR&&ORYX.Log.__log("ERROR",arguments)},fatal:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_FATAL&&ORYX.Log.__log("FATAL",arguments)},__log:function(e,t){t[0]=(new Date).getTime()+" "+e+" "+t[0];var i=printf.apply(null,t);ORYX.Log.__appenders.each(function(e){e.append(i)})},addAppender:function(e){ORYX.Log.__appenders.push(e)}},load:function(){var e=new Ext.Window({renderTo:Ext.getBody(),id:"oryx-loading-panel",bodyStyle:"padding: 8px;background:white",title:ORYX.I18N.Oryx.title,width:"auto",height:"auto",modal:!0,resizable:!1,closable:!1,html:'<span style="font-size:11px;">'+ORYX.I18N.Oryx.pleaseWait+"</span>"});if(e.show(),ORYX.Log.debug("Oryx begins loading procedure."),"undefined"==typeof Prototype||"undefined"==typeof Element||"undefined"==typeof Element.Methods||parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.5)throw"Application requires the Prototype JavaScript framework >= 1.5.3";ORYX.Log.debug("Prototype > 1.5 found."),init()}}),ORYX.Log.debug("Registering Oryx with Kickstart"),Kickstart.register(ORYX.load);var Clazz=function(){};Clazz.prototype.construct=function(){},Clazz.extend=function(e){var t=function(){arguments[0]!==Clazz&&this.construct.apply(this,arguments)},i=new this(Clazz),n=this.prototype;for(var s in e){var r=e[s];r instanceof Function&&(r.$=n),i[s]=r}return t.prototype=i,t.extend=this.extend,t};var idCounter=0,ID_PREFIX="resource";if(!ORYX)var ORYX={};ORYX.Editor={DOMEventListeners:new Hash,selection:[],zoomLevel:1,construct:function(e){this._eventsQueue=[],this.loadedPlugins=[],this.pluginsData=[],this.simulationChartData="",this.simulationEventData="",this.simulationEventAggregationData="",this.simulationInstancesData="",this.simulationHTCostData="",this.simulationChartTitle="",this.simulationChartId="",this.simulationChartNodeName="",this.simulationPathData="",this.simulationPathId="",this.simulationPathSVG="",this.localStorageSVG="",this.imagePreviewSVG="",this.modelMetaData=e;var t=e;if(e.model&&(t=e.model),this.id=t.resourceId,this.id||(this.id=t.id,this.id||(this.id=ORYX.Editor.provideId())),null===t.fullscreen&&(t.fullscreen=!0),this.fullscreen=t.fullscreen,this._initEventListener(),ORYX.CONFIG.BACKEND_SWITCH){var i=(t.stencilset.namespace||t.stencilset.url).replace("#","%23");ORYX.Core.StencilSet.loadStencilSet(ORYX.CONFIG.STENCILSET_HANDLER+i,this.id)}else{var i=t.stencilset.url;ORYX.Core.StencilSet.loadStencilSet(i,this.id)}ORYX.CONFIG.SSEXTS&&ORYX.CONFIG.SSEXTS.each(function(e){this.loadSSExtension(e)}.bind(this)),this._createCanvas(t.stencil?t.stencil.id:null,t.properties),this._generateGUI(e);var n=!1,s=!1,r=function(){n&&s&&this._finishedLoading()}.bind(this);ORYX.Editor.makeExtModalWindowKeysave(this._getPluginFacade()),window.setTimeout(function(){this.loadPlugins(),n=!0,r()}.bind(this),100),window.setTimeout(function(){this.loadSerialized(t),this.getCanvas().update(),s=!0,r()}.bind(this),200)},_finishedLoading:function(){Ext.getCmp("oryx-loading-panel")&&Ext.getCmp("oryx-loading-panel").hide(),this.layout.doLayout(),new Ext.dd.DropTarget(this.getCanvas().rootNode.parentNode),ORYX.CONFIG.PANEL_RIGHT_COLLAPSED===!0&&this.layout_regions.east.collapse(),ORYX.CONFIG.PANEL_LEFT_COLLAPSED===!0&&this.layout_regions.west.collapse(),this.handleEvents({type:ORYX.CONFIG.EVENT_LOADED})},_initEventListener:function(){document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYDOWN,this.catchKeyDownEvents.bind(this),!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYUP,this.catchKeyUpEvents.bind(this),!0),this._keydownEnabled=!0,this._keyupEnabled=!0,this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEDOWN]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEUP]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEOVER]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEOUT]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_SELECTION_CHANGED]=[],this.DOMEventListeners[ORYX.CONFIG.EVENT_MOUSEMOVE]=[]},_chartSelected:function(e){this._getPluginFacade().raiseEvent({type:ORYX.CONFIG.EVENT_SIMULATION_DISPLAY_GRAPH,value:e})},_generateGUI:function(){var e=660,t=this.getCanvas().rootNode.parentNode;this.centerContentPanel=new Ext.Panel({autoScroll:!0,cmargins:{left:0,right:0},border:!1,items:{layout:"fit",autoHeight:!0,el:t}}),this.resultsChartPanel=new Ext.Panel({border:!1,id:"simchart",html:"<svg></svg>"}),this.simResultsContentPanel=new Ext.Panel({id:"simresultscontent",autoScroll:!0,autoheight:!0,border:!1,items:[{xtype:"component",id:"simchartframe",anchor:"100%",autoScroll:!0,autoEl:{tag:"iframe",src:ORYX.BASE_FILE_PATH+"simulation/default.jsp",width:"100%",height:"500",frameborder:"0",scrolling:"auto"}}]}),this.simInfoPanel=new Ext.Panel({bodyStyle:"background:#ffff;font-size:9px;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;padding-left:5px;",id:"siminfopanel",title:"Simulation Info",autoScroll:!0,autoheight:!0,border:!1,html:""}),this.simResultsTree=new Ext.tree.TreePanel({id:"simresultscharts",title:"Simulation Graphs",autoheight:!0,animate:!0,loader:new Ext.tree.TreeLoader,rootVisible:!1,autoScroll:!1,lines:!0,listeners:{click:{fn:this._chartSelected.bind(this)}}});var i=new Ext.tree.TreeNode({draggable:!1,id:"simcharts"});this.simResultsTree.setRootNode(i),this.simResultsContentPanelLayout=new Ext.Panel({width:"100%",height:1e3,layout:"border",items:[{xtype:"panel",region:"east",margins:"5 0 0 5",layout:"anchor",anchor:"100%",width:300,border:!1,collapsible:!0,autoscroll:!0,split:!0,minSize:100,maxSize:500,autoheight:!0,cmargins:"5 5 0 5",items:[this.simInfoPanel,this.simResultsTree]},{xtype:"panel",region:"center",layout:"anchor",anchor:"100%",border:!1,autoscroll:!0,autoheight:!0,margins:"5 5 0 0",items:[this.simResultsContentPanel]}]});var n={id:"maintabs",region:"center",cls:"x-panel-editor-center",autoScroll:!1,cmargins:{left:0,right:0},activeTab:0,border:!1,tabPosition:"top",anchor:"100%",deferredRender:!1,listeners:{tabchange:function(e){this.centerContentTabPannel.doLayout(),this.simResultsContentPanelLayout.doLayout(),e.doLayout()}.bind(this)},items:[{layout:"fit",title:"Process Modelling",id:"processmodellingtab",items:[this.centerContentPanel]},{layout:"fit",title:"Simulation Results",id:"simulationtab",autoScroll:!1,items:[this.simResultsContentPanelLayout]}]};this.centerContentTabPannel=new Ext.TabPanel(n),1==ORYX.READONLY&&Ext.getCmp("maintabs").remove("simulationtab");var s=ORYX.CONFIG.PANEL_LEFT_WIDTH||400;1==ORYX.READONLY&&(s=10),this.layout_regions={north:new Ext.Panel({region:"north",cls:"x-panel-editor-north",autoEl:"div",border:!1}),east:new Ext.Panel({region:"east",layout:"anchor",autoEl:"div",border:!1,cls:"x-panel-editor-east",width:s,autoScroll:!0,split:!0,animate:!0,collapsible:!0,titleCollapse:!0,title:"Properties",plugins:new Ext.ux.PanelCollapsedTitlePlugin}),south:new Ext.Panel({region:"south",cls:"x-panel-editor-south",autoEl:"div",border:!1}),west:new Ext.Panel({region:"west",layout:"anchor",autoEl:"div",border:!1,cls:"x-panel-editor-west",width:ORYX.CONFIG.PANEL_LEFT_WIDTH||200,autoScroll:!0,split:!0,animate:!0,collapsible:!0,titleCollapse:!0,title:"Shape Repository",plugins:new Ext.ux.PanelCollapsedTitlePlugin}),center:this.centerContentTabPannel};for(region in this.layout_regions)"center"!=region&&1==ORYX.READONLY&&this.layout_regions[region].setVisible(!1);var r={layout:"border",items:[this.layout_regions.north,this.layout_regions.east,this.layout_regions.south,this.layout_regions.west,this.layout_regions.center]};this.contentviewport=new Ext.Viewport(r),this.fullscreen?this.layout=new Ext.Viewport(r):(r.renderTo=this.id,r.height=e,this.layout=new Ext.Panel(r)),this._generateHeader(),t.parentNode.setAttributeNS(null,"align","center"),t.setAttributeNS(null,"align","left"),this.getCanvas().setSize({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT})},_generateHeader:function(){var e=new Ext.Panel({height:0,autoHeight:!1,border:!1,html:""}),t=ORYX.MashupAPI&&ORYX.MashupAPI.isUsed;t?ORYX.MashupAPI.key:"";var i=t?ORYX.MashupAPI.canRun:!1,n=t?ORYX.MashupAPI.isModelRemote:!0,s=n?"<img src='"+ORYX.PATH+"images/page_white_put.png'/>":"",r=t?"<span class='mashupinfo'><img src='"+ORYX.PATH+"images/"+(i?"plugin_error":"plugin")+".png'/>"+s+"</span>":"",o=function(t){var i=ORYX.I18N.Oryx.notLoggedOn,n=t&&t.identifier&&"public"!=t.identifier?decodeURI(t.identifier.gsub('"',"")).replace(/\+/g," "):"";n.length<=0&&(n=i);var s="<div id='oryx_editor_header'><a href=\""+ORYX.CONFIG.WEB_URL+'" target="_blank">'+"<img src='"+ORYX.BASE_FILE_PATH+'images/oryx.small.gif\' border="0" />'+"</a>"+"<span class='openid "+(i==n?"not":"")+"'>"+n+r+"</span>"+"<div style='clear: both;'/>"+"</div>";e.body?e.body.dom.innerHTML=s:e.html=s};ORYX.Editor.Cookie.onChange(o),o(ORYX.Editor.Cookie.getParams()),this.addToRegion("north",e)},addToRegion:function(e,t,i){if(e.toLowerCase&&this.layout_regions[e.toLowerCase()]){var n=this.layout_regions[e.toLowerCase()];if(n.add(t),ORYX.Log.debug("original dimensions of region %0: %1 x %2",n.region,n.width,n.height),!n.width&&t.initialConfig&&t.initialConfig.width&&(ORYX.Log.debug("resizing width of region %0: %1",n.region,t.initialConfig.width),n.setWidth(t.initialConfig.width)),t.initialConfig&&t.initialConfig.height){ORYX.Log.debug("resizing height of region %0: %1",n.region,t.initialConfig.height);var s=n.height||0;n.height=t.initialConfig.height+s,n.setHeight(t.initialConfig.height+s)}return"string"==typeof i&&n.setTitle(i),n.ownerCt.doLayout(),1==ORYX.READONLY&&"center"!=n.region||n.show(),Ext.isMac&&ORYX.Editor.resizeFix(),n}return null},getAvailablePlugins:function(){var e=ORYX.availablePlugins.clone();return e.each(function(e){e.engaged=this.loadedPlugins.find(function(e){return e.type==this.name}.bind(e))?!0:!1}.bind(this)),e},loadScript:function(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){("loaded"==i.readyState||"complete"==i.readyState)&&(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)},activatePluginByName:function(name,callback,loadTry){var match=this.getAvailablePlugins().find(function(e){return e.name==name});if(!match||match.engaged&&"false"!==match.engaged)callback(!1,match?"NOTFOUND":"YETACTIVATED");else{var loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade(),newPlugin,me=this;if(ORYX.Log.debug("Initializing plugin '%0'",match.name),match.requires&&match.requires.namespaces&&!match.requires.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0}))callback(!1,"REQUIRESTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else if(match.notUsesIn&&match.notUsesIn.namespaces&&match.notUsesIn.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0}))callback(!1,"NOTUSEINSTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else try{var className=eval(match.name),newPlugin=new className(facade,match);newPlugin.type=match.name,newPlugin.registryChanged&&newPlugin.registryChanged(me.pluginsData),newPlugin.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,newPlugin.onSelectionChanged.bind(newPlugin)),this.loadedPlugins.push(newPlugin),this.loadedPlugins.each(function(e){e.registryChanged&&e.registryChanged(this.pluginsData)}.bind(me)),callback(!0)}catch(e){if(ORYX.Log.warn("Plugin %0 is not available",match.name),loadTry)return callback(!1,"INITFAILED"),void 0;this.loadScript("plugins/scripts/"+match.source,this.activatePluginByName.bind(this,match.name,callback,!0))
}}},loadPlugins:function(){var me=this,newPlugins=[],loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade();ORYX.MashupAPI&&ORYX.MashupAPI.loadablePlugins&&ORYX.MashupAPI.loadablePlugins instanceof Array&&(ORYX.availablePlugins=$A(ORYX.availablePlugins).findAll(function(e){return ORYX.MashupAPI.loadablePlugins.include(e.name)}),ORYX.MashupAPI.loadablePlugins.each(function(e){ORYX.availablePlugins.find(function(t){return t.name==e})||ORYX.availablePlugins.push({name:e})})),ORYX.availablePlugins.each(function(value){if(ORYX.Log.debug("Initializing plugin '%0'",value.name),value.requires&&value.requires.namespaces&&!value.requires.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0})||value.notUsesIn&&value.notUsesIn.namespaces&&value.notUsesIn.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0})||!value.engaged&&void 0!==value.engaged)ORYX.Log.info("Plugin need a stencilset which is not loaded'",value.name);else try{var className=eval(value.name);if(className){var plugin=new className(facade,value);plugin.type=value.name,newPlugins.push(plugin),plugin.engaged=!0}}catch(e){ORYX.Log.warn("Plugin %0 is not available",value.name)}}),newPlugins.each(function(e){e.registryChanged&&e.registryChanged(me.pluginsData),e.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,e.onSelectionChanged.bind(e))}),this.loadedPlugins=newPlugins,Ext.isMac&&ORYX.Editor.resizeFix(),this.registerPluginsOnKeyEvents(),this.setSelection()},_createCanvas:function(e,t){e?-1===e.search(/^http/)&&(e=this.getStencilSets().values()[0].namespace()+e):e=this.getStencilSets().values()[0].findRootStencilName();var i=ORYX.Core.StencilSet.stencil(e);i||ORYX.Log.fatal("Initialisation failed, because the stencil with the type %0 is not part of one of the loaded stencil sets.",e);var n=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",null,["div"]);if(n.addClassName("ORYX_Editor"),this._canvas=new ORYX.Core.Canvas({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT,eventHandlerCallback:this.handleEvents.bind(this),id:this.id,parentNode:n},i),t){var s=[];for(field in t)s.push({prefix:"oryx",name:field,value:t[field]});this._canvas.deserialize(s)}},_getPluginFacade:function(){return this._pluginFacade||(this._pluginFacade={activatePluginByName:this.activatePluginByName.bind(this),getAvailablePlugins:this.getAvailablePlugins.bind(this),offer:this.offer.bind(this),getStencilSets:this.getStencilSets.bind(this),getRules:this.getRules.bind(this),loadStencilSet:this.loadStencilSet.bind(this),createShape:this.createShape.bind(this),deleteShape:this.deleteShape.bind(this),getSelection:this.getSelection.bind(this),setSelection:this.setSelection.bind(this),updateSelection:this.updateSelection.bind(this),getCanvas:this.getCanvas.bind(this),importJSON:this.importJSON.bind(this),importERDF:this.importERDF.bind(this),getERDF:this.getERDF.bind(this),getJSON:this.getJSON.bind(this),getSerializedJSON:this.getSerializedJSON.bind(this),checkParsingErrors:this.checkParsingErrors.bind(this),showParsingErrors:this.showParsingErrors.bind(this),executeCommands:this.executeCommands.bind(this),registerOnEvent:this.registerOnEvent.bind(this),unregisterOnEvent:this.unregisterOnEvent.bind(this),raiseEvent:this.handleEvents.bind(this),enableEvent:this.enableEvent.bind(this),disableEvent:this.disableEvent.bind(this),eventCoordinates:this.eventCoordinates.bind(this),addToRegion:this.addToRegion.bind(this),getModelMetaData:this.getModelMetaData.bind(this)}),this._pluginFacade},executeCommands:function(e){if(e instanceof Array&&e.length>0&&e.all(function(e){return e instanceof ORYX.Core.Command})){this.handleEvents({type:ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,commands:e});var t;return e.each(function(e){t=e.execute()}),t}},getJSON:function(){var e=this.getCanvas().toJSON();return e.ssextensions=this.getStencilSets().values()[0].extensions().keys(),e},getSerializedJSON:function(){return Ext.encode(this.getJSON())},checkParsingErrors:function(){var e=ORYX.EDITOR.getSerializedJSON(),t=new XMLHttpRequest,i=ORYX.PATH+"uuidRepository",n="action=checkErrors&pp="+ORYX.PREPROCESSING+"&profile="+ORYX.PROFILE+"&data="+encodeURIComponent(e);if(t.open("POST",i,!1),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(n),200==t.status){if("true"==t.responseText)return"true";var s=DataManager.serialize(ORYX.EDITOR.getCanvas().getSVGRepresentation(!1)),r=DataManager.serialize(ORYX.EDITOR.getCanvas().getRootNode().cloneNode(!0)),e=ORYX.EDITOR.getSerializedJSON(),o=jsonPath(e.evalJSON(),"$.properties.id");return Ext.Ajax.request({url:ORYX.PATH+"transformer",method:"POST",success:function(){},failure:function(){Ext.Msg.minWidth=400,this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:"Failed to save process SVG.",title:""})},params:{fsvg:s,rsvg:r,uuid:ORYX.UUID,profile:ORYX.PROFILE,transformto:"svg",processid:o}}),"false"}return"true"},showParsingErrors:function(){Ext.Msg.minWidth=360,Ext.MessageBox.alert("Unable to perform action","Unable to perform user action due to error(s).<br/>Validate your process before saving, and view server logs to see error details.")},getERDF:function(){var e=DataManager.serializeDOM(this._getPluginFacade());return e='<?xml version="1.0" encoding="utf-8"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:b3mn="http://b3mn.org/2007/b3mn" xmlns:ext="http://b3mn.org/2007/ext" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:atom="http://b3mn.org/2007/atom+xhtml"><head profile="http://purl.org/NET/erdf/profile"><link rel="schema.dc" href="http://purl.org/dc/elements/1.1/" /><link rel="schema.dcTerms" href="http://purl.org/dc/terms/ " /><link rel="schema.b3mn" href="http://b3mn.org" /><link rel="schema.oryx" href="http://oryx-editor.org/" /><link rel="schema.raziel" href="http://raziel.org/" /><base href="'+location.href.split("?")[0]+'" />'+"</head><body>"+e+"</body></html>"},importJSON:function(e,t){try{e=this.renewResourceIds(e)}catch(i){throw i}if(!e.stencilset)return this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:ORYX.I18N.JSONImport.invalidJSON,title:ORYX.I18N.JSONImport.title}),null;if(e.stencilset.namespace&&e.stencilset.namespace!==this.getCanvas().getStencil().stencilSet().namespace())return this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:String.format(ORYX.I18N.JSONImport.wrongSS,e.stencilset.namespace,this.getCanvas().getStencil().stencilSet().namespace()),title:ORYX.I18N.JSONImport.title}),null;var n=ORYX.Core.Command.extend({construct:function(e,t,i,n){this.jsonObject=e,this.noSelection=i,this.facade=n,this.shapes,this.connections=[],this.parents=new Hash,this.selection=this.facade.getSelection(),this.loadSerialized=t},execute:function(){this.shapes?(this.shapes.each(function(e){this.parents[e.id].add(e)}.bind(this)),this.connections.each(function(e){e[0].setDockedShape(e[1]),e[0].setReferencePoint(e[2])})):(this.shapes=this.loadSerialized(this.jsonObject),this.shapes.each(function(e){if(e.getDockers){var t=e.getDockers();t&&(t.length>0&&this.connections.push([t.first(),t.first().getDockedShape(),t.first().referencePoint]),t.length>1&&this.connections.push([t.last(),t.last().getDockedShape(),t.last().referencePoint]))}this.parents[e.id]=e.parent}.bind(this))),this.facade.getCanvas().update(),this.noSelection?this.facade.updateSelection():this.facade.setSelection(this.shapes)},rollback:function(){var e=this.facade.getSelection();this.shapes.each(function(t){e=e.without(t),this.facade.deleteShape(t)}.bind(this)),this.facade.getCanvas().update(),this.facade.setSelection(e)}}),s=new n(e,this.loadSerialized.bind(this),t,this._getPluginFacade());return this.executeCommands([s]),s.shapes.clone()},renewResourceIds:function(e){if("string"===Ext.type(e))try{var t=e;e=Ext.decode(e)}catch(i){throw new SyntaxError(i.message)}else var t=Ext.encode(e);var n=function(e){return e?e.map(function(e){return n(e.childShapes).concat(e.resourceId)}).flatten():[]},s=n(e.childShapes);return s.each(function(e){var i=ORYX.Editor.provideId();t=t.gsub('"'+e+'"','"'+i+'"')}),Ext.decode(t)},importERDF:function(e){var t=this.parseToSerializeObjects(e);return t?this.importJSON(t,!0):void 0},parseToSerializeObjects:function(e){e.normalize&&e.normalize();try{var t="",i=ORYX.PATH+"lib/extract-rdf.xsl";new Ajax.Request(i,{asynchronous:!1,method:"get",onSuccess:function(e){t=e.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var n=new DOMParser,s=e,r=n.parseFromString(t,"text/xml"),o=new XSLTProcessor;document.implementation.createDocument("","",null),o.importStylesheet(r);var a=o.transformToFragment(s,document),h=(new XMLSerializer).serializeToString(a)}catch(l){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:"Error: "+l,title:""});var h=""}h=h.startsWith("<?xml")?h:'<?xml version="1.0" encoding="UTF-8"?>'+h;var c=new Ajax.Request(ORYX.CONFIG.ROOT_PATH+"rdf2json",{method:"POST",asynchronous:!1,onSuccess:function(e){Ext.decode(e.responseText)},parameters:{rdf:h}});return Ext.decode(c.transport.responseText)},loadSerialized:function(e){this.getCanvas(),this.loadSSExtensions(e.ssextensions);var t=this.getCanvas().addShapeObjects(e.childShapes,this.handleEvents.bind(this));if(e.properties)for(key in e.properties){var i=e.properties[key];"string"!=typeof i&&(i=Ext.encode(i)),this.getCanvas().setProperty("oryx-"+key,i)}return this.getCanvas().updateSize(),t},loadSSExtensions:function(e){e&&e.each(function(e){this.loadSSExtension(e)}.bind(this))},loadSSExtension:function(e){if(e){var t=this.getStencilSets()[e["extends"]];t&&(t.addExtension(e),this.getRules().initializeRules(t),this._getPluginFacade().raiseEvent({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED}))}},disableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!1),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!1),this.DOMEventListeners.keys().member(e)){var t=this.DOMEventListeners.remove(e);this.DOMEventListeners["disable_"+e]=t}},enableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!0),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!0),this.DOMEventListeners.keys().member("disable_"+e)){var t=this.DOMEventListeners.remove("disable_"+e);this.DOMEventListeners[e]=t}},registerOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)||(this.DOMEventListeners[e]=[]),this.DOMEventListeners[e].push(t)},unregisterOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)&&(this.DOMEventListeners[e]=this.DOMEventListeners[e].without(t))},getSelection:function(){return this.selection},getStencilSets:function(){return ORYX.Core.StencilSet.stencilSets(this.id)},getRules:function(){return ORYX.Core.StencilSet.rules(this.id)},loadStencilSet:function(e){try{ORYX.Core.StencilSet.loadStencilSet(e,this.id),this.handleEvents({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED})}catch(t){ORYX.Log.warn("Requesting stencil set file failed. ("+t+")")}},offer:function(e){this.pluginsData.member(e)||this.pluginsData.push(e)},registerPluginsOnKeyEvents:function(){this.pluginsData.each(function(e){e.keyCodes&&e.keyCodes.each(function(t){var i="key.event";i+="."+t.keyAction,t.metaKeys&&(t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_META_CTRL)>-1&&(i+="."+ORYX.CONFIG.META_KEY_META_CTRL),t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_ALT)>-1&&(i+="."+ORYX.CONFIG.META_KEY_ALT),t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_SHIFT)>-1&&(i+="."+ORYX.CONFIG.META_KEY_SHIFT)),t.keyCode&&(i+="."+t.keyCode),ORYX.Log.debug("Register Plugin on Key Event: %0",i),this.registerOnEvent(i,e.functionality)}.bind(this))}.bind(this))},setSelection:function(e,t,i){e||(e=[]),e=e.compact().findAll(function(e){return e instanceof ORYX.Core.Shape}),e.first()instanceof ORYX.Core.Canvas&&(e=[]),(i||e.length!==this.selection.length||!this.selection.all(function(t){return e.include(t)}))&&(this.selection=e,this._subSelection=t,this.handleEvents({type:ORYX.CONFIG.EVENT_SELECTION_CHANGED,elements:e,subSelection:t}))},updateSelection:function(){this.setSelection(this.selection,this._subSelection,!0)},getCanvas:function(){return this._canvas},createShape:function(e){if(e&&e.serialize&&e.serialize instanceof Array){var t=e.serialize.find(function(e){return"oryx-type"==e.prefix+"-"+e.name}),i=ORYX.Core.StencilSet.stencil(t.value);if("node"==i.type())var n=new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},i);else var n=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},i);return this.getCanvas().add(n),n.deserialize(e.serialize),n}if(!e||!e.type||!e.namespace)throw"To create a new shape you have to give an argument with type and namespace";var n,s=this.getCanvas(),r=e.type,o=ORYX.Core.StencilSet.stencilSet(e.namespace);n="node"==o.stencil(r).type()?new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},o.stencil(r)):new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},o.stencil(r)),e.template&&(n._jsonStencil.properties=e.template._jsonStencil.properties,n.postProcessProperties()),e.parent&&n instanceof ORYX.Core.Node?e.parent.add(n):s.add(n);var a,h=e.position?e.position:{x:100,y:200};if(e.connectingType&&e.connectedShape&&!(n instanceof ORYX.Core.Edge)){a=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},o.stencil(e.connectingType)),a.dockers.first().setDockedShape(e.connectedShape);var l=e.connectedShape.getDefaultMagnet(),c=l?l.bounds.center():e.connectedShape.bounds.midPoint();a.dockers.first().setReferencePoint(c),a.dockers.last().setDockedShape(n),a.dockers.last().setReferencePoint(n.getDefaultMagnet().bounds.center()),s.add(a)}if(n instanceof ORYX.Core.Edge&&e.connectedShape)n.dockers.first().setDockedShape(e.connectedShape),e.connectedShape instanceof ORYX.Core.Node?(n.dockers.first().setReferencePoint(e.connectedShape.getDefaultMagnet().bounds.center()),n.dockers.last().bounds.centerMoveTo(h)):n.dockers.first().setReferencePoint(e.connectedShape.bounds.midPoint());else{var d=n.bounds;n instanceof ORYX.Core.Node&&1==n.dockers.length&&(d=n.dockers.first().bounds),d.centerMoveTo(h);var u=d.upperLeft();d.moveBy(-Math.min(u.x,0),-Math.min(u.y,0));var g=d.lowerRight();d.moveBy(-Math.max(g.x-s.bounds.width(),0),-Math.max(g.y-s.bounds.height(),0))}return n instanceof ORYX.Core.Edge&&n._update(!1),n instanceof ORYX.Core.Edge||this.setSelection([n]),a&&a.alignDockers&&a.alignDockers(),n.alignDockers&&n.alignDockers(),n},deleteShape:function(e){e&&e.parent&&(e.parent.remove(e),e.getOutgoingShapes().each(function(t){var i=t.getDockers().first();i&&i.getDockedShape()==e&&i.setDockedShape(void 0)}.bind(this)),e.getIncomingShapes().each(function(t){var i=t.getDockers().last();i&&i.getDockedShape()==e&&i.setDockedShape(void 0)}.bind(this)),e.getDockers().each(function(e){e.setDockedShape(void 0)}),this._getPluginFacade().raiseEvent({type:ORYX.CONFIG.EVENT_SHAPE_DELETED,value:e}))},getModelMetaData:function(){return this.modelMetaData},_executeEventImmediately:function(e){this.DOMEventListeners.keys().member(e.event.type)&&this.DOMEventListeners[e.event.type].each(function(t){t(e.event,e.arg)}.bind(this))},_executeEvents:function(){for(this._queueRunning=!0;this._eventsQueue.length>0;){var e=this._eventsQueue.shift();this._executeEventImmediately(e)}this._queueRunning=!1},handleEvents:function(e,t){switch(ORYX.Log.trace("Dispatching event type %0 on %1",e.type,t),e.type){case ORYX.CONFIG.EVENT_MOUSEDOWN:this._handleMouseDown(e,t);break;case ORYX.CONFIG.EVENT_MOUSEMOVE:this._handleMouseMove(e,t);break;case ORYX.CONFIG.EVENT_MOUSEUP:this._handleMouseUp(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOVER:this._handleMouseHover(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOUT:this._handleMouseOut(e,t)}return e.forceExecution?this._executeEventImmediately({event:e,arg:t}):this._eventsQueue.push({event:e,arg:t}),this._queueRunning||this._executeEvents(),!1},catchKeyUpEvents:function(e){if(this._keyupEnabled&&(e||(e=window.event),!["INPUT","TEXTAREA"].include(e.target.tagName.toUpperCase()))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_UP);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},catchKeyDownEvents:function(e){if(this._keydownEnabled&&(e||(e=window.event),!["INPUT","TEXTAREA"].include(e.target.tagName.toUpperCase()))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_DOWN);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},createKeyCombEvent:function(e,t){var i=e.which||e.keyCode,n="key.event";return t&&(n+="."+t),(e.ctrlKey||e.metaKey)&&(n+="."+ORYX.CONFIG.META_KEY_META_CTRL),e.altKey&&(n+="."+ORYX.CONFIG.META_KEY_ALT),e.shiftKey&&(n+="."+ORYX.CONFIG.META_KEY_SHIFT),n+"."+i},_handleMouseDown:function(e,t){var i=this.getCanvas();i.focus();var n=e.currentTarget,s=t,r=null!==s&&void 0!==s&&s.isSelectable,o=null!==s&&void 0!==s&&s.isMovable,a=e.shiftKey||e.ctrlKey,h=0===this.selection.length,l=this.selection.member(s);if(r&&h)this.setSelection([s]),ORYX.Log.trace("Rule #1 applied for mouse down on %0",n.id);else if(!r||h||a||l)if(r&&a&&!l){var c=this.selection.clone();c.push(s),this.setSelection(c),ORYX.Log.trace("Rule #4 applied for mouse down on %0",n.id)}else if(r&&l&&a){var c=this.selection.clone();this.setSelection(c.without(s)),ORYX.Log.trace("Rule #6 applied for mouse down on %0",s.id)}else{if(!r&&!o)return this.setSelection([]),ORYX.Log.trace("Rule #2 applied for mouse down on %0",n.id),void 0;r||!o||s instanceof ORYX.Core.Controls.Docker?r&&l&&!a&&(this._subSelection=this._subSelection!=s?s:void 0,this.setSelection(this.selection,this._subSelection),ORYX.Log.trace("Rule #8 applied for mouse down on %0",n.id)):ORYX.Log.trace("Rule #7 applied for mouse down on %0",n.id)}else this.setSelection([s]),ORYX.Log.trace("Rule #3 applied for mouse down on %0",n.id)},_handleMouseMove:function(){},_handleMouseUp:function(e,t){this.getCanvas(),this.eventCoordinates(e)},_handleMouseHover:function(){},_handleMouseOut:function(){},eventCoordinates:function(e){var t=this.getCanvas(),i=t.node.ownerSVGElement.createSVGPoint();i.x=e.clientX,i.y=e.clientY;var n=t.node.getScreenCTM();return i.matrixTransform(n.inverse())}},ORYX.Editor=Clazz.extend(ORYX.Editor),ORYX.Editor.createByUrl=function(e,t){t||(t={}),new Ajax.Request(e,{method:"GET",onSuccess:function(e){var i=Ext.decode(e.responseText);i=Ext.applyIf(i,t),new ORYX.Editor(i),"function"==typeof t.onSuccess&&t.onSuccess(e)}.bind(this),onFailure:function(e){"function"==typeof t.onFailure&&t.onFailure(e)}.bind(this)})},ORYX.Editor.graft=function(e,t,i,n){n=n||t&&t.ownerDocument||document;var s;if(void 0===i)throw"Can't graft an undefined value";if(i.constructor==String)s=n.createTextNode(i);else for(var r=0;r<i.length;r++){if(0===r&&i[r].constructor==String){var o;if(o=i[r].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i)){s=n.createElementNS(e,o[1]),s.setAttributeNS(null,"class",o[2]);continue}if(o=i[r].match(/^([a-z][a-z0-9]*)$/i)){s=n.createElementNS(e,o[1]);continue}s=n.createElementNS(e,"span"),s.setAttribute(null,"class","namelessFromLOL")}if(void 0===i[r])throw"Can't graft an undefined value in a list!";if(i[r].constructor==String||i[r].constructor==Array)this.graft(e,s,i[r],n);else if(i[r].constructor==Number)this.graft(e,s,i[r].toString(),n);else if(i[r].constructor==Object)for(var a in i[r])s.setAttributeNS(null,a,i[r][a])}return t&&t.appendChild(s),s},ORYX.Editor.provideId=function(){for(var e=[],t="0123456789ABCDEF",i=0;36>i;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=8|3&e[19];for(var i=0;36>i;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-","_"+e.join("")},ORYX.Editor.resizeFix=function(){ORYX.Editor._resizeFixTimeout||(ORYX.Editor._resizeFixTimeout=window.setTimeout(function(){window.resizeBy(1,1),window.resizeBy(-1,-1),ORYX.Editor._resizefixTimeout=null},100))},ORYX.Editor.Cookie={callbacks:[],onChange:function(e,t){this.callbacks.push(e),this.start(t)},start:function(e){if(!this.pe){var t=document.cookie;this.pe=new PeriodicalExecuter(function(){t!=document.cookie&&(t=document.cookie,this.callbacks.each(function(e){e(this.getParams())}.bind(this)))}.bind(this),(e||1e4)/1e3)}},stop:function(){this.pe&&(this.pe.stop(),this.pe=null)},getParams:function(){var e={},t=document.cookie;return t.split("; ").each(function(t){e[t.split("=")[0]]=t.split("=")[1]}),e},toString:function(){return document.cookie}},ORYX.Editor.SVGClassElementsAreAvailable=!0,ORYX.Editor.setMissingClasses=function(){try{}catch(e){ORYX.Editor.SVGClassElementsAreAvailable=!1,SVGSVGElement=document.createElementNS("http://www.w3.org/2000/svg","svg").toString(),SVGGElement=document.createElementNS("http://www.w3.org/2000/svg","g").toString(),SVGPathElement=document.createElementNS("http://www.w3.org/2000/svg","path").toString(),SVGTextElement=document.createElementNS("http://www.w3.org/2000/svg","text").toString(),SVGRectElement=document.createElementNS("http://www.w3.org/2000/svg","rect").toString(),SVGImageElement=document.createElementNS("http://www.w3.org/2000/svg","image").toString(),SVGCircleElement=document.createElementNS("http://www.w3.org/2000/svg","circle").toString(),SVGEllipseElement=document.createElementNS("http://www.w3.org/2000/svg","ellipse").toString(),SVGLineElement=document.createElementNS("http://www.w3.org/2000/svg","line").toString(),SVGPolylineElement=document.createElementNS("http://www.w3.org/2000/svg","polyline").toString(),SVGPolygonElement=document.createElementNS("http://www.w3.org/2000/svg","polygon").toString()}},ORYX.Editor.checkClassType=function(e,t){return ORYX.Editor.SVGClassElementsAreAvailable?e instanceof t:e==t},ORYX.Editor.makeExtModalWindowKeysave=function(e){Ext.override(Ext.Window,{beforeShow:function(){if(delete this.el.lastXY,delete this.el.lastLT,void 0===this.x||void 0===this.y){var t=this.el.getAlignToXY(this.container,"c-c"),i=this.el.translatePoints(t[0],t[1]);this.x=void 0===this.x?i.left:this.x,this.y=void 0===this.y?i.top:this.y}this.el.setLeftTop(this.x,this.y),this.expandOnShow&&this.expand(!1),this.modal&&(e.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN),Ext.getBody().addClass("x-body-masked"),this.mask.setSize(Ext.lib.Dom.getViewWidth(!0),Ext.lib.Dom.getViewHeight(!0)),this.mask.show())},afterHide:function(){this.proxy.hide(),(this.monitorResize||this.modal||this.constrain||this.constrainHeader)&&Ext.EventManager.removeResizeListener(this.onWindowResize,this),this.modal&&(this.mask.hide(),e.enableEvent(ORYX.CONFIG.EVENT_KEYDOWN),Ext.getBody().removeClass("x-body-masked")),this.keyMap&&this.keyMap.disable(),this.fireEvent("hide",this)},beforeDestroy:function(){this.modal&&e.enableEvent(ORYX.CONFIG.EVENT_KEYDOWN),Ext.destroy(this.resizer,this.dd,this.proxy,this.mask),Ext.Window.superclass.beforeDestroy.call(this)}})},ORYX.Utils={getParamFromUrl:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",i=new RegExp(t),n=i.exec(window.location.href);return null==n?null:n[1]},adjustGradient:function(e,t){if(ORYX.CONFIG.DISABLE_GRADIENT&&e){var i=t.getAttributeNS(null,"stop-color")||"#ffffff";$A(e.getElementsByTagName("stop")).each(function(e){e!=t&&e.setAttributeNS(null,"stop-color",i)})}}};var ERDF={LITERAL:1,RESOURCE:2,DELIMITERS:[".","-"],HASH:"#",HYPHEN:"-",schemas:[],callback:void 0,log:void 0,init:function(e){ERDF.callback=e,ERDF.registerSchema("schema",XMLNS.SCHEMA),ERDF.registerSchema("rdfs",XMLNS.RDFS)},run:function(){return ERDF._checkProfile()&&ERDF.parse()},parse:function(){ERDF.__startTime=new Date;var e=document.getElementsByTagNameNS(XMLNS.XHTML,"body"),t={type:ERDF.RESOURCE,value:""},i=ERDF._parseDocumentMetadata()&&ERDF._parseFromTag(e[0],t);return ERDF.__stopTime=new Date,(ERDF.__stopTime-ERDF.__startTime)/1e3,i},_parseDocumentMetadata:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head"),t=e[0].getElementsByTagNameNS(XMLNS.XHTML,"link"),i=e[0].getElementsByTagNameNS(XMLNS.XHTML,"meta");return $A(t).each(function(e){var t=e.getAttribute("rel"),i=e.getAttribute("rev"),n=e.getAttribute("href");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.RESOURCE,n),ERDF._parseTriplesFrom(ERDF.RESOURCE,n,i,ERDF.RESOURCE,"")}),$A(i).each(function(e){var t=e.getAttribute("name"),i=e.getAttribute("content");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.LITERAL,i)}),!0},_parseFromTag:function(e,t,i){if(e.namespaceURI==XMLNS.XHTML){i||(i=0);var n=e.getAttribute("id");if(e.nodeName.endsWith(":a")||"a"==e.nodeName){var s=e.getAttribute("rel"),r=e.getAttribute("rev"),o=e.getAttribute("href"),a=e.getAttribute("title"),h=e.textContent;ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.RESOURCE,o,function(e){var t=a?a:h;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)}),ERDF._parseTriplesFrom(t.type,t.value,r,ERDF.RESOURCE,""),ERDF._parseTypeTriplesFrom(t.type,t.value,s)}else if(e.nodeName.endsWith(":img")||"img"==e.nodeName){var s=e.getAttribute("class"),o=e.getAttribute("src"),l=e.getAttribute("alt");ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.RESOURCE,o,function(e){var t=l;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)})}var s=e.getAttribute("class"),a=e.getAttribute("title"),h=e.textContent,c=a?a:h;ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.LITERAL,c),n&&(t={type:ERDF.RESOURCE,value:ERDF.HASH+n}),ERDF._parseTypeTriplesFrom(t.type,t.value,s);var d=e.childNodes;d&&$A(d).each(function(e){e.nodeType==e.ELEMENT_NODE&&ERDF._parseFromTag(e,t,i+1)})}},_parseTriplesFrom:function(e,t,i,n,s,r){i&&i.toLowerCase().split(" ").each(function(e){var i=ERDF.schemas.find(function(t){return!1||ERDF.DELIMITERS.find(function(i){return e.startsWith(t.prefix+i)})});if(i&&s){e=e.substring(i.prefix.length+1,e.length);var o=ERDF.registerTriple(new ERDF.Resource(t),{prefix:i.prefix,name:e},n==ERDF.RESOURCE?new ERDF.Resource(s):new ERDF.Literal(s));r&&r(o)}})},_parseTypeTriplesFrom:function(e,t,i,n){i&&i.toLowerCase().split(" ").each(function(i){var s=ERDF.schemas.find(function(e){return!1||ERDF.DELIMITERS.find(function(t){return i.startsWith(ERDF.HYPHEN+e.prefix+t)})});if(s&&t){i=i.substring(s.prefix.length+2,i.length);var r=ERDF.registerTriple(e==ERDF.RESOURCE?new ERDF.Resource(t):new ERDF.Literal(t),{prefix:"rdf",name:"type"},new ERDF.Resource(s.namespace+i));n&&n(r)}})},_checkProfile:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head"),t=e[0].getAttribute("profile");return t&&t.split(" ").member(XMLNS.ERDF)?!0:!1},__stripHashes:function(e){return e&&"#"==e.substring(0,1)?e.substring(1,e.length):e},registerSchema:function(e,t){ERDF.schemas.push({prefix:e,namespace:t})},registerTriple:function(e,t,i){"schema"==t.prefix.toLowerCase()&&this.registerSchema(t.name,i.value);var n=new ERDF.Triple(e,t,i);return ERDF.callback(n),n},__enhanceObject:function(){this.isResource=function(){return this.type==ERDF.RESOURCE},this.isLocal=function(){return this.isResource()&&this.value.startsWith("#")},this.isCurrentDocument=function(){return this.isResource()&&""==this.value},this.getId=function(){return this.isLocal()?ERDF.__stripHashes(this.value):!1},this.isLiteral=function(){return this.type==ERDF.LIITERAL}},serialize:function(e){return e?e.constructor==String?e:e.constructor==Boolean?e?"true":"false":e.toString():""}};ERDF.Triple=function(e,t,i){this.subject=e,this.predicate=t,this.object=i,this.toString=function(){return"[ERDF.Triple] "+this.subject.toString()+" "+this.predicate.prefix+":"+this.predicate.name+" "+this.object.toString()}},ERDF.Resource=function(e){this.type=ERDF.RESOURCE,this.value=e,ERDF.__enhanceObject.apply(this),this.toString=function(){return"&lt;"+this.value+"&gt;"}},ERDF.Literal=function(e){this.type=ERDF.LITERAL,this.value=ERDF.serialize(e),ERDF.__enhanceObject.apply(this),this.toString=function(){return'"'+this.value+'"'}};var USE_ASYNCHRONOUS_REQUESTS=!0,DISCARD_UNUSED_TRIPLES=!0,PREFER_SPANS_OVER_DIVS=!0,PREFER_TITLE_OVER_TEXTNODE=!1,RESOURCE_ID_PREFIX="resource",SHOW_DEBUG_ALERTS_WHEN_SAVING=!1,SHOW_EXTENDED_DEBUG_INFORMATION=!1,USE_ARESS_WORKAROUNDS=!0,RESOURCE_CREATED=1,RESOURCE_REMOVED=2,RESOURCE_SAVED=4,RESOURCE_RELOADED=8,RESOURCE_SYNCHRONIZED=16,TRIPLE_REMOVE=1,TRIPLE_ADD=2,TRIPLE_RELOAD=4,TRIPLE_SAVE=8,PROCESSDATA_REF="processdata",DataManager={init:function(){ERDF.init(DataManager._registerTriple),DataManager.__synclocal()},_triples:[],_registerTriple:function(e){DataManager._triples.push(e)},__synclocal:function(){DataManager._triples=[],ERDF.run()},__synchronizeShape:function(e){var t=ResourceManager.getResource(e.resourceId),i=e.serialize();return i.each(function(t){var i="resource"==t.type,n=new ERDF.Triple(new ERDF.Resource(e.resourceId),{prefix:t.prefix,name:t.name},i?new ERDF.Resource(t.value):new ERDF.Literal(t.value));DataManager.setObject(n)}),t},__storeShape:function(e){var t=DataManager.__synchronizeShape(e);t.save()},__forceExistance:function(e){if($(e.resourceId)){var t=$(e.resourceId),i=$A(t.childNodes);i.each(function(e){t.removeChild(e)})}else $$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),DataManager.graft(XMLNS.XHTML,$$("."+PROCESSDATA_REF)[0],["div",{id:e.resourceId,"class":e instanceof ORYX.Core.Canvas?"-oryx-canvas":void 0}])},__persistShape:function(e){var t=e.serialize(),i=new ERDF.Resource(e.resourceId);DataManager.removeTriples(DataManager.query(i,void 0,void 0)),t.each(function(e){var t="resource"==e.type?new ERDF.Resource(e.value):new ERDF.Literal(e.value);DataManager.addTriple(new ERDF.Triple(i,{prefix:e.prefix,name:e.name},t))})},__persistDOM:function(e){var t=e.getCanvas(),i=t.getChildShapes(!0),n="";return i.each(function(e){DataManager.__forceExistance(e)}),DataManager.__renderCanvas(e),n+=DataManager.serialize($(ERDF.__stripHashes(e.getCanvas().resourceId)),!0),i.each(function(e){DataManager.__persistShape(e),n+=DataManager.serialize($(ERDF.__stripHashes(e.resourceId)),!0)}),n},__renderCanvas:function(e){var t=e.getCanvas(),i=e.getStencilSets(),n=t.getChildShapes(!0);DataManager.__forceExistance(t),DataManager.__persistShape(t);var s=new ERDF.Resource(t.resourceId);DataManager.removeTriples(DataManager.query(s,void 0,void 0)),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"mode"},new ERDF.Literal("writable"))),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"mode"},new ERDF.Literal("fullscreen"))),i.values().each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"stencilset"},new ERDF.Resource(e.source().replace(/&/g,"%26")))),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"ssnamespace"},new ERDF.Resource(e.namespace()))),e.extensions().keys().each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"ssextension"},new ERDF.Literal(e)))})}),n.each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"render"},new ERDF.Resource("#"+e.resourceId)))})},__counter:0,__provideId:function(){for(;$(RESOURCE_ID_PREFIX+DataManager.__counter);)DataManager.__counter++;return RESOURCE_ID_PREFIX+DataManager.__counter},serializeDOM:function(e){return DataManager.__persistDOM(e)},syncGlobal:function(e){return DataManager.__syncglobal(e)},__syncglobal:function(e){var t=e.getCanvas(),i=t.getChildShapes(!0);i.select(function(e){return!$(e.resourceId)}).each(function(e){if(USE_ARESS_WORKAROUNDS){var t=e.properties["raziel-type"],i='<div xmlns="http://www.w3.org/1999/xhtml"><span class="raziel-type">'+t+"</span></div>",n=ResourceManager.__createResource(i);e.resourceId=n.id()}else{var n=ResourceManager.__createResource();e.resourceId=n.id()}}),i.each(function(e){DataManager.__storeShape(e)})},serialize:function(e,t){if(e.nodeType==e.ELEMENT_NODE){var i=$A(e.childNodes),n=$A(e.attributes),s=new String(e.getAttribute("class")),r=s.split(" ").member("transient");if(r)return"";var o="<"+e.nodeName;return t||(o+=' xmlns="'+(e.namespaceURI?e.namespaceURI:XMLNS.XHTML)+'" xmlns:oryx="http://oryx-editor.org"'),n.each(function(e){o+=" "+e.nodeName+'="'+e.nodeValue+'"'
}),0==i.length?o+="/>":(o+=">",i.each(function(e){o+=DataManager.serialize(e,!0)}),o+="</"+e.nodeName+">"),o}return e.nodeType==e.TEXT_NODE?e.nodeValue:void 0},addTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot add the triple "+e.toString()+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot add the triple "+e.toString()+' because the subject "'+t+'" is not in the document.';return e.object.type==ERDF.LITERAL?DataManager.graft(XMLNS.XHTML,i,["span",{"class":e.predicate.prefix+"-"+e.predicate.name},e.object.value.escapeHTML()]):DataManager.graft(XMLNS.XHTML,i,["a",{rel:e.predicate.prefix+"-"+e.predicate.name,href:e.object.value}]),!0},removeTriples:function(e){var t=e.select(function(e){return DataManager.__removeTriple(e)});return t},removeTriple:function(e){var t=DataManager.__removeTriple(e);return t},__removeTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot remove the triple "+e.toString()+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot remove the triple "+e.toString()+" because the subject is not in the document.";if(e.object.type==ERDF.LITERAL){var n=DataManager.__removeTripleRecursively(e,i);return n}},__removeTripleRecursively:function(e,t){if(t.nodeType!=t.ELEMENT_NODE)return!1;var i=new String(t.getAttribute("class")),n=$A(t.childNodes);if(i.include(e.predicate.prefix+"-"+e.predicate.name)){var s=t.textContent;return e.object.type==ERDF.LITERAL&&e.object.value==s&&t.parentNode.removeChild(t),!0}return n.each(function(t){DataManager.__removeTripleRecursively(e,t)}),!1},graft:function(e,t,i,n){n=n||t&&t.ownerDocument||document;var s;if(void 0===i)echo("Can't graft an undefined value");else if(i.constructor==String)s=n.createTextNode(i);else for(var r=0;r<i.length;r++){if(0===r&&i[r].constructor==String){var o=i[r].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i);if(o){s=n.createElementNS(e,o[1]),s.setAttributeNS(null,"class",o[2]);continue}if(o=i[r].match(/^([a-z][a-z0-9]*)$/i)){s=n.createElementNS(e,o[1]);continue}s=n.createElementNS(e,"span"),s.setAttribute(null,"class","namelessFromLOL")}if(void 0===i[r])echo("Can't graft an undefined value in a list!");else if(i[r].constructor==String||i[r].constructor==Array)this.graft(e,s,i[r],n);else if(i[r].constructor==Number)this.graft(e,s,i[r].toString(),n);else if(i[r].constructor==Object)for(var a in i[r])s.setAttributeNS(null,a,i[r][a]);else{if(i[r].constructor!=Boolean)throw"Object "+i[r]+" is inscrutable as an graft arglet.";this.graft(e,s,i[r]?"true":"false",n)}}return t&&t.appendChild(s),Element.extend(s)},setObject:function(e){var t=DataManager.query(e.subject,e.predicate,void 0);return DataManager.removeTriples(t),DataManager.addTriple(e),!0},query:function(e,t,i){return DataManager._triples.select(function(n){var s=e?n.subject.type==e.type&&n.subject.value==e.value:!0;return t&&(s=s&&(t.prefix?n.predicate.prefix==t.prefix:!0),s=s&&(t.name?n.predicate.name==t.name:!0)),s=s&&(i?n.object.type==i.type&&n.object.value==i.value:!0)})}};Kickstart.register(DataManager.init);var chain=new MetaTagHandler,command=new DMCommand(TRIPLE_ADD,new ERDF.Triple(new ERDF.Resource(""),"rdf:tool",new ERDF.Literal("")));if(ResourceManager={__corrupt:!1,__latelyCreatedResource:void 0,__listeners:$H(),__token:1,addListener:function(e,t){if(!(e instanceof Function))throw"Resource event listener is not a function!";if(!t)throw"Invalid mask for resource event listener registration.";var i={listener:e,mask:t},n=ResourceManager.__token++;return ResourceManager.__listeners[n]=i,n},removeListener:function(e){return ResourceManager.__listners.remove(e)},__Event:function(e,t){this.action=e,this.resourceId=t},__dispatchEvent:function(e){ResourceManager.__listeners.values().each(function(t){return e.action&t.mask?t.listener(e):void 0})},getResource:function(e){e=ERDF.__stripHashes(e);var t=DataManager.query(new ERDF.Resource("#"+e),{prefix:"raziel",name:"entry"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value;return new ResourceManager.__Resource(e,i)}throw"Resource with id "+e+" not recognized as such. "+(t.length>1?" There is more than one raziel:entry URL.":" There is no raziel:entry URL.")},__createResource:function(e){var t=DataManager.query(new ERDF.Resource(""),{prefix:"raziel",name:"collection"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value,n=void 0,s=e?e:'<div xmlns="http://www.w3.org/1999/xhtml"></div>';return ResourceManager.__request("POST",i,s,function(){var e=this.responseXML,t=e.childNodes[0],i=t.getAttribute("id");$$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),$$("."+PROCESSDATA_REF)[0].appendChild(t.cloneNode(!0)),DataManager.__synclocal(),n=new ResourceManager.getResource(i),ResourceManager.__resourceActionSucceeded(this,RESOURCE_CREATED,void 0)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_CREATED,void 0)},!1),n}throw"Could not create resource! raziel:collection URL is missing!"},__Resource:function(e,t){this.__id=e,this.__url=t,this.id=function(){return this.__id},this.url=function(){return this.__url},this.reload=function(){var e=this.__url,t=this.__id;ResourceManager.__request("GET",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_RELOADED,t)},function(){ResourceManager.__resourceActionFailed(this,RESURCE_RELOADED,t)},USE_ASYNCHRONOUS_REQUESTS)},this.save=function(e){var t=this.__url,i=this.__id;data=DataManager.serialize($(i)),ResourceManager.__request("PUT",t,data,function(){ResourceManager.__resourceActionSucceeded(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE_SAVED,i)},function(){ResourceManager.__resourceActionFailed(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE.SAVED,i)},USE_ASYNCHRONOUS_REQUESTS)},this.remove=function(){var e=this.__url,t=this.__id;ResourceManager.__request("DELETE",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_REMOVED,t)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_REMOVED,t)},USE_ASYNCHRONOUS_REQUESTS)}},request:function(e,t){var i={method:"get",asynchronous:!0,parameters:{}};Object.extend(i,t||{});var n=Hash.toQueryString(i.parameters);return n&&(e+=(e.include("?")?"&":"?")+n),ResourceManager.__request(i.method,e,i.data,i.onSuccess instanceof Function?function(){i.onSuccess(this)}:void 0,i.onFailure instanceof Function?function(){i.onFailure(this)}:void 0,i.asynchronous&&USE_ASYNCHRONOUS_REQUESTS,i.headers)},__request:function(e,t,i,n,s,r,o){var a=Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")});if(!a){if(!this.__corrupt)throw"This browser does not provide any AJAX functionality. You will not be able to use the software provided with the page you are viewing. Please consider installing appropriate extensions.";return this.__corrupt=!0,!1}n instanceof Function&&(a.onload=n),s instanceof Function&&(a.onerror=s);var h=$H(o);h.keys().each(function(e){a.setRequestHeader(e,h[e])});try{SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(e+" "+t+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?i:""),a.open(e,t,r?!0:!1),a.send(i)}catch(l){return!1}return!0},__resourceActionSucceeded:function(e,t,i){var n=e.status,s=e.responseText;if(SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(n+" "+url+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?data:""),n>=300)throw"The server responded with an error: "+n+"\n"+(SHOW_EXTENDED_DEBUG_INFORMATION?+data:"If you need additional information here, including the data sent by the server, consider setting SHOW_EXTENDED_DEBUG_INFORMATION to true.");switch(t){case RESOURCE_REMOVED:var s=e.responseXML,r=s.childNodes[0],i=r.getAttribute("id"),o=document.getElementById(i);o.parentNode.removeChild(o);break;case RESOURCE_CREATED:break;case RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:DataManager.__synclocal();case RESOURCE_SAVED:break;case RESOURCE_RELOADED:var s=e.responseXML,r=s.childNodes[0],i=r.getAttribute("id"),o=document.getElementById(i);o.parentNode.removeChild(o),$$(PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),$$(PROCESSDATA_REF)[0].appendChild(r.cloneNode(!0)),DataManager.__synclocal();break;default:DataManager.__synclocal()}ResourceManager.__dispatchEvent(new ResourceManager.__Event(t,i))},__resourceActionFailed:function(){throw"Fatal: Resource action failed. There is something horribly wrong with either the server, the transport protocol or your online status. Sure you're online?"}},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.EditPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.x=0,this.y=0,this.oldX=0,this.oldY=0,this.deltaWidth=1,this.deltaHeight=1,this.d=""},init:function(e,t,i,n,s,r){this.x=e,this.y=t,this.oldX=i,this.oldY=n,this.deltaWidth=s,this.deltaHeight=r,this.d=""},editPointsAbs:function(e){if(e instanceof Array){for(var t,i,n=[],s=0;s<e.length;s++)t=(parseFloat(e[s])-this.oldX)*this.deltaWidth+this.x,s++,i=(parseFloat(e[s])-this.oldY)*this.deltaHeight+this.y,n.push(t),n.push(i);return n}},editPointsRel:function(e){if(e instanceof Array){for(var t,i,n=[],s=0;s<e.length;s++)t=parseFloat(e[s])*this.deltaWidth,s++,i=parseFloat(e[s])*this.deltaHeight,n.push(t),n.push(i);return n}},arcAbs:function(e,t,i,n,s,r,o){var a=this.editPointsAbs([r,o]),h=this.editPointsRel([e,t]);this.d=this.d.concat(" A"+h[0]+" "+h[1]+" "+i+" "+n+" "+s+" "+a[0]+" "+a[1]+" ")},arcRel:function(e,t,i,n,s,r,o){var a=this.editPointsRel([e,t,r,o]);this.d=this.d.concat(" a"+a[0]+" "+a[1]+" "+i+" "+n+" "+s+" "+a[2]+" "+a[3]+" ")},curvetoCubicAbs:function(e,t,i,n,s,r){var o=this.editPointsAbs([e,t,i,n,s,r]);this.d=this.d.concat(" C"+o[0]+" "+o[1]+" "+o[2]+" "+o[3]+" "+o[4]+" "+o[5]+" ")},curvetoCubicRel:function(e,t,i,n,s,r){var o=this.editPointsRel([e,t,i,n,s,r]);this.d=this.d.concat(" c"+o[0]+" "+o[1]+" "+o[2]+" "+o[3]+" "+o[4]+" "+o[5]+" ")},linetoHorizontalAbs:function(e){var t=this.editPointsAbs([e,0]);this.d=this.d.concat(" H"+t[0]+" ")},linetoHorizontalRel:function(e){var t=this.editPointsRel([e,0]);this.d=this.d.concat(" h"+t[0]+" ")},linetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" L"+i[0]+" "+i[1]+" ")},linetoRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" l"+i[0]+" "+i[1]+" ")},movetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" M"+i[0]+" "+i[1]+" ")},movetoRel:function(e,t){var i;i=""===this.d?this.editPointsAbs([e,t]):this.editPointsRel([e,t]),this.d=this.d.concat(" m"+i[0]+" "+i[1]+" ")},curvetoQuadraticAbs:function(e,t,i,n){var s=this.editPointsAbs([e,t,i,n]);this.d=this.d.concat(" Q"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoQuadraticRel:function(e,t,i,n){var s=this.editPointsRel([e,t,i,n]);this.d=this.d.concat(" q"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoCubicSmoothAbs:function(e,t,i,n){var s=this.editPointsAbs([e,t,i,n]);this.d=this.d.concat(" S"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoCubicSmoothRel:function(e,t,i,n){var s=this.editPointsRel([e,t,i,n]);this.d=this.d.concat(" s"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoQuadraticSmoothAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" T"+i[0]+" "+i[1]+" ")},curvetoQuadraticSmoothRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" t"+i[0]+" "+i[1]+" ")},linetoVerticalAbs:function(e){var t=this.editPointsAbs([0,e]);this.d=this.d.concat(" V"+t[1]+" ")},linetoVerticalRel:function(e){var t=this.editPointsRel([0,e]);this.d=this.d.concat(" v"+t[1]+" ")},closePath:function(){this.d=this.d.concat(" z")}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.MinMaxPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.minX=void 0,this.minY=void 0,this.maxX=void 0,this.maxY=void 0,this._lastAbsX=void 0,this._lastAbsY=void 0},calculateMinMax:function(e){if(e instanceof Array)for(var t,i,n=0;n<e.length;n++)t=parseFloat(e[n]),n++,i=parseFloat(e[n]),this.minX=void 0!==this.minX?Math.min(this.minX,t):t,this.maxX=void 0!==this.maxX?Math.max(this.maxX,t):t,this.minY=void 0!==this.minY?Math.min(this.minY,i):i,this.maxY=void 0!==this.maxY?Math.max(this.maxY,i):i,this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,n,s,r,o){this.calculateMinMax([r,o])},arcRel:function(e,t,i,n,s,r,o){this.calculateMinMax([this._lastAbsX+r,this._lastAbsY+o])},curvetoCubicAbs:function(e,t,i,n,s,r){this.calculateMinMax([e,t,i,n,s,r])},curvetoCubicRel:function(e,t,i,n,s,r){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n,this._lastAbsX+s,this._lastAbsY+r])},linetoHorizontalAbs:function(e){this.calculateMinMax([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.calculateMinMax([e,t])},linetoRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.calculateMinMax([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t]):this.calculateMinMax([e,t])},curvetoQuadraticAbs:function(e,t,i,n){this.calculateMinMax([e,t,i,n])},curvetoQuadraticRel:function(e,t,i,n){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n])},curvetoCubicSmoothAbs:function(e,t,i,n){this.calculateMinMax([e,t,i,n])},curvetoCubicSmoothRel:function(e,t,i,n){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n])},curvetoQuadraticSmoothAbs:function(e,t){this.calculateMinMax([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.calculateMinMax([this._lastAbsX,e])},linetoVerticalRel:function(e){this.calculateMinMax([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.PointsPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.points=[],this._lastAbsX=void 0,this._lastAbsY=void 0},addPoints:function(e){if(e instanceof Array)for(var t,i,n=0;n<e.length;n++)t=parseFloat(e[n]),n++,i=parseFloat(e[n]),this.points.push(t),this.points.push(i),this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,n,s,r,o){this.addPoints([r,o])},arcRel:function(e,t,i,n,s,r,o){this.addPoints([this._lastAbsX+r,this._lastAbsY+o])},curvetoCubicAbs:function(e,t,i,n,s,r){this.addPoints([s,r])},curvetoCubicRel:function(e,t,i,n,s,r){this.addPoints([this._lastAbsX+s,this._lastAbsY+r])},linetoHorizontalAbs:function(e){this.addPoints([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.addPoints([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.addPoints([e,t])},linetoRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.addPoints([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.addPoints([this._lastAbsX+e,this._lastAbsY+t]):this.addPoints([e,t])},curvetoQuadraticAbs:function(e,t,i,n){this.addPoints([i,n])},curvetoQuadraticRel:function(e,t,i,n){this.addPoints([this._lastAbsX+i,this._lastAbsY+n])},curvetoCubicSmoothAbs:function(e,t,i,n){this.addPoints([i,n])},curvetoCubicSmoothRel:function(e,t,i,n){this.addPoints([this._lastAbsX+i,this._lastAbsY+n])},curvetoQuadraticSmoothAbs:function(e,t){this.addPoints([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.addPoints([this._lastAbsX,e])},linetoVerticalRel:function(e){this.addPoints([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGMarker=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.id=void 0,this.element=e,this.refX=void 0,this.refY=void 0,this.markerWidth=void 0,this.markerHeight=void 0,this.oldRefX=void 0,this.oldRefY=void 0,this.oldMarkerWidth=void 0,this.oldMarkerHeight=void 0,this.optional=!1,this.enabled=!0,this.minimumLength=void 0,this.resize=!1,this.svgShapes=[],this._init()},_init:function(){if("[object SVGMarkerElement]"!=this.element)throw"SVGMarker: Argument is not an instance of SVGMarkerElement.";this.id=this.element.getAttributeNS(null,"id");var e=this.element.getAttributeNS(null,"refX");this.refX=e?parseFloat(e):0;var t=this.element.getAttributeNS(null,"refY");this.refY=t?parseFloat(t):0;var i=this.element.getAttributeNS(null,"markerWidth");this.markerWidth=i?parseFloat(i):3;var n=this.element.getAttributeNS(null,"markerHeight");this.markerHeight=n?parseFloat(n):3,this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight;var s=this.element.getAttributeNS(NAMESPACE_ORYX,"optional");s?(s=s.strip(),this.optional="yes"===s.toLowerCase()):this.optional=!1;var r=this.element.getAttributeNS(NAMESPACE_ORYX,"enabled");r?(r=r.strip(),this.enabled=!("no"===r.toLowerCase())):this.enabled=!0;var o=this.element.getAttributeNS(NAMESPACE_ORYX,"minimumLength");o&&(this.minimumLength=parseFloat(o));var a=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");a?(a=a.strip(),this.resize="yes"===a.toLowerCase()):this.resize=!1},_getSVGShapes:function(e){if(e.hasChildNodes){var t=[],i=this;return $A(e.childNodes).each(function(e){try{var n=new ORYX.Core.SVG.SVGShape(e);t.push(n)}catch(s){t=t.concat(i._getSVGShapes(e))}}),t}},update:function(){this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight},toString:function(){return this.element?"SVGMarker "+this.element.id:"SVGMarker "+this.element}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGShape=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.type,this.element=e,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.oldX=void 0,this.oldY=void 0,this.oldWidth=void 0,this.oldHeight=void 0,this.radiusX=void 0,this.radiusY=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.anchorLeft=!1,this.anchorRight=!1,this.anchorTop=!1,this.anchorBottom=!1,this.allowDockers=!0,this.resizeMarkerMid=!1,this.editPathParser,this.editPathHandler,this.init()},init:function(){if(ORYX.Editor.checkClassType(this.element,SVGRectElement)||ORYX.Editor.checkClassType(this.element,SVGImageElement)){this.type="Rect";var e=this.element.getAttributeNS(null,"x");if(!e)throw"Missing attribute in element "+this.element;this.oldX=parseFloat(e);var t=this.element.getAttributeNS(null,"y");if(!t)throw"Missing attribute in element "+this.element;this.oldY=parseFloat(t);var i=this.element.getAttributeNS(null,"width");if(!i)throw"Missing attribute in element "+this.element;this.oldWidth=parseFloat(i);var n=this.element.getAttributeNS(null,"height");if(!n)throw"Missing attribute in element "+this.element;this.oldHeight=parseFloat(n)}else if(ORYX.Editor.checkClassType(this.element,SVGCircleElement)){this.type="Circle";var s=void 0,r=void 0,o=this.element.getAttributeNS(null,"cx");if(!o)throw"Missing attribute in element "+this.element;s=parseFloat(o);var a=this.element.getAttributeNS(null,"cy");if(!a)throw"Missing attribute in element "+this.element;r=parseFloat(a);var h=this.element.getAttributeNS(null,"r");if(!h)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(h),this.oldX=s-this.radiusX,this.oldY=r-this.radiusX,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusX}else if(ORYX.Editor.checkClassType(this.element,SVGEllipseElement)){this.type="Ellipse";var s=void 0,r=void 0,o=this.element.getAttributeNS(null,"cx");if(!o)throw"Missing attribute in element "+this.element;s=parseFloat(o);var a=this.element.getAttributeNS(null,"cy");if(!a)throw"Missing attribute in element "+this.element;r=parseFloat(a);var l=this.element.getAttributeNS(null,"rx");if(!l)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(l);var c=this.element.getAttributeNS(null,"ry");if(!c)throw"Missing attribute in element "+this.element;this.radiusY=parseFloat(c),this.oldX=s-this.radiusX,this.oldY=r-this.radiusY,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusY}else if(ORYX.Editor.checkClassType(this.element,SVGLineElement)){this.type="Line";var d=void 0,u=void 0,g=void 0,f=void 0,p=this.element.getAttributeNS(null,"x1");if(!p)throw"Missing attribute in element "+this.element;d=parseFloat(p);var O=this.element.getAttributeNS(null,"y1");if(!O)throw"Missing attribute in element "+this.element;u=parseFloat(O);var m=this.element.getAttributeNS(null,"x2");if(!m)throw"Missing attribute in element "+this.element;g=parseFloat(m);var _=this.element.getAttributeNS(null,"y2");if(!_)throw"Missing attribute in element "+this.element;f=parseFloat(_),this.oldX=Math.min(d,g),this.oldY=Math.min(u,f),this.oldWidth=Math.abs(d-g),this.oldHeight=Math.abs(u-f)}else if(ORYX.Editor.checkClassType(this.element,SVGPolylineElement)||ORYX.Editor.checkClassType(this.element,SVGPolygonElement)){this.type="Polyline";var R=this.element.getAttributeNS(null,"points");if(!R)throw"Missing attribute in element "+this.element;R=R.replace(/,/g," ");var E=R.split(" ");if(E=E.without(""),!(E&&E.length&&E.length>1))throw"Missing attribute in element "+this.element;for(var S=parseFloat(E[0]),v=parseFloat(E[1]),b=parseFloat(E[0]),C=parseFloat(E[1]),N=0;N<E.length;N++)S=Math.min(S,parseFloat(E[N])),b=Math.max(b,parseFloat(E[N])),N++,v=Math.min(v,parseFloat(E[N])),C=Math.max(C,parseFloat(E[N]));this.oldX=S,this.oldY=v,this.oldWidth=b-S,this.oldHeight=C-v}else{if(!ORYX.Editor.checkClassType(this.element,SVGPathElement))throw"Element is not a shape.";this.type="Path",this.editPathParser=new PathParser,this.editPathHandler=new ORYX.Core.SVG.EditPathHandler,this.editPathParser.setHandler(this.editPathHandler);var y=new PathParser,Y=new ORYX.Core.SVG.MinMaxPathHandler;y.setHandler(Y),y.parsePath(this.element),this.oldX=Y.minX,this.oldY=Y.minY,this.oldWidth=Y.maxX-Y.minX,this.oldHeight=Y.maxY-Y.minY,delete y,delete Y}var X=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");X?(X=X.toLowerCase(),this.isHorizontallyResizable=X.match(/horizontal/)?!0:!1,this.isVerticallyResizable=X.match(/vertical/)?!0:!1):(this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1);var A=this.element.getAttributeNS(NAMESPACE_ORYX,"anchors");if(A){A=A.replace("/,/g"," ");for(var I=A.split(" ").without(""),N=0;N<I.length;N++)switch(I[N].toLowerCase()){case"left":this.anchorLeft=!0;break;case"right":this.anchorRight=!0;break;case"top":this.anchorTop=!0;break;case"bottom":this.anchorBottom=!0}}if(ORYX.Editor.checkClassType(this.element,SVGPathElement)){var x=this.element.getAttributeNS(NAMESPACE_ORYX,"allowDockers");x&&(this.allowDockers="no"===x.toLowerCase()?!1:!0);var T=this.element.getAttributeNS(NAMESPACE_ORYX,"resizeMarker-mid");T&&(this.resizeMarkerMid="yes"===T.toLowerCase()?!0:!1)}this.x=this.oldX,this.y=this.oldY,this.width=this.oldWidth,this.height=this.oldHeight},update:function(){if(this.x!==this.oldX||this.y!==this.oldY||this.width!==this.oldWidth||this.height!==this.oldHeight){switch(this.type){case"Rect":this.x!==this.oldX&&this.element.setAttributeNS(null,"x",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y",this.y),this.width!==this.oldWidth&&this.element.setAttributeNS(null,"width",this.width),this.height!==this.oldHeight&&this.element.setAttributeNS(null,"height",this.height);break;case"Circle":this.radiusX=(this.width<this.height?this.width:this.height)/2,this.element.setAttributeNS(null,"cx",this.x+this.width/2),this.element.setAttributeNS(null,"cy",this.y+this.height/2),this.element.setAttributeNS(null,"r",this.radiusX);break;case"Ellipse":this.radiusX=this.width/2,this.radiusY=this.height/2,this.element.setAttributeNS(null,"cx",this.x+this.radiusX),this.element.setAttributeNS(null,"cy",this.y+this.radiusY),this.element.setAttributeNS(null,"rx",this.radiusX),this.element.setAttributeNS(null,"ry",this.radiusY);break;case"Line":this.x!==this.oldX&&this.element.setAttributeNS(null,"x1",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y1",this.y),(this.x!==this.oldX||this.width!==this.oldWidth)&&this.element.setAttributeNS(null,"x2",this.x+this.width),(this.y!==this.oldY||this.height!==this.oldHeight)&&this.element.setAttributeNS(null,"y2",this.y+this.height);break;case"Polyline":var e=this.element.getAttributeNS(null,"points");if(e&&(e=e.replace(/,/g," ").split(" ").without(""),e&&e.length&&e.length>1)){for(var t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight,n="",s=0;s<e.length;s++){var r=(parseFloat(e[s])-this.oldX)*t+this.x;s++;var o=(parseFloat(e[s])-this.oldY)*i+this.y;n+=r+" "+o+" "}this.element.setAttributeNS(null,"points",n)}break;case"Path":var t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight;this.editPathHandler.init(this.x,this.y,this.oldX,this.oldY,t,i),this.editPathParser.parsePath(this.element),this.element.setAttributeNS(null,"d",this.editPathHandler.d)}this.oldX=this.x,this.oldY=this.y,this.oldWidth=this.width,this.oldHeight=this.height}},isPointIncluded:function(e,t){if(!e||!t||!this.isVisible())return!1;switch(this.type){case"Rect":return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height;case"Circle":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.width/2,this.y+this.height/2,this.radiusX,this.radiusX);case"Ellipse":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.radiusX,this.y+this.radiusY,this.radiusX,this.radiusY);case"Line":return ORYX.Core.Math.isPointInLine(e,t,this.x,this.y,this.x+this.width,this.y+this.height);case"Polyline":var i=this.element.getAttributeNS(null,"points");return i?(i=i.replace(/,/g," ").split(" ").without(""),i=i.collect(function(e){return parseFloat(e)}),ORYX.Core.Math.isPointInPolygone(e,t,i)):!1;case"Path":var n=new PathParser,s=new ORYX.Core.SVG.PointsPathHandler;return n.setHandler(s),n.parsePath(this.element),ORYX.Core.Math.isPointInPolygone(e,t,s.points);default:return!1}},isVisible:function(e){e||(e=this.element);var t=!1;try{t=!!e.ownerSVGElement}catch(i){}if(t){if(ORYX.Editor.checkClassType(e,SVGGElement)&&e.className&&"me"==e.className.baseVal)return!0;var n=e.getAttributeNS(null,"fill"),s=e.getAttributeNS(null,"stroke");if(n&&"none"==n&&s&&"none"==s)return!1;var r=e.getAttributeNS(null,"display");return r?"none"==r?!1:!0:this.isVisible(e.parentNode)}return!0},toString:function(){return this.element?"SVGShape "+this.element.id:"SVGShape "+this.element}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.Label=Clazz.extend({_characterSets:["%W","@","m","wDGMOQ#+=<>~^","ABCHKNRSUVXZ&","bdghnopquxETY1234567890_${}*`","aeksvyzFLP?","c-",'rtJ"/()[]:;!|\\',"fjI., ","'","il"],_characterSetValues:[15,14,13,11,10,9,8,7,6,5,4,3],construct:function(e){if(arguments.callee.$.construct.apply(this,arguments),!e.textElement)throw"Label: No parameter textElement.";if(!ORYX.Editor.checkClassType(e.textElement,SVGTextElement))throw"Label: Parameter textElement is not an SVGTextElement.";this.invisibleRenderPoint=-5e3,this.node=e.textElement,this.node.setAttributeNS(null,"stroke-width","0pt"),this.node.setAttributeNS(null,"letter-spacing","-0.01px"),this.shapeId=e.shapeId,this.id,this.fitToElemId,this.edgePosition,this.x,this.y,this.oldX,this.oldY,this.isVisible=!0,this._text,this._verticalAlign,this._horizontalAlign,this._rotate,this._rotationPoint,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this._isChanged=!0;var t=this.node.getAttributeNS(null,"id");t&&(this.id=t),this.fitToElemId=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"fittoelem"),this.fitToElemId&&(this.fitToElemId=this.shapeId+this.fitToElemId);var i=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"align");i&&(i=i.replace(/,/g," "),i=i.split(" "),i=i.without(""),i.each(function(e){switch(e){case"top":case"middle":case"bottom":this._verticalAlign||(this._verticalAlign=e);break;case"left":case"center":case"right":this._horizontalAlign||(this._horizontalAlign=e)}}.bind(this))),this.edgePosition=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"edgePosition"),this.edgePosition&&(this.edgePosition=this.edgePosition.toLowerCase()),this.offsetTop=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetTop")||ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP,this.offsetTop&&(this.offsetTop=parseInt(this.offsetTop)),this.offsetBottom=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetBottom")||ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM,this.offsetBottom&&(this.offsetBottom=parseInt(this.offsetBottom));var n=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"rotate");if(n)try{this._rotate=parseFloat(n)}catch(s){this._rotate=0}else this._rotate=0;var r=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(r){r=r.replace("/,/g"," ");for(var o=r.split(" ").without(""),a=0;a<o.length;a++)switch(o[a].toLowerCase()){case"left":this.anchorLeft=!0;break;case"right":this.anchorRight=!0;break;case"top":this.anchorTop=!0;break;case"bottom":this.anchorBottom=!0}}this._verticalAlign||(this._verticalAlign="bottom"),this._horizontalAlign||(this._horizontalAlign="left");var h=this.node.getAttributeNS(null,"x");h&&(this.x=parseFloat(h),this.oldX=this.x);var l=this.node.getAttributeNS(null,"y");l&&(this.y=parseFloat(l),this.oldY=this.y),this.text(this.node.textContent)},changed:function(){this._isChanged=!0},update:function(){if(this._isChanged||this.x!==this.oldX||this.y!==this.oldY)if(this.isVisible){switch(this._isChanged=!1,this.node.setAttributeNS(null,"x",this.x),this.node.setAttributeNS(null,"y",this.y),this._fontSize&&this.node.setAttributeNS(null,"font-size",this._fontSize),this._horizontalAlign){case"left":this.node.setAttributeNS(null,"text-anchor","start");break;case"center":this.node.setAttributeNS(null,"text-anchor","middle");break;case"right":this.node.setAttributeNS(null,"text-anchor","end")}this.oldX=this.x,this.oldY=this.y,void 0!==this._rotate&&(this._rotationPoint?this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+this._rotationPoint.x+" "+this._rotationPoint.y+")"):this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+this.x+" "+this.y+")"));for(var e=this._text.split("\n");""==e.last();)e.pop();this.node.textContent="",this.node.ownerDocument&&(e.each(function(e){var t=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");t.textContent=e,t.setAttributeNS(null,"x",this.invisibleRenderPoint),t.setAttributeNS(null,"y",this.invisibleRenderPoint),""===t.textContent&&(t.textContent=" "),this.node.appendChild(t)}.bind(this)),this.isVisible&&this.node.setAttributeNS(null,"visibility","hidden"),this.fitToElemId?window.setTimeout(this._checkFittingToReferencedElem.bind(this),0):window.setTimeout(this._positionText.bind(this),0))}else this.node.textContent=""},_checkFittingToReferencedElem:function(){try{var e=$A(this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")),t=[],i=this.node.ownerDocument.getElementById(this.fitToElemId);if(i){for(var n=i.getBBox(),s=this.getFontSize(),r=0;r<e.length;r++){var o=e[r],a=this._getRenderedTextLength(o,void 0,void 0,s),h=0!=this._rotate&&0!=this._rotate%180&&0==this._rotate%90?n.height:n.width;
if(a>h){for(var l=0,c=0,d=this.getTrimmedTextLength(o.textContent),u=0;d>u;u++){var g=this._getRenderedTextLength(o,l,u-l,s);if(g>h-3){var f=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");l>=c?(c=0==u?u:u-1,f.textContent=o.textContent.slice(l,c)):f.textContent=o.textContent.slice(l,++c),f.setAttributeNS(null,"x",this.invisibleRenderPoint),f.setAttributeNS(null,"y",this.invisibleRenderPoint),t.push(f),l=c}else{var p=o.textContent.charAt(u);(" "==p||"-"==p||"."==p||","==p||";"==p||":"==p)&&(c=u)}}o.textContent=o.textContent.slice(l)}t.push(o)}for(;this.node.hasChildNodes();)this.node.removeChild(this.node.childNodes[0]);for(;t.length>0;)this.node.appendChild(t.shift())}}catch(O){}window.setTimeout(this._positionText.bind(this),0)},_positionText:function(){try{var e=this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan"),t=this.getFontSize(this.node),i=[];$A(e).each(function(n,s){if(""===n.textContent.trim())i.push(n);else{var r=0;switch(this._verticalAlign){case"bottom":r=-(e.length-s-1)*t;break;case"middle":r=-(e.length/2-s-1)*t,r-=ORYX.CONFIG.LABEL_LINE_DISTANCE/2;break;case"top":r=s*t,r+=t}n.setAttributeNS(null,"dy",r),n.setAttributeNS(null,"x",this.x),n.setAttributeNS(null,"y",this.y)}}.bind(this)),i.each(function(e){this.node.removeChild(e)}.bind(this))}catch(n){this._isChanged=!0}this.isVisible&&this.node.setAttributeNS(null,"visibility","inherit")},_getRenderedTextLength:function(e,t,i,n){return/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)>=3?void 0===t?e.getComputedTextLength():e.getSubStringLength(t,i):void 0===t?this._estimateTextWidth(e.textContent,n):this._estimateTextWidth(e.textContent.substr(t,i).trim(),n)},_estimateTextWidth:function(e,t){for(var i=0,n=0;n<e.length;n++)i+=this._estimateCharacterWidth(e.charAt(n));return i*(t/14)},_estimateCharacterWidth:function(e){for(var t=0;t<this._characterSets.length;t++)if(this._characterSets[t].indexOf(e)>=0)return this._characterSetValues[t];return 9},getReferencedElementWidth:function(){var e=this.node.ownerDocument.getElementById(this.fitToElemId);if(e){var t=e.getBBox();return t?t.width:void 0}return void 0},text:function(){switch(arguments.length){case 0:return this._text;case 1:var e=this._text;this._text=arguments[0]?arguments[0].toString():"",e!==this._text&&(this._isChanged=!0)}},fontSize:function(){switch(arguments.length){case 0:return this._fontSize;case 1:var e=this._fontSize;this._fontSize=arguments[0]?arguments[0].toString():12,e!==this._fontSize&&(this._isChanged=!0)}},verticalAlign:function(){switch(arguments.length){case 0:return this._verticalAlign;case 1:if(["top","middle","bottom"].member(arguments[0])){var e=this._verticalAlign;this._verticalAlign=arguments[0],this._verticalAlign!==e&&(this._isChanged=!0)}}},horizontalAlign:function(){switch(arguments.length){case 0:return this._horizontalAlign;case 1:if(["left","center","right"].member(arguments[0])){var e=this._horizontalAlign;this._horizontalAlign=arguments[0],this._horizontalAlign!==e&&(this._isChanged=!0)}}},rotate:function(){switch(arguments.length){case 0:return this._rotate;case 1:this._rotate!=arguments[0]&&(this._rotate=arguments[0],this._rotationPoint=void 0,this._isChanged=!0);case 2:this._rotate==arguments[0]&&this._rotationPoint&&this._rotationPoint.x==arguments[1].x&&this._rotationPoint.y==arguments[1].y||(this._rotate=arguments[0],this._rotationPoint=arguments[1],this._isChanged=!0)}},hide:function(){this.isVisible&&(this.isVisible=!1,this._isChanged=!0)},show:function(){this.isVisible||(this.isVisible=!0,this._isChanged=!0)},getInheritedFontSize:function(e){if(e&&e.getAttributeNS){var t=e.getAttributeNS(null,"font-size");return t?parseFloat(t):ORYX.Editor.checkClassType(e,SVGSVGElement)?void 0:this.getInheritedFontSize(e.parentNode)}},getFontSize:function(){var e=this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan"),t=this.getInheritedFontSize(this.node);return t||(t=e[0]&&/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)>=3?e[0].getExtentOfChar(0).height:ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT,0>=t&&(t=ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT)),t&&this.node.setAttribute("oryx:fontSize",t),t},getTrimmedTextLength:function(e){e=e.strip().gsub("  "," ");var t;do t=e.length,e=e.gsub("  "," ");while(t>e.length);return e.length},getOffsetBottom:function(){return this.offsetBottom},getOffsetTop:function(){return this.offsetTop},toString:function(){return"Label "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Math||(ORYX.Core.Math={}),ORYX.Core.Math.midPoint=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},ORYX.Core.Math.isPointInLine=function(e,t,i,n,s,r,o){if(o=o?Math.abs(o):1,Math.abs(i-s)<=o&&Math.abs(e-i)<=o&&t-Math.max(n,r)<=o&&Math.min(n,r)-t<=o)return!0;if(Math.abs(n-r)<=o&&Math.abs(t-n)<=o&&e-Math.max(i,s)<=o&&Math.min(i,s)-e<=o)return!0;if(e>Math.max(i,s)||e<Math.min(i,s))return!1;if(t>Math.max(n,r)||t<Math.min(n,r))return!1;var a=(n-r)/(i-s);return Math.abs(t-(a*e+n-a*i))<o},ORYX.Core.Math.isPointInEllipse=function(e,t,i,n,s,r){if(void 0===i||void 0===n||void 0===s||void 0===r)throw"ORYX.Core.Math.isPointInEllipse needs a ellipse with these properties: x, y, radiusX, radiusY";var o=(e-i)/s,a=(t-n)/r;return 1>o*o+a*a},ORYX.Core.Math.isPointInPolygone=function(e,t,i){if(arguments.length<3)throw"ORYX.Core.Math.isPointInPolygone needs two arguments";var n=i.length-1;(i[0]!==i[n-1]||i[1]!==i[n])&&(i.push(i[0]),i.push(i[1]));for(var s,r,o,a,h,l=0,c=0;c<i.length-3;)if(s=i[c],r=i[++c],o=i[++c],a=i[c+1],h=(t-r)*(o-s)-(e-s)*(a-r),r>=t!=a>=t&&(l+=a-r>=0?h>=0:0>=h),!h&&Math.min(s,o)<=e&&e<=Math.max(s,o)&&Math.min(r,a)<=t&&t<=Math.max(r,a))return!0;return l%2?!0:!1},ORYX.Core.Math.distancePointLinie=function(e,t,i,n){var s=ORYX.Core.Math.getPointOfIntersectionPointLine(e,t,i,n);return s?ORYX.Core.Math.getDistancePointToPoint(i,s):null},ORYX.Core.Math.getDistancePointToPoint=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},ORYX.Core.Math.getPointOfIntersectionPointLine=function(e,t,i,n){var s=Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2);if(0==s)return void 0;var r=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/s;return!n||r>=0&&1>=r?(pointOfIntersection=new Object,pointOfIntersection.x=e.x+r*(t.x-e.x),pointOfIntersection.y=e.y+r*(t.y-e.y),pointOfIntersection):void 0},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Stencil={construct:function(e,t,i,n,s,r){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"Stencilset seems corrupt.";if(!t)throw"Stencil does not provide namespace.";if(!i)throw"Stencil does not provide SVG source.";if(!n)throw"Fatal internal error loading stencilset.";if(this._source=i,this._jsonStencil=e,this._stencilSet=n,this._namespace=t,this._propertyPackages=s,r&&!this._jsonStencil.position&&(this._jsonStencil.position=r),this._view,this._properties=new Hash,!this._jsonStencil.type||"edge"!==this._jsonStencil.type&&"node"!==this._jsonStencil.type)throw"ORYX.Core.StencilSet.Stencil(construct): Type is not defined.";if(!this._jsonStencil.id||""===this._jsonStencil.id)throw"ORYX.Core.StencilSet.Stencil(construct): Id is not defined.";if(!this._jsonStencil.title||""===this._jsonStencil.title)throw"ORYX.Core.StencilSet.Stencil(construct): Title is not defined.";if(this._jsonStencil.description||(this._jsonStencil.description=""),this._jsonStencil.groups||(this._jsonStencil.groups=[]),this._jsonStencil.roles||(this._jsonStencil.roles=[]),this._jsonStencil.roles.push(this._jsonStencil.id),this._jsonStencil.roles.each(function(e,i){this._jsonStencil.roles[i]=t+e}.bind(this)),this._jsonStencil.roles=this._jsonStencil.roles.uniq(),this._jsonStencil.id=t+this._jsonStencil.id,this.postProcessProperties(),this._jsonStencil.serialize||(this._jsonStencil.serialize={}),this._jsonStencil.deserialize||(this._jsonStencil.deserialize={}),this._jsonStencil.layout||(this._jsonStencil.layout=[]),void 0===e.view);else if("/"==e.view.charAt(0))var o=e.view;else var o=i+"view/"+e.view;if(this._jsonStencil.view)if(this._jsonStencil.view.trim().match(/</)){var a=new DOMParser,h=a.parseFromString(this._jsonStencil.view,"text/xml");if(!ORYX.Editor.checkClassType(h.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a SVG document.";this._view=h.documentElement;var l=this._view.getElementsByTagNameNS("http://www.w3.org/2000/svg","image");$A(l).each(function(e){var t=e.getAttributeNodeNS("http://www.w3.org/1999/xlink","href");t&&-1==t.value.indexOf("://")&&-1==t.value.indexOf("base64")&&(t.textContent=this._source+"view/"+t.value)}.bind(this))}else new Ajax.Request(o,{asynchronous:!1,method:"get",onSuccess:this._loadSVGOnSuccess.bind(this),onFailure:this._loadSVGOnFailure.bind(this)})},postProcessProperties:function(){this._jsonStencil.icon?"/"===this._jsonStencil.icon.charAt(0)||-1===this._jsonStencil.icon.indexOf("://")&&-1===this._jsonStencil.icon.indexOf("base64")&&(this._jsonStencil.icon=this._source+"icons/"+this._jsonStencil.icon):this._jsonStencil.icon="",this._jsonStencil.propertyPackages&&this._jsonStencil.propertyPackages instanceof Array&&this._jsonStencil.propertyPackages.each(function(e){var t=this._propertyPackages[e];t&&t.each(function(e){var t=new ORYX.Core.StencilSet.Property(e,this._namespace,this);this._properties[t.prefix()+"-"+t.id()]=t}.bind(this))}.bind(this)),this._jsonStencil.properties&&this._jsonStencil.properties instanceof Array&&this._jsonStencil.properties.each(function(e){var t=new ORYX.Core.StencilSet.Property(e,this._namespace,this);this._properties[t.prefix()+"-"+t.id()]=t}.bind(this))},equals:function(e){return this.id()===e.id()},stencilSet:function(){return this._stencilSet},type:function(){return this._jsonStencil.type},namespace:function(){return this._namespace},id:function(){return this._jsonStencil.id},idWithoutNs:function(){return this.id().replace(this.namespace(),"")},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"description")},groups:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"groups")},position:function(){return isNaN(this._jsonStencil.position)?0:this._jsonStencil.position},view:function(){return this._view.cloneNode(!0)||this._view},hidden:function(){return this._jsonStencil.hide},icon:function(){return this._jsonStencil.icon},fixedAspectRatio:function(){return this._jsonStencil.fixedAspectRatio===!0},hasMultipleRepositoryEntries:function(){return this.getRepositoryEntries().length>0},getRepositoryEntries:function(){return this._jsonStencil.repositoryEntries?$A(this._jsonStencil.repositoryEntries):$A([])},properties:function(){return this._properties.values()},property:function(e){return this._properties[e]},roles:function(){return this._jsonStencil.roles},defaultAlign:function(){return this._jsonStencil.defaultAlign?this._jsonStencil.defaultAlign:"east"},serialize:function(){return this._jsonStencil.serialize},deserialize:function(){return this._jsonStencil.deserialize},layout:function(){return this._jsonStencil.layout},addProperty:function(e,t){if(e&&t){var i=new ORYX.Core.StencilSet.Property(e,t,this);this._properties[i.prefix()+"-"+i.id()]=i}},removeProperty:function(e){if(e){var t=this._properties.values().find(function(t){return e==t.id()});t&&delete this._properties[t.prefix()+"-"+t.id()]}},_loadSVGOnSuccess:function(e){var t=null;if(t=e.responseXML,!ORYX.Editor.checkClassType(t.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a SVG document.";this._view=t.documentElement;var i=this._view.getElementsByTagNameNS("http://www.w3.org/2000/svg","image");$A(i).each(function(e){var t=e.getAttributeNodeNS("http://www.w3.org/1999/xlink","href");t&&-1==t.value.indexOf("://")&&-1==t.value.indexOf("base64")&&(t.textContent=this._source+"view/"+t.value)}.bind(this))},_loadSVGOnFailure:function(){throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnFailure): Loading SVG document failed."},toString:function(){return"Stencil "+this.title()+" ("+this.id()+")"}},ORYX.Core.StencilSet.Stencil=Clazz.extend(ORYX.Core.StencilSet.Stencil),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Property=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),this._jsonProp=e||ORYX.Log.error("Parameter jsonProp is not defined."),this._namespace=t||ORYX.Log.error("Parameter namespace is not defined."),this._stencil=i||ORYX.Log.error("Parameter stencil is not defined."),this._items=new Hash,this._complexItems=new Hash,e.id=e.id||ORYX.Log.error("ORYX.Core.StencilSet.Property(construct): Id is not defined."),e.id=e.id.toLowerCase(),e.type?e.type=e.type.toLowerCase():(ORYX.Log.info("Type is not defined for stencil '%0', id '%1'. Falling back to 'String'.",i,e.id),e.type="string"),e.prefix=e.prefix||"oryx",e.title=e.title||"",e.value=e.value||"",e.description=e.description||"",e.readonly=e.readonly||!1,0!=e.optional&&(e.optional=!0),this._jsonProp.refToView?this._jsonProp.refToView instanceof Array||(this._jsonProp.refToView=[this._jsonProp.refToView]):this._jsonProp.refToView=[],(void 0===e.min||null===e.min)&&(e.min=Number.MIN_VALUE),(void 0===e.max||null===e.max)&&(e.max=Number.MAX_VALUE),e.fillOpacity||(e.fillOpacity=!1),e.strokeOpacity||(e.strokeOpacity=!1),(void 0===e.length||null===e.length)&&(e.length=Number.MAX_VALUE),e.wrapLines||(e.wrapLines=!1),e.dateFormat||(e.dataFormat="m/d/y"),e.fill||(e.fill=!1),e.stroke||(e.stroke=!1),e.inverseBoolean||(e.inverseBoolean=!1),e.directlyEditable||0==e.directlyEditable||(e.directlyEditable=!0),e.visible||(e.visible=!0),e.fortasktypes||(e.fortasktypes=""),e.ifproptrue||(e.ifproptrue=""),e.fordistribution||(e.fordistribution=""),e.popular||(e.popular=!1),e.simulation||(e.simulation=!1),e.complexItems&&e.complexItems instanceof Array&&e.complexItems.each(function(i){try{this._complexItems[i.id]=new ORYX.Core.StencilSet.ComplexPropertyItem(i,t,this)}catch(n){ORYX.Log.error("error while initializing complex items for "+e.title),ORYX.Log.error(n)}}.bind(this)),e.type===ORYX.CONFIG.TYPE_CHOICE||e.type===ORYX.CONFIG.TYPE_DYNAMICCHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}if(e.type===ORYX.CONFIG.TYPE_COMPLEX&&void 0===e.complexItems)throw"ORYX.Core.StencilSet.Property(construct): No complex property items defined.";e.labelProvider&&(this._labelProvider=e.labelProvider.transform)},equals:function(e){return this._namespace===e.namespace()&&this.id()===e.id()?!0:!1},namespace:function(){return this._namespace},stencil:function(){return this._stencil},id:function(){return this._jsonProp.id},prefix:function(){return this._jsonProp.prefix},type:function(){return this._jsonProp.type},inverseBoolean:function(){return this._jsonProp.inverseBoolean},popular:function(){return this._jsonProp.popular},simulation:function(){return this._jsonProp.simulation},setPopular:function(){this._jsonProp.popular=!0},setSimulation:function(){this._jsonProp.simulation=!0},directlyEditable:function(){return this._jsonProp.directlyEditable},visible:function(){return this._jsonProp.visible},fortasktypes:function(){return this._jsonProp.fortasktypes},ifproptrue:function(){return this._jsonProp.ifproptrue},fordistribution:function(){return this._jsonProp.fordistribution},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"title")},value:function(){return this._jsonProp.value},readonly:function(){return this._jsonProp.readonly},optional:function(){return this._jsonProp.optional},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"description")},refToView:function(){return this._jsonProp.refToView},min:function(){return this._jsonProp.min},max:function(){return this._jsonProp.max},fillOpacity:function(){return this._jsonProp.fillOpacity},strokeOpacity:function(){return this._jsonProp.strokeOpacity},length:function(){return this._jsonProp.length?this._jsonProp.length:Number.MAX_VALUE},wrapLines:function(){return this._jsonProp.wrapLines},dateFormat:function(){return this._jsonProp.dateFormat},fill:function(){return this._jsonProp.fill},stroke:function(){return this._jsonProp.stroke},items:function(){return this._items.values()},item:function(e){return this._items[e]},toString:function(){return"Property "+this.title()+" ("+this.id()+")"},complexItems:function(){return this._complexItems.values()},complexItem:function(e){return this._complexItems[e]},complexAttributeToView:function(){return this._jsonProp.complexAttributeToView||""},labelProvider:function(){return this._labelProvider}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.PropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,!e.value)throw"ORYX.Core.StencilSet.PropertyItem(construct): Value is not defined.";this._jsonItem.refToView?this._jsonItem.refToView instanceof Array||(this._jsonItem.refToView=[this._jsonItem.refToView]):this._jsonItem.refToView=[]},equals:function(e){return this.property().equals(e.property())&&this.value()===e.value()},namespace:function(){return this._namespace},property:function(){return this._property},value:function(){return this._jsonItem.value},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"title")},refToView:function(){return this._jsonItem.refToView},icon:function(){return this._jsonItem.icon?this.property().stencil()._source+"icons/"+this._jsonItem.icon:""},toString:function(){return"PropertyItem "+this.property()+" ("+this.value()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.ComplexPropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,this._items=new Hash,!e.name)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Name is not defined.";if(!e.type)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Type is not defined.";if(e.type=e.type.toLowerCase(),e.type===ORYX.CONFIG.TYPE_CHOICE||e.type===ORYX.CONFIG.TYPE_DYNAMICCHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}},equals:function(e){return this.property().equals(e.property())&&this.name()===e.name()},namespace:function(){return this._namespace},property:function(){return this._property},name:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"name")},id:function(){return this._jsonItem.id},type:function(){return this._jsonItem.type},optional:function(){return this._jsonItem.optional},width:function(){return this._jsonItem.width},value:function(){return this._jsonItem.value},items:function(){return this._items.values()},disable:function(){return this._jsonItem.disable}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Rules={construct:function(){arguments.callee.$.construct.apply(this,arguments),this._stencilSets=[],this._stencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash},initializeRules:function(e){var t=this._stencilSets.find(function(t){return t.namespace()==e.namespace()});if(t){var n=this._stencilSets.clone();return n=n.without(t),n.push(e),this._stencilSets=[],this._stencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash,n.each(function(e){this.initializeRules(e)}.bind(this)),void 0}this._stencilSets.push(e);var s=new Hash(e.jsonRules()),r=e.namespace(),o=e.stencils();e.extensions().values().each(function(e){e.rules&&(e.rules.connectionRules&&(s.connectionRules=s.connectionRules.concat(e.rules.connectionRules)),e.rules.cardinalityRules&&(s.cardinalityRules=s.cardinalityRules.concat(e.rules.cardinalityRules)),e.rules.containmentRules&&(s.containmentRules=s.containmentRules.concat(e.rules.containmentRules)),e.rules.morphingRules&&(s.morphingRules=s.morphingRules.concat(e.rules.morphingRules))),e.stencils&&(o=o.concat(e.stencils))}),this._stencils=this._stencils.concat(e.stencils());var a=this._connectionRules;s.connectionRules&&s.connectionRules.each(function(e){this._isRoleOfOtherNamespace(e.role)?a[e.role]||(a[e.role]=new Hash):a[r+e.role]||(a[r+e.role]=new Hash),e.connects.each(function(t){var i=[];t.to&&(t.to instanceof Array||(t.to=[t.to]),t.to.each(function(e){this._isRoleOfOtherNamespace(e)?i.push(e):i.push(r+e)}.bind(this)));var n,s;n=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,s=this._isRoleOfOtherNamespace(t.from)?t.from:r+t.from,a[n][s]=a[n][s]?a[n][s].concat(i):i}.bind(this))}.bind(this));var h=this._cardinalityRules;s.cardinalityRules&&s.cardinalityRules.each(function(e){var t;if(t=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,!h[t]){h[t]={};for(i in e)h[t][i]=e[i]}var n=new Hash;e.outgoingEdges&&e.outgoingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?n[e.role]=e:n[r+e.role]=e}.bind(this)),h[t].outgoingEdges=n;var s=new Hash;e.incomingEdges&&e.incomingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?s[e.role]=e:s[r+e.role]=e}.bind(this)),h[t].incomingEdges=s}.bind(this));var l=this._containmentRules;s.containmentRules&&s.containmentRules.each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,l[t]||(l[t]=[]),e.contains.each(function(e){this._isRoleOfOtherNamespace(e)?l[t].push(e):l[t].push(r+e)}.bind(this))}.bind(this));var c=this._morphingRules;s.morphingRules&&s.morphingRules.each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,c[t]||(c[t]=[]),e.preserveBounds||(e.preserveBounds=!1),e.baseMorphs.each(function(e){c[t].push(this._getStencilById(r+e))}.bind(this))}.bind(this));var d=this._layoutRules;if(s.layoutRules){var u=function(e){return{edgeRole:e.edgeRole||void 0,t:e.t||1,r:e.r||1,b:e.b||1,l:e.l||1}};s.layoutRules.each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:r+e.role,d[t]||(d[t]={}),e["in"]&&(d[t]["in"]=u(e["in"])),e.ins&&(d[t].ins=(e.ins||[]).map(function(e){return u(e)})),e.out&&(d[t].out=u(e.out)),e.outs&&(d[t].outs=(e.outs||[]).map(function(e){return u(e)}))}.bind(this))}},_getStencilById:function(e){return this._stencils.find(function(t){return t.id()==e})},_cacheConnect:function(e){if(result=this._canConnect(e),e.sourceStencil&&e.targetStencil){var t=this._cachedConnectSET[e.sourceStencil.id()];t||(t=new Hash,this._cachedConnectSET[e.sourceStencil.id()]=t);var i=t[e.edgeStencil.id()];i||(i=new Hash,t[e.edgeStencil.id()]=i),i[e.targetStencil.id()]=result}else if(e.sourceStencil){var t=this._cachedConnectSE[e.sourceStencil.id()];t||(t=new Hash,this._cachedConnectSE[e.sourceStencil.id()]=t),t[e.edgeStencil.id()]=result}else{var n=this._cachedConnectTE[e.targetStencil.id()];n||(n=new Hash,this._cachedConnectTE[e.targetStencil.id()]=n),n[e.edgeStencil.id()]=result}return result},_cacheCard:function(e){if(e.sourceStencil){var t=this._cachedCardSE[e.sourceStencil.id()];t||(t=new Hash,this._cachedCardSE[e.sourceStencil.id()]=t);var i=this._getMaximumNumberOfOutgoingEdge(e);void 0==i&&(i=-1),t[e.edgeStencil.id()]=i}if(e.targetStencil){var n=this._cachedCardTE[e.targetStencil.id()];n||(n=new Hash,this._cachedCardTE[e.targetStencil.id()]=n);var i=this._getMaximumNumberOfIncomingEdge(e);void 0==i&&(i=-1),n[e.edgeStencil.id()]=i}},_cacheContain:function(e){var t=[this._canContain(e),this._getMaximumOccurrence(e.containingStencil,e.containedStencil)];void 0==t[1]&&(t[1]=-1);var i=this._cachedContainPC[e.containingStencil.id()];return i||(i=new Hash,this._cachedContainPC[e.containingStencil.id()]=i),i[e.containedStencil.id()]=t,t},_cacheMorph:function(e){var t=this._cachedMorphRS[e];return t||(t=[],this._morphingRules.keys().include(e)&&(t=this._stencils.select(function(t){return t.roles().include(e)})),this._cachedMorphRS[e]=t),t},outgoingEdgeStencils:function(e){if(!e.sourceShape&&!e.sourceStencil)return[];e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil());var t=[];return this._stencils.each(function(i){if("edge"===i.type()){var n=Object.clone(e);n.edgeStencil=i,this.canConnect(n)&&t.push(i)}}.bind(this)),t},incomingEdgeStencils:function(e){if(!e.targetShape&&!e.targetStencil)return[];e.targetShape&&(e.targetStencil=e.targetShape.getStencil());var t=[];return this._stencils.each(function(i){if("edge"===i.type()){var n=Object.clone(e);n.edgeStencil=i,this.canConnect(n)&&t.push(i)}}.bind(this)),t},sourceStencils:function(e){if(!e||!e.edgeShape&&!e.edgeStencil)return[];e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t=[];return this._stencils.each(function(i){var n=Object.clone(e);n.sourceStencil=i,this.canConnect(n)&&t.push(i)}.bind(this)),t},targetStencils:function(e){if(!e||!e.edgeShape&&!e.edgeStencil)return[];e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t=[];return this._stencils.each(function(i){var n=Object.clone(e);n.targetStencil=i,this.canConnect(n)&&t.push(i)}.bind(this)),t},canConnect:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil||!e.edgeShape&&!e.edgeStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t;if(e.sourceStencil&&e.targetStencil){var i=this._cachedConnectSET[e.sourceStencil.id()];if(i){var n=i[e.edgeStencil.id()];if(n){var s=n[e.targetStencil.id()];t=void 0==s?this._cacheConnect(e):s}else t=this._cacheConnect(e)}else t=this._cacheConnect(e)}else if(e.sourceStencil){var i=this._cachedConnectSE[e.sourceStencil.id()];if(i){var n=i[e.edgeStencil.id()];t=void 0==n?this._cacheConnect(e):n}else t=this._cacheConnect(e)}else{var s=this._cachedConnectTE[e.targetStencil.id()];if(s){var n=s[e.edgeStencil.id()];t=void 0==n?this._cacheConnect(e):n}else t=this._cacheConnect(e)}if(t){if(e.sourceShape){var i=this._cachedCardSE[e.sourceStencil.id()];i||(this._cacheCard(e),i=this._cachedCardSE[e.sourceStencil.id()]);var r=i[e.edgeStencil.id()];void 0==r&&this._cacheCard(e),r=i[e.edgeStencil.id()],-1!=r&&(t=e.sourceShape.getOutgoingShapes().all(function(t){return t.getStencil().id()!==e.edgeStencil.id()||(e.edgeShape?t===e.edgeShape:0)?!0:(r--,r>0?!0:!1)}))}if(e.targetShape){var s=this._cachedCardTE[e.targetStencil.id()];s||(this._cacheCard(e),s=this._cachedCardTE[e.targetStencil.id()]);var r=s[e.edgeStencil.id()];void 0==r&&this._cacheCard(e),r=s[e.edgeStencil.id()],-1!=r&&(t=e.targetShape.getIncomingShapes().all(function(t){return t.getStencil().id()!==e.edgeStencil.id()||(e.edgeShape?t===e.edgeShape:0)?!0:(r--,r>0?!0:!1)}))}}return t},_canConnect:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil||!e.edgeShape&&!e.edgeStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t,i=this._getConnectionRulesOfEdgeStencil(e.edgeStencil);return t=0===i.keys().length?!1:e.sourceStencil?e.sourceStencil.roles().any(function(t){var n=i[t];return n?e.targetStencil?n.any(function(t){return e.targetStencil.roles().member(t)}):!0:!1}):i.values().any(function(t){return e.targetStencil.roles().any(function(e){return t.member(e)})})},canContain:function(e){if(!e||!e.containingStencil&&!e.containingShape||!e.containedStencil&&!e.containedShape)return!1;if(e.containedShape&&(e.containedStencil=e.containedShape.getStencil()),e.containingShape&&(e.containingStencil=e.containingShape.getStencil()),"edge"==e.containedStencil.type())return!1;var t,i=this._cachedContainPC[e.containingStencil.id()];if(i?(t=i[e.containedStencil.id()],t||(t=this._cacheContain(e))):t=this._cacheContain(e),t[0]){if(-1==t[1])return!0;if(e.containingShape){var n=t[1];return e.containingShape.getChildShapes(!1).all(function(t){return t.getStencil().id()===e.containedStencil.id()?(n--,n>0?!0:!1):!0})}return!0}return!1},_canContain:function(e){if(!e||!e.containingStencil&&!e.containingShape||!e.containedStencil&&!e.containedShape)return!1;e.containedShape&&(e.containedStencil=e.containedShape.getStencil()),e.containingShape&&(e.containingStencil=e.containingShape.getStencil());var t;return t=e.containingStencil.roles().any(function(t){var i=this._containmentRules[t];return i?i.any(function(t){return e.containedStencil.roles().member(t)}):!1}.bind(this))},morphStencils:function(e){if(!e.stencil&&!e.shape)return[];e.shape&&(e.stencil=e.shape.getStencil());var t=[];return e.stencil.roles().each(function(e){this._cacheMorph(e).each(function(e){t.push(e)})}.bind(this)),t.uniq()},baseMorphs:function(){var e=[];return this._morphingRules.each(function(t){t.value.each(function(t){e.push(t)})}),e},containsMorphingRules:function(){return this._stencilSets.any(function(e){return!!e.jsonRules().morphingRules})},connectMorph:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil());var t=this.incomingEdgeStencils(e),i=this.outgoingEdgeStencils(e),n=t.select(function(e){return i.member(e)}),s=this.baseMorphs().select(function(e){return n.member(e)});return s.size()>0?s[0]:n.size()>0?n[0]:null},showInShapeMenu:function(e){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(i){return e.roles().include(t.namespace()+i.role)&&i.showInShapeMenu!==!1})})},preserveBounds:function(e){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(i){return e.roles().include(t.namespace()+i.role)&&i.preserveBounds})})},getLayoutingRules:function(e,t){if(e&&e instanceof ORYX.Core.Shape){var i={"in":{},out:{}},n=function(e,n){e&&e[n]&&["t","r","b","l"].each(function(t){i[n][t]=Math.max(e[n][t],i[n][t]||0)}),e&&e[n+"s"]instanceof Array&&["t","r","b","l"].each(function(s){var r,o=e[n+"s"].find(function(e){return!e.edgeRole});t instanceof ORYX.Core.Edge&&(r=e[n+"s"].find(function(e){return this._hasRole(t,e.edgeRole)}.bind(this))),i[n][s]=Math.max(r?r[s]:o[s],i[n][s]||0)
}.bind(this))}.bind(this);return e.getStencil().roles().each(function(e){this._layoutRules[e]&&(n(this._layoutRules[e],"in"),n(this._layoutRules[e],"out"))}.bind(this)),["in","out"].each(function(e){["t","r","b","l"].each(function(t){i[e][t]=void 0!==i[e][t]?i[e][t]:1})}),i}},_hasRole:function(e,t){if(e instanceof ORYX.Core.Shape&&t){var i=e.getStencil().roles().any(function(e){return e==t});return i||e.getStencil().id()==e.getStencil().namespace()+t}},_stencilsWithRole:function(e){return this._stencils.findAll(function(t){return t.roles().member(e)?!0:!1})},_edgesWithRole:function(e){return this._stencils.findAll(function(t){return t.roles().member(e)&&"edge"===t.type()?!0:!1})},_nodesWithRole:function(e){return this._stencils.findAll(function(t){return t.roles().member(e)&&"node"===t.type()?!0:!1})},_getMaximumOccurrence:function(e,t){var i;return t.roles().each(function(e){var t=this._cardinalityRules[e];t&&t.maximumOccurrence&&(i=i?Math.min(i,t.maximumOccurrence):t.maximumOccurrence)}.bind(this)),i},_getMaximumNumberOfOutgoingEdge:function(e){if(!e||!e.sourceStencil||!e.edgeStencil)return!1;var t;return e.sourceStencil.roles().each(function(i){var n=this._cardinalityRules[i];n&&n.outgoingEdges&&e.edgeStencil.roles().each(function(e){var i=n.outgoingEdges[e];i&&i.maximum&&(t=t?Math.min(t,i.maximum):i.maximum)})}.bind(this)),t},_getMaximumNumberOfIncomingEdge:function(e){if(!e||!e.targetStencil||!e.edgeStencil)return!1;var t;return e.targetStencil.roles().each(function(i){var n=this._cardinalityRules[i];n&&n.incomingEdges&&e.edgeStencil.roles().each(function(e){var i=n.incomingEdges[e];i&&i.maximum&&(t=t?Math.min(t,i.maximum):i.maximum)})}.bind(this)),t},_getConnectionRulesOfEdgeStencil:function(e){var t=new Hash;return e.roles().each(function(e){this._connectionRules[e]&&this._connectionRules[e].each(function(e){t[e.key]=t[e.key]?t[e.key].concat(e.value):e.value})}.bind(this)),t},_isRoleOfOtherNamespace:function(e){return e.indexOf("#")>0},toString:function(){return"Rules"}},ORYX.Core.StencilSet.Rules=Clazz.extend(ORYX.Core.StencilSet.Rules),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.StencilSet=Clazz.extend({construct:function(e){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.StencilSet(construct): Parameter 'source' is not defined.";e.endsWith("/")&&(e=e.substr(0,e.length-1)),this._extensions=new Hash,this._source=e,this._baseUrl=ORYX.PATH+"stencilset/"+e+"/",this._jsonObject={},this._stencils=new Hash,this._availableStencils=new Hash,new Ajax.Request(ORYX.PATH+"stencilset/"+e,{asynchronous:!1,method:"get",onSuccess:this._init.bind(this),onFailure:function(){throw"Loading stencil set "+e+" failed."}.bind(e)})},findRootStencilName:function(){var e=this._stencils.values().find(function(e){return e._jsonStencil.mayBeRoot});return e||(ORYX.Log.warn("Did not find any stencil that may be root. Taking a guess."),e=this._stencils.values()[0]),e.id()},equals:function(e){return this.namespace()===e.namespace()},stencils:function(e,t,i){if(e&&t){for(var n=this._availableStencils.values(),s=[e],r=[],o=[];s.size()>0;){var a=s.pop();r.push(a);for(var h=n.findAll(function(e){var i={containingStencil:a,containedStencil:e};return t.canContain(i)}),l=0;l<h.size();l++)r.member(h[l])||s.push(h[l]);o=o.concat(h).uniq()}o=o.sortBy(function(e){return n.indexOf(e)}),i&&(o=o.sortBy(function(e){return e.groups().first()}));var c=n.findAll(function(e){return"edge"==e.type()});return o=o.concat(c)}return i?this._availableStencils.values().sortBy(function(e){return e.groups().first()}):this._availableStencils.values()},nodes:function(){return this._availableStencils.values().findAll(function(e){return"node"===e.type()})},edges:function(){return this._availableStencils.values().findAll(function(e){return"edge"===e.type()})},stencil:function(e){return this._stencils[e]},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"description")},namespace:function(){return this._jsonObject?this._jsonObject.namespace:null},jsonRules:function(){return this._jsonObject?this._jsonObject.rules:null},source:function(){return this._source},extensions:function(){return this._extensions},addExtension:function(e){this.addExtensionDirectly(e)},addExtensionFromDefinition:function(e){new Ajax.Request(e,{method:"GET",asynchronous:!1,onSuccess:function(e){try{var t=e.responseText,i=t.evalJSON();this.addExtensionDirectly(i)}catch(n){ORYX.Log.debug("Unable to load extension definition: "+n),ORYX.EDITOR._pluginFacade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:"Unable to load extension definition: "+n,title:""})}}.bind(this),onFailure:function(){ORYX.EDITOR._pluginFacade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:"Unable to create extension definition.",title:""})}.bind(this)})},addExtensionDirectly:function(e){try{if(e["extends"].endsWith("#")||(e["extends"]+="#"),e["extends"]==this.namespace()){this._extensions[e.namespace]=e;var t=this._stencils.keys().size();if(e.stencils&&$A(e.stencils).each(function(e){t++;var i=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,void 0,t);this._stencils[i.id()]=i,this._availableStencils[i.id()]=i}.bind(this)),e.properties){var i=this._stencils.values();i.each(function(t){var i=t.roles();e.properties.each(function(n){n.roles.any(function(s){return s=e["extends"]+s,i.member(s)?(n.properties.each(function(i){t.addProperty(i,e.namespace)}),!0):!1})})}.bind(this))}e.removeproperties&&e.removeproperties.each(function(t){var i=this.stencil(e["extends"]+t.stencil);i&&t.properties.each(function(e){i.removeProperty(e)})}.bind(this)),e.removestencils&&$A(e.removestencils).each(function(t){delete this._availableStencils[e["extends"]+t]}.bind(this))}}catch(n){ORYX.Log.debug("StencilSet.addExtension: Something went wrong when initialising the stencil set extension. "+n)}},changeTitle:function(e){this._jsonObject.title=e},removeExtension:function(e){var t=this._extensions[e];if(t){if(t.stencils&&$A(t.stencils).each(function(e){var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this);delete this._stencils[t.id()],delete this._availableStencils[t.id()]}.bind(this)),t.properties){var i=this._stencils.values();i.each(function(e){var i=e.roles();t.properties.each(function(n){n.roles.any(function(s){return s=t["extends"]+s,i.member(s)?(n.properties.each(function(t){e.removeProperty(t.id)}),!0):!1})})}.bind(this))}t.removeproperties&&t.removeproperties.each(function(e){var i=this.stencil(t["extends"]+e.stencil);if(i){var n=$A(this._jsonObject.stencils).find(function(e){return e.id==i.id()});e.properties.each(function(e){var t=$A(n.properties).find(function(t){return t.id==e});i.addProperty(t,this.namespace())}.bind(this))}}.bind(this)),t.removestencils&&$A(t.removestencils).each(function(e){var i=t["extends"]+e;this._availableStencils[i]=this._stencils[i]}.bind(this))}delete this._extensions[e]},__handleStencilset:function(response){try{eval("this._jsonObject ="+response.responseText)}catch(e){throw"Stenciset corrupt: "+e}if(!this._jsonObject)throw"Error evaluating stencilset. It may be corrupt.";with(this._jsonObject){if(!namespace||""===namespace)throw"Namespace definition missing in stencilset.";if(!(stencils instanceof Array))throw"Stencilset corrupt.";namespace.endsWith("#")||(namespace+="#"),title||(title=""),description||(description="")}},_getJSONURL:function(e){this._baseUrl=e.responseText.substring(0,e.responseText.lastIndexOf("/")+1),this._source=e.responseText,new Ajax.Request(e.responseText,{asynchronous:!1,method:"get",onSuccess:this._init.bind(this),onFailure:this._cancelInit.bind(this)})},_init:function(e){this.__handleStencilset(e);var t=new Hash;this._jsonObject.propertyPackages&&$A(this._jsonObject.propertyPackages).each(function(e){t[e.name]=e.properties}.bind(this));var i=0;$A(this._jsonObject.stencils).each(function(e){i++;try{var n=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,t,i);this._stencils[n.id()]=n,this._availableStencils[n.id()]=n}catch(s){ORYX.Log.error("Problems instantiating a stencil:"),void 0!==console&&(console.log(s),void 0!==s.stack&&console.log(s.stack))}}.bind(this))},toString:function(){return"StencilSet "+this.title()+" ("+this.namespace()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet._stencilSetsByNamespace=new Hash,ORYX.Core.StencilSet._stencilSetsByUrl=new Hash,ORYX.Core.StencilSet._StencilSetNSByEditorInstance=new Hash,ORYX.Core.StencilSet._rulesByEditorInstance=new Hash,ORYX.Core.StencilSet.stencilSets=function(e){var t=ORYX.Core.StencilSet._StencilSetNSByEditorInstance[e],i=new Hash;return t&&t.each(function(e){var t=ORYX.Core.StencilSet.stencilSet(e);i[t.namespace()]=t}),i},ORYX.Core.StencilSet.stencilSet=function(e){ORYX.Log.trace("Getting stencil set %0",e);var t=e.split("#",1);return 1===t.length?(ORYX.Log.trace("Getting stencil set %0",t[0]),ORYX.Core.StencilSet._stencilSetsByNamespace[t[0]+"#"]):void 0},ORYX.Core.StencilSet.stencil=function(e){ORYX.Log.trace("Getting stencil for %0",e);var t=ORYX.Core.StencilSet.stencilSet(e);return t?t.stencil(e):(ORYX.Log.trace("Cannot fild stencil for %0",e),void 0)},ORYX.Core.StencilSet.rules=function(e){return ORYX.Core.StencilSet._rulesByEditorInstance[e]||(ORYX.Core.StencilSet._rulesByEditorInstance[e]=new ORYX.Core.StencilSet.Rules),ORYX.Core.StencilSet._rulesByEditorInstance[e]},ORYX.Core.StencilSet.loadStencilSet=function(e,t){var i=ORYX.Core.StencilSet._stencilSetsByUrl[e];i||(i=new ORYX.Core.StencilSet.StencilSet(e),ORYX.Core.StencilSet._stencilSetsByNamespace[i.namespace()]=i,ORYX.Core.StencilSet._stencilSetsByUrl[e]=i);var n=i.namespace();if(ORYX.Core.StencilSet._StencilSetNSByEditorInstance[t]?ORYX.Core.StencilSet._StencilSetNSByEditorInstance[t].push(n):ORYX.Core.StencilSet._StencilSetNSByEditorInstance[t]=[n],ORYX.Core.StencilSet._rulesByEditorInstance[t])ORYX.Core.StencilSet._rulesByEditorInstance[t].initializeRules(i);else{var s=new ORYX.Core.StencilSet.Rules;s.initializeRules(i),ORYX.Core.StencilSet._rulesByEditorInstance[t]=s}},ORYX.Core.StencilSet.getTranslation=function(e,t){var i=ORYX.I18N.Language.toLowerCase(),n=e[t+"_"+i];return n?n:(n=e[t+"_"+i.substr(0,2)],n?n:e[t])},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Command=Clazz.extend({construct:function(){},execute:function(){throw"Command.execute() has to be implemented!"},rollback:function(){throw"Command.rollback() has to be implemented!"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Bounds={construct:function(){this._changedCallbacks=[],this.a={},this.b={},this.set.apply(this,arguments),this.suspendChange=!1,this.changedWhileSuspend=!1},_changed:function(e){this.suspendChange?this.changedWhileSuspend=!0:(this._changedCallbacks.each(function(t){t(this,e)}.bind(this)),this.changedWhileSuspend=!1)},registerCallback:function(e){this._changedCallbacks.member(e)||this._changedCallbacks.push(e)},unregisterCallback:function(e){this._changedCallbacks=this._changedCallbacks.without(e)},set:function(){var e=!1;switch(arguments.length){case 1:this.a.x!==arguments[0].a.x&&(e=!0,this.a.x=arguments[0].a.x),this.a.y!==arguments[0].a.y&&(e=!0,this.a.y=arguments[0].a.y),this.b.x!==arguments[0].b.x&&(e=!0,this.b.x=arguments[0].b.x),this.b.y!==arguments[0].b.y&&(e=!0,this.b.y=arguments[0].b.y);break;case 2:var t=Math.min(arguments[0].x,arguments[1].x),i=Math.min(arguments[0].y,arguments[1].y),n=Math.max(arguments[0].x,arguments[1].x),s=Math.max(arguments[0].y,arguments[1].y);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==n&&(e=!0,this.b.x=n),this.b.y!==s&&(e=!0,this.b.y=s);break;case 4:var t=Math.min(arguments[0],arguments[2]),i=Math.min(arguments[1],arguments[3]),n=Math.max(arguments[0],arguments[2]),s=Math.max(arguments[1],arguments[3]);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==n&&(e=!0,this.b.x=n),this.b.y!==s&&(e=!0,this.b.y=s)}e&&this._changed(!0)},moveTo:function(){var e=this.upperLeft();switch(arguments.length){case 1:this.moveBy({x:arguments[0].x-e.x,y:arguments[0].y-e.y});break;case 2:this.moveBy({x:arguments[0]-e.x,y:arguments[1]-e.y})}},moveBy:function(){var e=!1;switch(arguments.length){case 1:var t=arguments[0];(0!==t.x||0!==t.y)&&(e=!0,this.a.x+=t.x,this.b.x+=t.x,this.a.y+=t.y,this.b.y+=t.y);break;case 2:var i=arguments[0],n=arguments[1];(0!==i||0!==n)&&(e=!0,this.a.x+=i,this.b.x+=i,this.a.y+=n,this.b.y+=n)}e&&this._changed()},include:function(e){if(void 0===this.a.x&&void 0===this.a.y&&void 0===this.b.x&&void 0===this.b.y)return e;var t=Math.min(this.a.x,e.a.x),i=Math.min(this.a.y,e.a.y),n=Math.max(this.b.x,e.b.x),s=Math.max(this.b.y,e.b.y);this.set(t,i,n,s)},extend:function(e){(0!==e.x||0!==e.y)&&(this.b.x+=e.x,this.b.y+=e.y,this._changed(!0))},widen:function(e){0!==e&&(this.suspendChange=!0,this.moveBy({x:-e,y:-e}),this.extend({x:2*e,y:2*e}),this.suspendChange=!1,this.changedWhileSuspend&&this._changed(!0))},upperLeft:function(){return{x:this.a.x,y:this.a.y}},lowerRight:function(){return{x:this.b.x,y:this.b.y}},width:function(){return this.b.x-this.a.x},height:function(){return this.b.y-this.a.y},center:function(){return{x:(this.a.x+this.b.x)/2,y:(this.a.y+this.b.y)/2}},midPoint:function(){return{x:(this.b.x-this.a.x)/2,y:(this.b.y-this.a.y)/2}},centerMoveTo:function(){var e=this.center();switch(arguments.length){case 1:this.moveBy(arguments[0].x-e.x,arguments[0].y-e.y);break;case 2:this.moveBy(arguments[0]-e.x,arguments[1]-e.y)}},isIncluded:function(e,t){var i,n,t;switch(arguments.length){case 1:i=arguments[0].x,n=arguments[0].y,t=0;break;case 2:arguments[0].x&&arguments[0].y?(i=arguments[0].x,n=arguments[0].y,t=Math.abs(arguments[1])):(i=arguments[0],n=arguments[1],t=0);break;case 3:i=arguments[0],n=arguments[1],t=Math.abs(arguments[2]);break;default:throw"isIncluded needs one, two or three arguments"}var s=this.upperLeft(),r=this.lowerRight();return i>=s.x-t&&i<=r.x+t&&n>=s.y-t&&n<=r.y+t?!0:!1},clone:function(){return new ORYX.Core.Bounds(this)},toString:function(){return"( "+this.a.x+" | "+this.a.y+" )/( "+this.b.x+" | "+this.b.y+" )"},serializeForERDF:function(){return this.a.x+","+this.a.y+","+this.b.x+","+this.b.y}},ORYX.Core.Bounds=Clazz.extend(ORYX.Core.Bounds),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.UIObject={construct:function(e){this.isChanged=!0,this.isResized=!0,this.isVisible=!0,this.isSelectable=!1,this.isResizable=!1,this.isMovable=!1,this.id=ORYX.Editor.provideId(),this.parent=void 0,this.node=void 0,this.children=[],this.bounds=new ORYX.Core.Bounds,this._changedCallback=this._changed.bind(this),this.bounds.registerCallback(this._changedCallback),e&&e.eventHandlerCallback&&(this.eventHandlerCallback=e.eventHandlerCallback)},_changed:function(e,t){this.isChanged=!0,this.bounds==e&&(this.isResized=t||this.isResized)},update:function(){this.isChanged&&(this.refresh(),this.isChanged=!1,this.children.each(function(e){e.update()}))},refresh:function(){},getChildren:function(){return this.children.clone()},getParents:function(){for(var e=[],t=this.parent;t;)e.push(t),t=t.parent;return e},isParent:function(e){for(var t=this;t;){if(t===e)return!0;t=t.parent}return!1},getId:function(){return this.id},getChildById:function(e,t){return this.children.find(function(i){if(i.getId()===e)return i;if(t){var n=i.getChildById(e,t);if(n)return n}})},add:function(e){this.children.member(e)?ORYX.Log.info("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.remove(e),this.children.push(e),e.parent=this,e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback),this.eventHandlerCallback&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e}))},remove:function(e){this.children.member(e)?(this.children=this._uiObjects.without(e),e.parent=void 0,e.node=this.node.removeChild(e.node),e.bounds.unregisterCallback(this._changedCallback)):ORYX.Log.info("remove: ORYX.Core.UIObject is not a child of this object.")},absoluteBounds:function(){if(this.parent){var e=this.absoluteXY();return new ORYX.Core.Bounds(e.x,e.y,e.x+this.bounds.width(),e.y+this.bounds.height())}return this.bounds.clone()},absoluteXY:function(){if(this.parent){var e=this.parent.absoluteXY();return{x:e.x+this.bounds.upperLeft().x,y:e.y+this.bounds.upperLeft().y}}return{x:this.bounds.upperLeft().x,y:this.bounds.upperLeft().y}},absoluteCenterXY:function(){if(this.parent){var e=this.parent.absoluteXY();return{x:e.x+this.bounds.center().x,y:e.y+this.bounds.center().y}}return{x:this.bounds.center().x,y:this.bounds.center().y}},hide:function(){this.node.setAttributeNS(null,"display","none"),this.isVisible=!1,this.children.each(function(e){e.hide()})},show:function(){this.node.setAttributeNS(null,"display","inherit"),this.isVisible=!0,this.children.each(function(e){e.show()})},addEventHandlers:function(e){e.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,this._delegateEvent.bind(this),!1),e.addEventListener("click",this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_DBLCLICK,this._delegateEvent.bind(this),!1)},_delegateEvent:function(e){this.eventHandlerCallback&&this.eventHandlerCallback(e,this)},toString:function(){return"UIObject "+this.id}},ORYX.Core.UIObject=Clazz.extend(ORYX.Core.UIObject),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.AbstractShape=ORYX.Core.UIObject.extend({construct:function(e,t){arguments.callee.$.construct.apply(this,arguments),this.resourceId=ORYX.Editor.provideId(),this._stencil=t,this._stencil._jsonStencil.superId&&(stencilId=this._stencil.id(),superStencilId=stencilId.substring(0,stencilId.indexOf("#")+1)+t._jsonStencil.superId,stencilSet=this._stencil.stencilSet(),this._stencil=stencilSet.stencil(superStencilId)),this.properties=new Hash,this.propertiesChanged=new Hash,this.hiddenProperties=new Hash,this._stencil.properties().each(function(e){var t=e.prefix()+"-"+e.id();this.properties[t]=e.value(),this.propertiesChanged[t]=!0}.bind(this)),t._jsonStencil.superId&&t.properties().each(function(e){var t=e.prefix()+"-"+e.id(),i=e.value(),n=this.properties[t];this.properties[t]=i,this.propertiesChanged[t]=!0,this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,name:t,value:i,oldValue:n})}.bind(this))},layout:function(){},getStencil:function(){return this._stencil},getChildShapeByResourceId:function(e){return e=ERDF.__stripHashes(e),this.getChildShapes(!0).find(function(t){return t.resourceId==e})},getChildShapes:function(e,t){var i=[];return this.children.each(function(n){n instanceof ORYX.Core.Shape&&n.isVisible&&(t&&t(n),i.push(n),e&&(i=i.concat(n.getChildShapes(e,t))))}),i},hasChildShape:function(e){return this.getChildShapes().any(function(t){return t===e||t.hasChildShape(e)})},getChildNodes:function(e,t){var i=[];return this.children.each(function(n){n instanceof ORYX.Core.Node&&n.isVisible&&(t&&t(n),i.push(n)),n instanceof ORYX.Core.Shape&&e&&(i=i.concat(n.getChildNodes(e,t)))}),i},getChildEdges:function(e,t){var i=[];return this.children.each(function(n){n instanceof ORYX.Core.Edge&&n.isVisible&&(t&&t(n),i.push(n)),n instanceof ORYX.Core.Shape&&e&&(i=i.concat(n.getChildEdges(e,t)))}),i},getAbstractShapesAtPosition:function(){var e,t;switch(arguments.length){case 1:e=arguments[0].x,t=arguments[0].y;break;case 2:e=arguments[0],t=arguments[1];break;default:throw"getAbstractShapesAtPosition needs 1 or 2 arguments!"}if(this.isPointIncluded(e,t)){var i=[];i.push(this);var n=this.getChildNodes(),s=this.getChildEdges();return[n,s].each(function(n){var s=new Hash;n.each(function(i){if(i.isVisible){var n=i.getAbstractShapesAtPosition(e,t);if(n.length>0){var r=$A(i.node.parentNode.childNodes),o=r.indexOf(i.node);s[o]=n}}}),s.keys().sort().each(function(e){i=i.concat(s[e])})}),i}return[]},setProperty:function(e,t,i){var n=this.properties[e];(n!==t||i===!0)&&(this.properties[e]=t,this.propertiesChanged[e]=!0,this._changed(),this._isInSetProperty||(this._isInSetProperty=!0,this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,elements:[this],name:e,value:t,oldValue:n}),delete this._isInSetProperty))},setHiddenProperty:function(e,t){if(void 0===t)return delete this.hiddenProperties[e],void 0;var i=this.hiddenProperties[e];i!==t&&(this.hiddenProperties[e]=t)},isPointIncluded:function(e,t,i){var n=i?i:this.absoluteBounds();return n.isIncluded(e,t)},serialize:function(){var e=[];return e.push({name:"type",prefix:"oryx",value:this.getStencil().id(),type:"literal"}),this.hiddenProperties.each(function(t){e.push({name:t.key.replace("oryx-",""),prefix:"oryx",value:t.value,type:"literal"})}.bind(this)),this.getStencil().properties().each(function(t){var i=t.prefix(),n=t.id();e.push({name:n,prefix:i,value:this.properties[i+"-"+n],type:"literal"})}.bind(this)),e},deserialize:function(e){e=e.sort(function(e,t){return Number(this.properties.keys().member(e.prefix+"-"+e.name))>Number(this.properties.keys().member(t.prefix+"-"+t.name))?-1:0}.bind(this)),e.each(function(e){var t=e.name,i=e.prefix,n=e.value;switch("object"===Ext.type(n)&&(n=Ext.encode(n)),i+"-"+t){case"raziel-parent":if(!this.parent)break;var s=this.getCanvas().getChildShapeByResourceId(n);s&&s.add(this);break;default:this.properties.keys().member(i+"-"+t)?this.setProperty(i+"-"+t,n):"bounds"!==t&&"parent"!==t&&"target"!==t&&"dockers"!==t&&"docker"!==t&&"outgoing"!==t&&"incoming"!==t&&this.setHiddenProperty(i+"-"+t,n)}}.bind(this))},toString:function(){return"ORYX.Core.AbstractShape "+this.id},toJSON:function(){var e={resourceId:this.resourceId,properties:Ext.apply({},this.properties,this.hiddenProperties).inject({},function(e,t){var i=t[0],n=t[1];if(this.getStencil().property(i)&&this.getStencil().property(i).type()===ORYX.CONFIG.TYPE_COMPLEX&&"string"===Ext.type(n))try{n=Ext.decode(n)}catch(s){}return i=i.replace(/^[\w_]+-/,""),e[i]=n,e}.bind(this)),stencil:{id:this.getStencil().idWithoutNs()},childShapes:this.getChildShapes().map(function(e){return e.toJSON()})};return this.getOutgoingShapes&&(e.outgoing=this.getOutgoingShapes().map(function(e){return{resourceId:e.resourceId}})),this.bounds&&(e.bounds={lowerRight:this.bounds.lowerRight(),upperLeft:this.bounds.upperLeft()}),this.dockers&&(e.dockers=this.dockers.map(function(e){var t=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();return t.getDocker=function(){return e},t})),Ext.apply(e,ORYX.Core.AbstractShape.JSONHelper),e.getShape=function(){return this}.bind(this),e}}),ORYX.Core.AbstractShape.JSONHelper={eachChild:function(e,t,i){if(this.childShapes){var n=[];this.childShapes.each(function(s){var r=e(s,this);r&&n.push(r),t&&s.eachChild(e,t,i)}.bind(this)),i&&(this.childShapes=n)}},getChildShapes:function(e){var t=this.childShapes;return e&&this.eachChild(function(i){t=t.concat(i.getChildShapes(e))},!0),t},serialize:function(){return Ext.encode(this)}},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Canvas=ORYX.Core.AbstractShape.extend({zoomLevel:1,construct:function(e){return arguments.callee.$.construct.apply(this,arguments),e&&e.width&&e.height?(this.resourceId=e.id,this.nodes=[],this.edges=[],this.rootNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",e.parentNode,["svg",{id:this.id,width:e.width,height:e.height},["defs",{}]]),this.rootNode.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.rootNode.setAttribute("xmlns:svg","http://www.w3.org/2000/svg"),this._htmlContainer=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",e.parentNode,["div",{id:"oryx_canvas_htmlContainer",style:"position:absolute; top:5px"}]),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.rootNode,["g",{},["g",{"class":"stencils"},["g",{"class":"me"}],["g",{"class":"children"}],["g",{"class":"edge"}]],["g",{"class":"svgcontainer"}]]),this.node.setAttributeNS(null,"stroke","none"),this.node.setAttributeNS(null,"font-family","Verdana, sans-serif"),this.node.setAttributeNS(null,"font-size-adjust","none"),this.node.setAttributeNS(null,"font-style","normal"),this.node.setAttributeNS(null,"font-variant","normal"),this.node.setAttributeNS(null,"font-weight","normal"),this.node.setAttributeNS(null,"line-heigth","normal"),this.node.setAttributeNS(null,"font-size",ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT),this.bounds.set(0,0,e.width,e.height),this.addEventHandlers(this.rootNode.parentNode),this.rootNode.oncontextmenu=function(){return!1},void 0):(ORYX.Log.fatal("Canvas is missing mandatory parameters options.width and options.height."),void 0)},focus:function(){this.headerA||(this.headerA=Ext.get("oryx_editor_header").child("a").dom),this.headerA.focus(),this.headerA.blur()},update:function(){this.nodes.each(function(e){this._traverseForUpdate(e)}.bind(this));var e=this.getStencil().layout();e&&e.each(function(e){e.shape=this,e.forceExecution=!0,e.target=this.rootNode,this._delegateEvent(e)}.bind(this)),this.nodes.invoke("_update"),this.edges.invoke("_update",!0)},_traverseForUpdate:function(e){var t=e.isChanged;return e.getChildNodes(!1,function(e){this._traverseForUpdate(e)&&(t=!0)}.bind(this)),t?(e.layout(),!0):!1},layout:function(){},getChildNodes:function(e,t){if(e||t){var i=[];return this.nodes.each(function(n){t&&t(n),i.push(n),e&&n instanceof ORYX.Core.Shape&&(i=i.concat(n.getChildNodes(e,t)))}),i}return this.nodes.clone()},add:function(e){e instanceof ORYX.Core.UIObject?this.children.member(e)?ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.parent.remove(e),this.children.push(e),e.parent=this,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.addMarkers(this.rootNode.getElementsByTagNameNS(NAMESPACE_SVG,"defs")[0]),e.node=this.node.childNodes[0].childNodes[2].appendChild(e.node),this.edges.push(e)):(e.node=this.node.childNodes[0].childNodes[1].appendChild(e.node),this.nodes.push(e)):e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback),this.eventHandlerCallback&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})):ORYX.Log.fatal("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e){this.children.member(e)?(this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node),this.edges=this.edges.without(e)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e.node=this.node.removeChild(e.node),e.bounds.unregisterCallback(this._changedCallback)):ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},addShapeObjects:function(e,t){if(e){var i=function(e,i){try{var n=ORYX.Core.StencilSet.stencil(this.getStencil().namespace()+e.stencil.id),s="node"==n.type()?ORYX.Core.Node:ORYX.Core.Edge,r=new s({eventHandlerCallback:t},n);return r.resourceId=e.resourceId,e.parent="#"+(e.parent&&e.parent.resourceId||i.resourceId),this.add(r),{json:e,object:r}}catch(o){ORYX.Log.warn("LoadingContent: Stencil could not create.")}}.bind(this),n=function(e){var t=[];return e.childShapes&&e.childShapes.each(function(s){var r=i(s,e);"undefined"!=typeof r&&t.push(r),t=t.concat(n(s))}),t}.bind(this),s=n({childShapes:e,resourceId:this.resourceId});return s.each(function(e){var t=[];for(field in e.json.properties)t.push({prefix:"oryx",name:field,value:e.json.properties[field]});if(e.json.outgoing.each(function(e){t.push({prefix:"raziel",name:"outgoing",value:"#"+e.resourceId})}),e.object instanceof ORYX.Core.Edge){var i=e.json.target||e.json.outgoing[0];i&&t.push({prefix:"raziel",name:"target",value:"#"+i.resourceId})}e.json.bounds&&t.push({prefix:"oryx",name:"bounds",value:e.json.bounds.upperLeft.x+","+e.json.bounds.upperLeft.y+","+e.json.bounds.lowerRight.x+","+e.json.bounds.lowerRight.y}),e.json.dockers&&t.push({prefix:"oryx",name:"dockers",value:e.json.dockers.inject("",function(e,t){return e+t.x+" "+t.y+" "})+" #"}),t.push({prefix:"raziel",name:"parent",value:e.json.parent}),e.__properties=t}.bind(this)),s.each(function(e){e.object instanceof ORYX.Core.Node&&e.object.deserialize(e.__properties)}),s.each(function(e){e.object instanceof ORYX.Core.Edge&&e.object.deserialize(e.__properties)}),s.pluck("object")}},absoluteBounds:function(){return new ORYX.Core.Bounds(0,0,this.getHTMLContainer().parentNode.offsetWidth,this.getHTMLContainer().parentNode.offsetHeight)},updateSize:function(){var e=0,t=0,i=100;this.getChildShapes(!0,function(n){var s=n.bounds;e=Math.max(e,s.lowerRight().x+i),t=Math.max(t,s.lowerRight().y+i)}),(this.bounds.width()<e||this.bounds.height()<t)&&this.setSize({width:Math.max(this.bounds.width(),e),height:Math.max(this.bounds.height(),t)})},getRootNode:function(){return this.rootNode},getSvgContainer:function(){return this.node.childNodes[1]},getHTMLContainer:function(){return this._htmlContainer},getShapesWithSharedParent:function(e){return!e||e.length<1?[]:1==e.length?e:e.findAll(function(t){for(var i=t.parent;i;){if(e.member(i))return!1;i=i.parent}return!0})},setSize:function(e,t){e&&e.width&&e.height&&(this.rootNode.parentNode&&(this.rootNode.parentNode.style.width=e.width+"px",this.rootNode.parentNode.style.height=e.height+"px"),this.rootNode.setAttributeNS(null,"width",e.width),this.rootNode.setAttributeNS(null,"height",e.height),t||this.bounds.set({a:{x:0,y:0},b:{x:e.width/this.zoomLevel,y:e.height/this.zoomLevel}}))},getSVGRepresentation:function(e){var t=this.getRootNode().cloneNode(!0);this._removeInvisibleElements(t);var i,n,s,r;try{var o=this.getRootNode().childNodes[1].getBBox();i=o.x,n=o.y,s=o.x+o.width,r=o.y+o.height}catch(a){this.getChildShapes(!0).each(function(e){var t=e.absoluteBounds(),o=t.upperLeft(),a=t.lowerRight();void 0==i?(i=o.x,n=o.y,s=a.x,r=a.y):(i=Math.min(i,o.x),n=Math.min(n,o.y),s=Math.max(s,a.x),r=Math.max(r,a.y))})}var h,l,c,d,u=50;void 0==i?(h=0,l=0,c=0,d=0):(h=s-i,l=r-n,c=-i+u/2,d=-n+u/2),t.setAttributeNS(null,"width",h+u),t.setAttributeNS(null,"height",l+u),t.childNodes[1].firstChild.setAttributeNS(null,"transform","translate("+c+", "+d+")"),t.childNodes[1].removeAttributeNS(null,"transform");try{var g=t.childNodes[1].childNodes[1];g.parentNode.removeChild(g)}catch(a){}return e&&($A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")).each(function(e){e.textContent=e.textContent.escapeHTML()}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text")).each(function(e){0==e.childNodes.length&&(e.textContent=e.textContent.escapeHTML())})),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"image")).each(function(e){var t=e.getAttributeNS("http://www.w3.org/1999/xlink","href");t.match("^(http|https)://")||-1!=t.indexOf("base64")||(t=window.location.protocol+"//"+window.location.host+t,e.setAttributeNS("http://www.w3.org/1999/xlink","href",t))}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"a")).each(function(e){e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",(e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").escapeHTML())}),t},_removeInvisibleElements:function(e){for(var t=0;t<e.childNodes.length;){var i=e.childNodes[t];i.getAttributeNS&&"hidden"===i.getAttributeNS(null,"visibility")?e.removeChild(i):(this._removeInvisibleElements(i),t++)}},_delegateEvent:function(e){!this.eventHandlerCallback||e.target!=this.rootNode&&e.target!=this.rootNode.parentNode||this.eventHandlerCallback(e,this)},toString:function(){return"Canvas "+this.id},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return e.stencilset={url:this.getStencil().stencilSet().source(),namespace:this.getStencil().stencilSet().namespace()},e
}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.UIEnableDrag=function(e,t,i){this.uiObj=t;var n=t.bounds.upperLeft(),s=t.node.getScreenCTM();this.faktorXY={x:s.a,y:s.d},this.scrollNode=t.node.ownerSVGElement.parentNode.parentNode,this.offSetPosition={x:Event.pointerX(e)-n.x*this.faktorXY.x,y:Event.pointerY(e)-n.y*this.faktorXY.y},this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},this.dragCallback=ORYX.Core.UIDragCallback.bind(this),this.disableCallback=ORYX.Core.UIDisableDrag.bind(this),this.movedCallback=i?i.movedCallback:void 0,this.upCallback=i?i.upCallback:void 0,document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1)},ORYX.Core.UIDragCallback=function(e){var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop,t.x/=this.faktorXY.x,t.y/=this.faktorXY.y,this.uiObj.bounds.moveTo(t),this.movedCallback&&this.movedCallback(e),Event.stop(e)},ORYX.Core.UIDisableDrag=function(e){document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),this.upCallback&&this.upCallback(e),this.upCallback=void 0,this.movedCallback=void 0,Event.stop(e)},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Shape={construct:function(){arguments.callee.$.construct.apply(this,arguments),this.dockers=[],this.magnets=[],this._defaultMagnet,this.incoming=[],this.outgoing=[],this.nodes=[],this._dockerChangedCallback=this._dockerChanged.bind(this),this._labels=new Hash,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{id:this.id},["g",{"class":"stencils"},["g",{"class":"me"}],["g",{"class":"children",style:"overflow:hidden"}],["g",{"class":"edge"}]],["g",{"class":"controls"},["g",{"class":"dockers"}],["g",{"class":"magnets"}]]])},update:function(){},_update:function(){},refresh:function(){arguments.callee.$.refresh.apply(this,arguments),this.node.ownerDocument&&(this.propertiesChanged.each(function(e){if(e.value){var t=this.properties[e.key],i=this.getStencil().property(e.key);if(this.propertiesChanged[e.key]=!1,i.type()==ORYX.CONFIG.TYPE_CHOICE||i.type()==ORYX.CONFIG.TYPE_DYNAMICCHOICE){i.refToView().each(function(e){if(""!==e){var n=this._labels[this.id+e];n&&("fontsize"==i.id()?t&&i.item(t)&&n.fontSize(i.item(t).value()):n.text(i.item(t).value()))}}.bind(this));var n=new Hash;i.items().each(function(i){i.refToView().each(function(s){if(""==s)return this.propertiesChanged[e.key]=!0,void 0;var r=this.node.ownerDocument.getElementById(this.id+s);return r?(n[r.id]&&t!=i.value()||(r.setAttributeNS(null,"display",t==i.value()?"inherit":"none"),n[r.id]=r),ORYX.Editor.checkClassType(r,SVGImageElement)&&r.setAttributeNS("http://www.w3.org/1999/xlink","href",r.getAttributeNS("http://www.w3.org/1999/xlink","href")),void 0):(this.propertiesChanged[e.key]=!0,void 0)}.bind(this))}.bind(this))}else i.refToView().each(function(n){if(""===n)return this.propertiesChanged[e.key]=!0,void 0;var s=this.id+n,r=this.node.ownerDocument.getElementById(s);if(!r||!r.ownerSVGElement){if(i.type()!==ORYX.CONFIG.TYPE_URL&&i.type()!==ORYX.CONFIG.TYPE_DIAGRAM_LINK)return this.propertiesChanged[e.key]=!0,void 0;var o=this.node.ownerDocument.getElementsByTagNameNS("http://www.w3.org/2000/svg","a");if(r=$A(o).find(function(e){return e.getAttributeNS(null,"id")===s}),!r)return this.propertiesChanged[e.key]=!0,void 0}if(i.complexAttributeToView()){var a=this._labels[s];if(a)try{propJson=t.evalJSON();var h=propJson[i.complexAttributeToView()];a.text(h?h:t)}catch(l){a.text(t)}}else switch(i.type()){case ORYX.CONFIG.TYPE_BOOLEAN:"string"==typeof t&&(t="true"===t),r.setAttributeNS(null,"display",t!==i.inverseBoolean()?"inherit":"none");break;case ORYX.CONFIG.TYPE_COLOR:i.fill()&&("stop"===r.tagName.toLowerCase()?(r.setAttributeNS(null,"stop-color",t),"radialgradient"===r.parentNode.tagName.toLowerCase()&&ORYX.Utils.adjustGradient(r.parentNode,r)):r.setAttributeNS(null,"fill",t)),i.stroke()&&(r.setAttributeNS(null,"stroke",t),"stop"===r.tagName.toLowerCase()&&(r.setAttributeNS(null,"stop-color",t),"radialgradient"===r.parentNode.tagName.toLowerCase()&&ORYX.Utils.adjustGradient(r.parentNode,r)));break;case ORYX.CONFIG.TYPE_STRING:var a=this._labels[s];a&&a.text(t);break;case ORYX.CONFIG.TYPE_INTEGER:var a=this._labels[s];a&&a.text(t);break;case ORYX.CONFIG.TYPE_FLOAT:if(i.fillOpacity()&&r.setAttributeNS(null,"fill-opacity",t),i.strokeOpacity()&&r.setAttributeNS(null,"stroke-opacity",t),!i.fillOpacity()&&!i.strokeOpacity()){var a=this._labels[s];a&&a.text(t)}break;case ORYX.CONFIG.TYPE_URL:case ORYX.CONFIG.TYPE_CALLEDELEMENT:var c=r.getAttributeNodeNS("","onclick");if(c)if(t&&t.length>0){var d=ORYX.EDITOR.getSerializedJSON(),u=jsonPath(d.evalJSON(),"$.properties.package");Ext.Ajax.request({url:ORYX.PATH+"calledelement",method:"POST",success:function(e){try{c.textContent=e.responseText.length>0&&"false"!=e.responseText?"new ImageViewer({title: 'Process Image', width: '650', height: '450', autoScroll: true, fixedcenter: true, src: '"+e.responseText+"',hideAction: 'close'}).show();":"Ext.Msg.alert('Unable to show process image.');"}catch(t){c.textContent="Ext.Msg.alert('Unable to show process image:"+t+"');"}}.bind(this),failure:function(){c.textContent="Ext.Msg.alert('Unable to show process image.');"},params:{profile:ORYX.PROFILE,uuid:ORYX.UUID,ppackage:u,pid:t,action:"imageview"}})}else c.textContent="Ext.Msg.alert('No Callable Element specified.');";else if(t&&t.length>0){var d=ORYX.EDITOR.getSerializedJSON(),u=jsonPath(d.evalJSON(),"$.properties.package");Ext.Ajax.request({url:ORYX.PATH+"calledelement",method:"POST",success:function(e){try{e.responseText.length>0&&"false"!=e.responseText?r.setAttributeNS("","onclick","new ImageViewer({title: 'Process Image', width: '650', height: '450', autoScroll: true, fixedcenter: true, src: '"+e.responseText+"',hideAction: 'close'}).show();"):r.setAttributeNS("","onclick","Ext.Msg.alert('Unable to find process image.');")}catch(t){r.setAttributeNS("","onclick","Ext.Msg.alert('Unable to find process image: "+t+"');"),ORYX.EDITOR._pluginFacade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:"Error resolving process image :\n"+t,title:""})}}.bind(this),failure:function(){r.setAttributeNS("","onclick","Ext.Msg.alert('Unable to find process image.');")},params:{profile:ORYX.PROFILE,uuid:ORYX.UUID,ppackage:u,pid:t,action:"imageview"}})}else r.setAttributeNS("","onclick","Ext.Msg.alert('No Callable Element specified.');");break;case ORYX.CONFIG.TYPE_DIAGRAM_LINK:var g=r.getAttributeNodeNS("http://www.w3.org/1999/xlink","xlink:onclick");g?g.textContent=t:r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:onclick",t)}}.bind(this))}}.bind(this)),this._labels.values().each(function(e){e.update()}))},layout:function(){var e=this.getStencil().layout();this instanceof ORYX.Core.Node&&e&&e.each(function(e){e.shape=this,e.forceExecution=!0,this._delegateEvent(e)}.bind(this))},getLabels:function(){return this._labels.values()},getDockers:function(){return this.dockers},getMagnets:function(){return this.magnets},getDefaultMagnet:function(){return this._defaultMagnet?this._defaultMagnet:this.magnets.length>0?this.magnets[0]:void 0},getParentShape:function(){return this.parent},getIncomingShapes:function(e){return e&&this.incoming.each(e),this.incoming},getIncomingNodes:function(e){return this.incoming.select(function(t){var i=t instanceof ORYX.Core.Node;return i&&e&&e(t),i})},getOutgoingShapes:function(e){return e&&this.outgoing.each(e),this.outgoing},getOutgoingNodes:function(e){return this.outgoing.select(function(t){var i=t instanceof ORYX.Core.Node;return i&&e&&e(t),i})},getAllDockedShapes:function(e){var t=this.incoming.concat(this.outgoing);return e&&t.each(e),t},getCanvas:function(){return this.parent instanceof ORYX.Core.Canvas?this.parent:this.parent instanceof ORYX.Core.Shape?this.parent.getCanvas():void 0},getChildNodes:function(e,t){if(e||t){var i=[];return this.nodes.each(function(n){n.isVisible&&(t&&t(n),i.push(n),e&&n instanceof ORYX.Core.Shape&&(i=i.concat(n.getChildNodes(e,t))))}),i}return this.nodes.clone()},add:function(e,t){if(e instanceof ORYX.Core.UIObject&&!(e instanceof ORYX.Core.Edge))if(this.children.member(e))ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object.");else{e.parent&&e.parent.remove(e),void 0!=t?this.children.splice(t,0,e):this.children.push(e),e.parent=this;var i;if(e instanceof ORYX.Core.Node)i=this.node.childNodes[0].childNodes[1],this.nodes.push(e);else if(e instanceof ORYX.Core.Controls.Control){var n=this.node.childNodes[1];e instanceof ORYX.Core.Controls.Docker?(i=n.childNodes[0],this.dockers.length>=2?this.dockers.splice(void 0!==t?Math.min(t,this.dockers.length-1):this.dockers.length-1,0,e):this.dockers.push(e)):e instanceof ORYX.Core.Controls.Magnet?(i=n.childNodes[1],this.magnets.push(e)):i=n}else i=this.node;e.node=void 0!=t&&t<i.childNodes.length?i.insertBefore(e.node,i.childNodes[t]):i.appendChild(e.node),this._changed(),this.eventHandlerCallback&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})}else ORYX.Log.warn("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e){this.children.member(e)?(this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e instanceof ORYX.Core.Controls.Control&&(e instanceof ORYX.Core.Controls.Docker?(e.node=this.node.childNodes[1].childNodes[0].removeChild(e.node),this.dockers=this.dockers.without(e)):e instanceof ORYX.Core.Controls.Magnet?(e.node=this.node.childNodes[1].childNodes[1].removeChild(e.node),this.magnets=this.magnets.without(e)):e.node=this.node.childNodes[1].removeChild(e.node)),this._changed()):ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},getIntersectionPoint:function(){var e,t,i,n;switch(arguments.length){case 2:e=arguments[0].x,t=arguments[0].y,i=arguments[1].x,n=arguments[1].y;break;case 4:e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3];break;default:throw"getIntersectionPoints needs two or four arguments"}var s,r,o,a,h=this.absoluteBounds();if(this.isPointIncluded(e,t,h)?(s=e,r=t):(o=e,a=t),this.isPointIncluded(i,n,h)?(s=i,r=n):(o=i,a=n),!(s&&r&&o&&a))return void 0;for(var l,c,d=0,u=0;;){var d=Math.min(s,o)+(Math.max(s,o)-Math.min(s,o))/2,u=Math.min(r,a)+(Math.max(r,a)-Math.min(r,a))/2;this.isPointIncluded(d,u,h)?(s=d,r=u):(o=d,a=u);var g=Math.sqrt(Math.pow(s-o,2)+Math.pow(r-a,2));if(l=s+(o-s)/g,c=r+(a-r)/g,!this.isPointIncluded(l,c,h))break}return{x:l,y:c}},isPointIncluded:function(){return!1},isPointOverOffset:function(){return this.isPointIncluded.apply(this,arguments)},_dockerChanged:function(){},createDocker:function(e,t){var i=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return i.bounds.registerCallback(this._dockerChangedCallback),t&&i.bounds.centerMoveTo(t),this.add(i,e),i},serialize:function(){var e=arguments.callee.$.serialize.apply(this);return e.push({name:"bounds",prefix:"oryx",value:this.bounds.serializeForERDF(),type:"literal"}),this.getOutgoingShapes().each(function(t){e.push({name:"outgoing",prefix:"raziel",value:"#"+ERDF.__stripHashes(t.resourceId),type:"resource"})}.bind(this)),e.push({name:"parent",prefix:"raziel",value:"#"+ERDF.__stripHashes(this.parent.resourceId),type:"resource"}),e},deserialize:function(e){arguments.callee.$.deserialize.apply(this,arguments);var t=e.find(function(e){return"oryx-bounds"==e.prefix+"-"+e.name});if(t){var i=t.value.replace(/,/g," ").split(" ").without("");this instanceof ORYX.Core.Edge?(this.dockers.first().bounds.centerMoveTo(parseFloat(i[0]),parseFloat(i[1])),this.dockers.last().bounds.centerMoveTo(parseFloat(i[2]),parseFloat(i[3]))):this.bounds.set(parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]))}},_init:function(e){this._adjustIds(e,0)},_adjustIds:function(e,t){if(e instanceof Element){var i=e.getAttributeNS(null,"id");i&&""!==i?e.setAttributeNS(null,"id",this.id+i):(e.setAttributeNS(null,"id",this.id+"_"+this.id+"_"+t),t++);var n=e.getAttributeNS(null,"fill");if(n&&n.include("url(#")&&(n=n.replace(/url\(#/g,"url(#"+this.id),e.setAttributeNS(null,"fill",n)),e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++)t=this._adjustIds(e.childNodes[s],t)}return t},toString:function(){return"ORYX.Core.Shape "+this.getId()}},ORYX.Core.Shape=ORYX.Core.AbstractShape.extend(ORYX.Core.Shape),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Control=ORYX.Core.UIObject.extend({toString:function(){return"Control "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Magnet=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.bounds.set(0,0,16,16),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"4",stroke:"none",fill:"red","fill-opacity":"0.3"}]]),this.hide()},update:function(){arguments.callee.$.update.apply(this,arguments)},_update:function(){arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft();this.node.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")")},show:function(){arguments.callee.$.show.apply(this,arguments)},toString:function(){return"Magnet "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Docker=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.bounds.set(0,0,16,16),this.referencePoint=void 0,this._dockedShapeBounds=void 0,this._dockedShape=void 0,this._oldRefPoint1=void 0,this._oldRefPoint2=void 0,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g"]),this._dockerNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"8",stroke:"none",fill:"none"}],["circle",{cx:"8",cy:"8",r:"3",stroke:"black",fill:"red","stroke-width":"1"}]]),this._referencePointNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"none"},["circle",{cx:this.bounds.upperLeft().x,cy:this.bounds.upperLeft().y,r:3,fill:"red","fill-opacity":.4}]]),this.hide(),this.addEventHandlers(this.node),this._updateCallback=this._changed.bind(this)},update:function(){if(this._dockedShape){if(this._dockedShapeBounds&&this._dockedShape instanceof ORYX.Core.Node){var e=this._dockedShapeBounds.width(),t=this._dockedShapeBounds.height();e||(e=1),t||(t=1);var i=this._dockedShape.bounds.width()/e,n=this._dockedShape.bounds.height()/t;(1!==i||1!==n)&&(this.referencePoint.x*=i,this.referencePoint.y*=n),this._dockedShapeBounds=this._dockedShape.bounds.clone()}var s=this.parent.dockers.indexOf(this),r=this,o=this.parent.dockers.length>1?0===s?this.parent.dockers[s+1]:this.parent.dockers[s-1]:void 0,a=r.getDockedShape()?r.getAbsoluteReferencePoint():r.bounds.center(),h=o&&o.getDockedShape()?o.getAbsoluteReferencePoint():o?o.bounds.center():void 0;if(!h){var l=this._dockedShape.absoluteCenterXY(),c=this._dockedShape.bounds.width()*this._dockedShape.bounds.height();h={x:a.x+(l.x-a.x)*-c,y:a.y+(l.y-a.y)*-c}}var d=void 0;if(d=this._dockedShape.getIntersectionPoint(a,h),d||(d=this.getAbsoluteReferencePoint()),this.parent&&this.parent.parent){var u=this.parent.parent.absoluteXY();d.x-=u.x,d.y-=u.y}this.bounds.centerMoveTo(d),this._oldRefPoint1=a,this._oldRefPoint2=h}arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft();if(this._dockerNode.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")"),e=Object.clone(this.referencePoint),e&&this._dockedShape){var t;t=this.parent instanceof ORYX.Core.Edge?this._dockedShape.absoluteXY():this._dockedShape.bounds.upperLeft(),e.x+=t.x,e.y+=t.y}else e=this.bounds.center();this._referencePointNode.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")")},setReferencePoint:function(e){this.referencePoint===e||this.referencePoint&&e&&this.referencePoint.x===e.x&&this.referencePoint.y===e.y||(this.referencePoint=e,this._changed())},getAbsoluteReferencePoint:function(){if(this.referencePoint&&this._dockedShape){var e=this._dockedShape.absoluteXY();return{x:this.referencePoint.x+e.x,y:this.referencePoint.y+e.y}}return void 0},setDockedShape:function(e){this._dockedShape&&(this._dockedShape.bounds.unregisterCallback(this._updateCallback),this===this.parent.dockers.first()?(this.parent.incoming=this.parent.incoming.without(this._dockedShape),this._dockedShape.outgoing=this._dockedShape.outgoing.without(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing=this.parent.outgoing.without(this._dockedShape),this._dockedShape.incoming=this._dockedShape.incoming.without(this.parent))),this._dockedShape=e,this._dockedShapeBounds=void 0;var t=void 0;if(this._dockedShape){this===this.parent.dockers.first()?(this.parent.incoming.push(e),e.outgoing.push(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing.push(e),e.incoming.push(this.parent));var i=this.bounds,n=e.absoluteXY();t={x:i.center().x-n.x,y:i.center().y-n.y},this._dockedShapeBounds=this._dockedShape.bounds.clone(),this._dockedShape.bounds.registerCallback(this._updateCallback),this.setDockerColor(ORYX.CONFIG.DOCKER_DOCKED_COLOR)}else this.setDockerColor(ORYX.CONFIG.DOCKER_UNDOCKED_COLOR);this.setReferencePoint(t),this._changed()},getDockedShape:function(){return this._dockedShape},isDocked:function(){return!!this._dockedShape},setDockerColor:function(e){this._dockerNode.lastChild.setAttributeNS(null,"fill",e)},hide:function(){this.node.setAttributeNS(null,"visibility","hidden"),this.children.each(function(e){e.hide()})},show:function(){this.node.setAttributeNS(null,"visibility","visible"),this.children.each(function(e){e.show()})},toString:function(){return"Docker "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Node={construct:function(){arguments.callee.$.construct.apply(this,arguments),this.isSelectable=!0,this.isMovable=!0,this._dockerUpdated=!1,this._oldBounds=new ORYX.Core.Bounds,this._svgShapes=[],this.minimumSize=void 0,this.maximumSize=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.dataId=void 0,this._init(this._stencil.view())},setSelectable:function(e){this.isSelectable=e},setMovable:function(e){this.isMovable=e},_update:function(){if(this.dockers.invoke("update"),this.isChanged){var e=this.bounds,t=this._oldBounds;if(this.isResized){var i=e.width()/t.width(),n=e.height()/t.height();this._svgShapes.each(function(s){s.isHorizontallyResizable&&(s.width=s.oldWidth*i),s.isVerticallyResizable&&(s.height=s.oldHeight*n);var r,o=s.anchorLeft,a=s.anchorRight;a?(r=t.width()-(s.oldX+s.oldWidth),o?s.width=e.width()-s.x-r:s.x=e.width()-(r+s.width)):o||(s.x=i*s.oldX,s.isHorizontallyResizable||(s.x=s.x+s.width*i/2-s.width/2));var h=s.anchorTop,l=s.anchorBottom;l?(r=t.height()-(s.oldY+s.oldHeight),h?s.height=e.height()-s.y-r:s._isYLocked||(s.y=e.height()-(r+s.height))):h||(s.y=n*s.oldY,s.isVerticallyResizable||(s.y=s.y+s.height*n/2-s.height/2))});var s={x:0,y:0};this.isHorizontallyResizable||e.width()===t.width()||(s.x=t.width()-e.width()),this.isVerticallyResizable||e.height()===t.height()||(s.y=t.height()-e.height()),(0!==s.x||0!==s.y)&&e.extend(s),s={x:0,y:0};var r,o;this.minimumSize&&(ORYX.Log.debug("Shape (%0)'s min size: (%1x%2)",this,this.minimumSize.width,this.minimumSize.height),r=this.minimumSize.width-e.width(),r>0&&(s.x+=r),o=this.minimumSize.height-e.height(),o>0&&(s.y+=o)),this.maximumSize&&(ORYX.Log.debug("Shape (%0)'s max size: (%1x%2)",this,this.maximumSize.width,this.maximumSize.height),r=e.width()-this.maximumSize.width,r>0&&(s.x-=r),o=e.height()-this.maximumSize.height,o>0&&(s.y-=o)),(0!==s.x||0!==s.y)&&e.extend(s);var a,h,l,c,d,u,g,i=e.width()/t.width(),n=e.height()/t.height();this.magnets.each(function(s){a=s.anchorLeft,h=s.anchorRight,l=s.anchorTop,c=s.anchorBottom,d=s.bounds.center(),u=a?d.x:h?e.width()-(t.width()-d.x):d.x*i,g=l?d.y:c?e.height()-(t.height()-d.y):d.y*n,(d.x!==u||d.y!==g)&&s.bounds.centerMoveTo(u,g)}),this.getLabels().each(function(s){a=s.anchorLeft,h=s.anchorRight,l=s.anchorTop,c=s.anchorBottom,a||(h?s.x=e.width()-(t.width()-s.oldX):s.x*=i),l||(c?s.y=e.height()-(t.height()-s.oldY):s.y*=n)});var f=this.dockers[0];f&&(f.bounds.unregisterCallback(this._dockerChangedCallback),this._dockerUpdated||(f.bounds.centerMoveTo(this.bounds.center()),this._dockerUpdated=!1),f.update(),f.bounds.registerCallback(this._dockerChangedCallback)),this.isResized=!1}this.refresh(),this.isChanged=!1,this._oldBounds=this.bounds.clone()}this.children.each(function(e){e instanceof ORYX.Core.Controls.Docker||e._update()}),this.dockers.length>0&&!this.dockers.first().getDockedShape()&&this.dockers.each(function(e){e.bounds.centerMoveTo(this.bounds.center())}.bind(this))},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft().x,t=this.bounds.upperLeft().y;this.node.firstChild.setAttributeNS(null,"transform","translate("+e+", "+t+")"),this.node.childNodes[1].childNodes[1].setAttributeNS(null,"transform","translate("+e+", "+t+")"),this._svgShapes.each(function(e){e.update()})},_dockerChanged:function(){var e=this.dockers[0];this.bounds.centerMoveTo(e.bounds.center()),this._dockerUpdated=!0},_initSVGShapes:function(e){var t=[];try{var i=new ORYX.Core.SVG.SVGShape(e);t.push(i)}catch(n){}if(e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++)t=t.concat(this._initSVGShapes(e.childNodes[s]));return t},isPointIncluded:function(e,t,i){var n=i&&i instanceof ORYX.Core.Bounds?i:this.absoluteBounds();if(!n.isIncluded(e,t))return!1;var s=n.upperLeft(),r=e-s.x,o=t-s.y,a=0;do var h=this._svgShapes[a++].isPointIncluded(r,o);while(!h&&a<this._svgShapes.length);return h},isPointOverOffset:function(e,t){var i=arguments.callee.$.isPointOverOffset.apply(this,arguments);if(i){var n=this.absoluteBounds();if(n.widen(-ORYX.CONFIG.BORDER_OFFSET),!n.isIncluded(e,t))return!0}return!1},serialize:function(){var e=arguments.callee.$.serialize.apply(this);this.dockers.each(function(t){if(t.getDockedShape()){var i=t.referencePoint;i=i?i:t.bounds.center(),e.push({name:"docker",prefix:"oryx",value:$H(i).values().join(","),type:"literal"})}}.bind(this));try{var t=this.getStencil().serialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}return e},deserialize:function(e){arguments.callee.$.deserialize.apply(this,[e]);try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}var n=e.findAll(function(e){return"raziel-outgoing"==e.prefix+"-"+e.name});if(n.each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t instanceof ORYX.Core.Edge?(t.dockers.first().setDockedShape(this),t.dockers.first().setReferencePoint(t.dockers.first().bounds.center())):t.dockers.length>0&&t.dockers.first().setDockedShape(this))}}.bind(this)),1===this.dockers.length){var s;if(s=e.find(function(e){return"oryx-dockers"==e.prefix+"-"+e.name})){var r=s.value.replace(/,/g," ").split(" ").without("").without("#");2===r.length&&this.dockers[0].getDockedShape()?this.dockers[0].setReferencePoint({x:parseFloat(r[0]),y:parseFloat(r[1])}):this.dockers[0].bounds.centerMoveTo(parseFloat(r[0]),parseFloat(r[1]))}}},_init:function(e){arguments.callee.$._init.apply(this,arguments);var t=e.getElementsByTagName("g")[0],i=e.ownerDocument.createAttributeNS(null,"title");i.nodeValue=this.getStencil().title(),t.setAttributeNode(i);var n=e.ownerDocument.createAttributeNS(null,"id");n.nodeValue=this.id,t.setAttributeNode(n);var s=this.node.childNodes[0].childNodes[0];t=s.appendChild(t),this.addEventHandlers(t);var r=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"minimumSize");if(r){r=r.replace("/,/g"," ");var o=r.split(" ");o=o.without(""),this.minimumSize=o.length>1?{width:parseFloat(o[0]),height:parseFloat(o[1])}:{width:1,height:1}}var a=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"maximumSize");if(a){a=a.replace("/,/g"," ");var h=a.split(" ");h=h.without(""),h.length>1&&(this.maximumSize={width:parseFloat(h[0]),height:parseFloat(h[1])})}if(this.minimumSize&&this.maximumSize&&(this.minimumSize.width>this.maximumSize.width||this.minimumSize.height>this.maximumSize.height))throw this+": Minimum Size must be greater than maxiumSize.";this._svgShapes=this._initSVGShapes(t);var l={x:void 0,y:void 0},c={x:void 0,y:void 0},d=this;this._svgShapes.each(function(e){l.x=void 0!==l.x?Math.min(l.x,e.x):e.x,l.y=void 0!==l.y?Math.min(l.y,e.y):e.y,c.x=void 0!==c.x?Math.max(c.x,e.x+e.width):e.x+e.width,c.y=void 0!==c.y?Math.max(c.y,e.y+e.height):e.y+e.height,e.isHorizontallyResizable&&(d.isHorizontallyResizable=!0,d.isResizable=!0),e.isVerticallyResizable&&(d.isVerticallyResizable=!0,d.isResizable=!0),e.anchorTop&&e.anchorBottom&&(d.isVerticallyResizable=!0,d.isResizable=!0),e.anchorLeft&&e.anchorRight&&(d.isHorizontallyResizable=!0,d.isResizable=!0)}),this._svgShapes.each(function(e){e.x-=l.x,e.y-=l.y,e.update()});var u=l.x,g=l.y;c.x-=u,c.y-=g,l.x=0,l.y=0,0===c.x&&(c.x=1),0===c.y&&(c.y=1),this._oldBounds.set(l,c),this.bounds.set(l,c);var f=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnets");if(f&&f.length>0){f=$A(f[0].getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnet"));var d=this;f.each(function(e){var t=new ORYX.Core.Controls.Magnet({eventHandlerCallback:d.eventHandlerCallback}),i=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),n=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));t.bounds.centerMoveTo({x:i-u,y:n-g});var s=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(s){s=s.replace("/,/g"," "),s=s.split(" ").without("");for(var r=0;r<s.length;r++)switch(s[r].toLowerCase()){case"left":t.anchorLeft=!0;break;case"right":t.anchorRight=!0;break;case"top":t.anchorTop=!0;break;case"bottom":t.anchorBottom=!0}}if(d.add(t),!this._defaultMagnet){var o=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"default");o&&"yes"===o.toLowerCase()&&(d._defaultMagnet=t)}})}else{var p=new ORYX.Core.Controls.Magnet;p.bounds.centerMoveTo(this.bounds.width()/2,this.bounds.height()/2),this.add(p)}var O=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"docker");if(O&&O.length>0){O=O[0];var m=this.createDocker(),_=parseFloat(O.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),R=parseFloat(O.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));m.bounds.centerMoveTo({x:_-u,y:R-g});var E=O.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(E){E=E.replace("/,/g"," "),E=E.split(" ").without("");for(var S=0;S<E.length;S++)switch(E[S].toLowerCase()){case"left":m.anchorLeft=!0;break;case"right":m.anchorRight=!0;break;case"top":m.anchorTop=!0;break;case"bottom":m.anchorBottom=!0}}}var v=t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(v).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});t.x-=u,t.y-=g,this._labels[t.id]=t}.bind(this))},createDocker:function(){var e=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return e.bounds.registerCallback(this._dockerChangedCallback),this.dockers.push(e),e.parent=this,e.bounds.registerCallback(this._changedCallback),e},toString:function(){return this._stencil.title()+" "+this.id}},ORYX.Core.Node=ORYX.Core.Shape.extend(ORYX.Core.Node),NAMESPACE_SVG="http://www.w3.org/2000/svg",NAMESPACE_ORYX="http://www.b3mn.org/oryx",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Edge={construct:function(e,t){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.isSelectable=!0,this._dockerUpdated=!1,this._markers=new Hash,this._paths=[],this._interactionPaths=[],this._dockersByPath=new Hash,this._markersByPath=new Hash,this.attachedNodePositionData=new Hash;var i=this.node.childNodes[0].childNodes[0];i=ORYX.Editor.graft("http://www.w3.org/2000/svg",i,["g",{"pointer-events":"painted"}]),this.addEventHandlers(i),this._oldBounds=this.bounds.clone(),this._init(this._stencil.view()),t instanceof Array&&this.deserialize(t)},setSelectable:function(e){this.isSelectable=e},setMovable:function(e){this.isMovable=e},_update:function(e){if(this._dockerUpdated||this.isChanged||e){this.dockers.invoke("update"),(0===this.bounds.width()||0===this.bounds.height())&&(this.bounds.moveBy({x:0===this.bounds.width()?-1:0,y:0===this.bounds.height()?-1:0}),this.bounds.extend({x:0===this.bounds.width()?2:0,y:0===this.bounds.height()?2:0}));var t=this.bounds.upperLeft(),i=this._oldBounds.upperLeft(),n=0===this._oldBounds.width()?this.bounds.width():this._oldBounds.width(),s=0===this._oldBounds.height()?this.bounds.height():this._oldBounds.height(),r=t.x-i.x,o=t.y-i.y,a=this.bounds.width()/n,h=this.bounds.height()/s;if(this.dockers.each(function(e){if(e.bounds.unregisterCallback(this._dockerChangedCallback),!this._dockerUpdated&&(e.bounds.moveBy(r,o),1!==a||1!==h)){var i=e.bounds.upperLeft().x-t.x,n=e.bounds.upperLeft().y-t.y;e.bounds.moveTo(t.x+i*a,t.y+n*h)}e.update(),e.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerUpdated){var l=this.dockers.first().bounds.center(),c=this.dockers.first().bounds.center();this.dockers.each(function(e){var t=e.bounds.center();l.x=Math.min(l.x,t.x),l.y=Math.min(l.y,t.y),c.x=Math.max(c.x,t.x),c.y=Math.max(c.y,t.y)}.bind(this)),this.bounds.set(Object.clone(l),Object.clone(c))}this.getLabels().each(function(e){switch(e.edgePosition){case"freeMoved":e.x=e.x,e.y=e.y;break;case"starttop":var t=this._getAngle(this.dockers[0],this.dockers[1]),i=this.dockers.first().bounds.center();90>=t||t>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=i.x+e.getOffsetTop(),e.y=i.y-e.getOffsetTop(),e.rotate(360-t,i)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=i.x-e.getOffsetTop(),e.y=i.y-e.getOffsetTop(),e.rotate(180-t,i));break;case"startbottom":var t=this._getAngle(this.dockers[0],this.dockers[1]),i=this.dockers.first().bounds.center();90>=t||t>270?(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=i.x+e.getOffsetBottom(),e.y=i.y+e.getOffsetBottom(),e.rotate(360-t,i)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=i.x-e.getOffsetBottom(),e.y=i.y+e.getOffsetBottom(),e.rotate(180-t,i));break;case"midtop":var n=this.dockers.length;if(0==n%2){var t=this._getAngle(this.dockers[n/2-1],this.dockers[n/2]),s=this.dockers[n/2-1].bounds.center(),r=this.dockers[n/2].bounds.center(),i={x:(s.x+r.x)/2,y:(s.y+r.y)/2};e.horizontalAlign("center"),e.verticalAlign("bottom"),e.x=i.x,e.y=i.y-e.getOffsetTop(),90>=t||t>270?e.rotate(360-t,i):e.rotate(180-t,i)}else{var o=parseInt(n/2),t=this._getAngle(this.dockers[o],this.dockers[o+1]),i=this.dockers[o].bounds.center();90>=t||t>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=i.x+e.getOffsetTop(),e.y=i.y-e.getOffsetTop(),e.rotate(360-t,i)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=i.x-e.getOffsetTop(),e.y=i.y-e.getOffsetTop(),e.rotate(180-t,i))}break;case"midbottom":var n=this.dockers.length;if(0==n%2){var t=this._getAngle(this.dockers[n/2-1],this.dockers[n/2]),s=this.dockers[n/2-1].bounds.center(),r=this.dockers[n/2].bounds.center(),i={x:(s.x+r.x)/2,y:(s.y+r.y)/2};
e.horizontalAlign("center"),e.verticalAlign("top"),e.x=i.x,e.y=i.y+e.getOffsetTop(),90>=t||t>270?e.rotate(360-t,i):e.rotate(180-t,i)}else{var o=parseInt(n/2),t=this._getAngle(this.dockers[o],this.dockers[o+1]),i=this.dockers[o].bounds.center();90>=t||t>270?(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=i.x+e.getOffsetBottom(),e.y=i.y+e.getOffsetBottom(),e.rotate(360-t,i)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=i.x-e.getOffsetBottom(),e.y=i.y+e.getOffsetBottom(),e.rotate(180-t,i))}break;case"endtop":var a=this.dockers.length,t=this._getAngle(this.dockers[a-2],this.dockers[a-1]),i=this.dockers.last().bounds.center();90>=t||t>270?(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=i.x-e.getOffsetTop(),e.y=i.y-e.getOffsetTop(),e.rotate(360-t,i)):(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=i.x+e.getOffsetTop(),e.y=i.y-e.getOffsetTop(),e.rotate(180-t,i));break;case"endbottom":var a=this.dockers.length,t=this._getAngle(this.dockers[a-2],this.dockers[a-1]),i=this.dockers.last().bounds.center();90>=t||t>270?(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=i.x-e.getOffsetBottom(),e.y=i.y+e.getOffsetBottom(),e.rotate(360-t,i)):(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=i.x+e.getOffsetBottom(),e.y=i.y+e.getOffsetBottom(),e.rotate(180-t,i))}}.bind(this)),this.children.each(function(e){e instanceof ORYX.Core.Node&&this.calculatePositionOfAttachedChildNode.call(this,e)}.bind(this)),this.refreshAttachedNodes(),this.refresh(),this.isChanged=!1,this._dockerUpdated=!1,this._oldBounds=this.bounds.clone()}},movePointToUpperLeftOfNode:function(e,t){e.x-=t.width()/2,e.y-=t.height()/2},refreshAttachedNodes:function(){this.attachedNodePositionData.values().each(function(e){var t=e.segment.docker1.bounds.center(),i=e.segment.docker2.bounds.center();this.relativizePoint(t),this.relativizePoint(i);var n=new Object;n.x=t.x+e.relativDistanceFromDocker1*(i.x-t.x),n.y=t.y+e.relativDistanceFromDocker1*(i.y-t.y),this.movePointToUpperLeftOfNode(n,e.node.bounds),e.node.bounds.moveTo(n),e.node._update()}.bind(this))},calculatePositionOfAttachedChildNode:function(e){var t=new Object;t.x=0,t.y=0,this.attachedNodePositionData[e.getId()]?e.isChanged&&this.findEdgeSegmentForNode(e):(this.attachedNodePositionData[e.getId()]=new Object,this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=0,this.attachedNodePositionData[e.getId()].node=e,this.attachedNodePositionData[e.getId()].segment=new Object,this.findEdgeSegmentForNode(e))},findEdgeSegmentForNode:function(e){var t=this.dockers.length,n=void 0;for(i=1;t>i;i++){var s=this.dockers[i-1].bounds.center(),r=this.dockers[i].bounds.center();this.relativizePoint(s),this.relativizePoint(r);var o=e.bounds.center(),a=ORYX.Core.Math.distancePointLinie(s,r,o,!0);(a||0==a)&&(!n&&0!=n||n>a)&&(n=a,this.attachedNodePositionData[e.getId()].segment.docker1=this.dockers[i-1],this.attachedNodePositionData[e.getId()].segment.docker2=this.dockers[i]),a||n||0==n||(this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=ORYX.Core.Math.getDistancePointToPoint(o,s)<ORYX.Core.Math.getDistancePointToPoint(o,r)?0:1,this.attachedNodePositionData[e.getId()].segment.docker1=this.dockers[i-1],this.attachedNodePositionData[e.getId()].segment.docker2=this.dockers[i])}(n||0==n)&&(this.attachedNodePositionData[e.getId()].relativDistanceFromDocker1=this.getLineParameterForPosition(this.attachedNodePositionData[e.getId()].segment.docker1,this.attachedNodePositionData[e.getId()].segment.docker2,e))},getLineParameterForPosition:function(e,t,i){var n=e.bounds.center(),s=t.bounds.center();this.relativizePoint(n),this.relativizePoint(s);var r=ORYX.Core.Math.getPointOfIntersectionPointLine(n,s,i.bounds.center(),!0);if(!r)return 0;var o=ORYX.Core.Math.getDistancePointToPoint(r,n)/ORYX.Core.Math.getDistancePointToPoint(n,s);return o},relativizePoint:function(e){e.x-=this.bounds.upperLeft().x,e.y-=this.bounds.upperLeft().y},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e;if(this._paths.each(function(t,i){var n=this._dockersByPath[t.id],s=void 0,r=void 0;e?r="M"+e.x+" "+e.y:(s=n[0].bounds.center(),e=s,r="M"+s.x+" "+s.y);for(var o=1;o<n.length;o++)s=n[o].bounds.center(),r=r+"L"+s.x+" "+s.y+" ",e=s;t.setAttributeNS(null,"d",r),this._interactionPaths[i].setAttributeNS(null,"d",r)}.bind(this)),this.getChildNodes().length>0){var t=this.bounds.upperLeft().x,i=this.bounds.upperLeft().y;this.node.firstChild.childNodes[1].setAttributeNS(null,"transform","translate("+t+", "+i+")")}},getIntersectionPoint:function(){var e=Math.floor(this.dockers.length/2);return ORYX.Core.Math.midPoint(this.dockers[e-1].bounds.center(),this.dockers[e].bounds.center())},isPointIncluded:function(e,t){var i=this.absoluteBounds().isIncluded(e,t,ORYX.CONFIG.OFFSET_EDGE_BOUNDS),n=void 0;if(i&&this.dockers.length>0){var s,r,o=0;do s=this.dockers[o].bounds.center(),r=this.dockers[++o].bounds.center(),n=ORYX.Core.Math.isPointInLine(e,t,s.x,s.y,r.x,r.y,ORYX.CONFIG.OFFSET_EDGE_BOUNDS);while(!n&&o<this.dockers.length-1)}return n},isPointOverOffset:function(){return!1},_getAngle:function(e,t){var i=e.absoluteCenterXY(),n=t.absoluteCenterXY();if(i.x==n.x&&i.y==n.y)return 0;var s=180*Math.asin(Math.sqrt(Math.pow(i.y-n.y,2))/Math.sqrt(Math.pow(n.x-i.x,2)+Math.pow(i.y-n.y,2)))/Math.PI;return n.x>=i.x&&n.y<=i.y?s:n.x<i.x&&n.y<=i.y?180-s:n.x<i.x&&n.y>i.y?180+s:360-s},alignDockers:function(){this._update(!0);var e=this.dockers.first().bounds.center(),t=this.dockers.last().bounds.center(),i=t.x-e.x,n=t.y-e.y,s=this.dockers.length-1;this.dockers.each(function(t,r){var o=r/s;t.bounds.unregisterCallback(this._dockerChangedCallback),t.bounds.moveTo(e.x+o*i,e.y+o*n),t.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerChanged()},add:function(e){if(arguments.callee.$.add.apply(this,arguments),e instanceof ORYX.Core.Controls.Docker&&this.dockers.include(e)){var t=this._dockersByPath.values()[0];t&&t.splice(this.dockers.indexOf(e),0,e),this.handleChildShapesAfterAddDocker(e)}},handleChildShapesAfterAddDocker:function(e){if(!e instanceof ORYX.Core.Controls.Docker)return void 0;var t=this.dockers.indexOf(e);if(!(t>0&&t<this.dockers.length-1))return void 0;var i=this.dockers[t-1],n=this.dockers[t+1],s=this.getAttachedNodePositionDataForSegment(i,n),r=ORYX.Core.Math.getDistancePointToPoint(i.bounds.center(),e.bounds.center()),o=ORYX.Core.Math.getDistancePointToPoint(n.bounds.center(),e.bounds.center());if(r+o){var a=r/(r+o);s.each(function(t){if(t.value.relativDistanceFromDocker1<a)t.value.segment.docker2=e,t.value.relativDistanceFromDocker1=t.value.relativDistanceFromDocker1/a;else{t.value.segment.docker1=e;var i=1-a,n=t.value.relativDistanceFromDocker1-a;t.value.relativDistanceFromDocker1=n/i}}),this.refreshAttachedNodes()}},getAttachedNodePositionDataForSegment:function(e,t){if(!(e instanceof ORYX.Core.Controls.Docker&&t instanceof ORYX.Core.Controls.Docker))return[];var i=this.attachedNodePositionData.findAll(function(i){return i.value.segment.docker1===e&&i.value.segment.docker2===t});return i?i:[]},remove:function(e){arguments.callee.$.remove.apply(this,arguments),this.attachedNodePositionData[e.getId()]&&delete this.attachedNodePositionData[e.getId()],e instanceof ORYX.Core.Controls.Docker&&this.handleChildShapesAfterRemoveDocker(e)},handleChildShapesAfterRemoveDocker:function(e){e instanceof ORYX.Core.Controls.Docker&&(this.attachedNodePositionData.each(function(t){if(t.value.segment.docker1===e){var i=this.dockers.indexOf(t.value.segment.docker2);if(-1==i)return;t.value.segment.docker1=this.dockers[i-1]}else if(t.value.segment.docker2===e){var i=this.dockers.indexOf(t.value.segment.docker1);if(-1==i)return;t.value.segment.docker2=this.dockers[i+1]}}.bind(this)),this.refreshAttachedNodes())},addDocker:function(e,t){var i,n;return this._dockersByPath.any(function(s){return s.value.any(function(r){if(i){var o=i.bounds.center(),a=r.bounds.center();if(ORYX.Core.Math.isPointInLine(e.x,e.y,o.x,o.y,a.x,a.y,10)){var h=this._paths.find(function(e){return e.id===s.key});if(h){var l=h.getAttributeNS(NAMESPACE_ORYX,"allowDockers");if(l&&"no"===l.toLowerCase())return!0}var c=t?t:this.createDocker(this.dockers.indexOf(i)+1,e);return c.bounds.centerMoveTo(e),t&&this.add(c,this.dockers.indexOf(i)+1),n=c,!0}return i=r,!1}return i=r,!1}.bind(this))}.bind(this)),n},removeDocker:function(e){this.dockers.length>2&&this.dockers.first()!==e&&this._dockersByPath.any(function(t){return t.value.member(e)?e===t.value.last()?!0:(this.remove(e),this._dockersByPath[t.key]=t.value.without(e),this.isChanged=!0,this._dockerChanged(),!0):!1}.bind(this))},removeUnusedDockers:function(){var e=$H({});return this.dockers.each(function(t,i){if(0!=i&&i!=this.dockers.length-1){var n=this.dockers[i-1];-1!=e.values().indexOf(n)&&this.dockers[i-2]&&(n=this.dockers[i-2]);var s=this.dockers[i+1],r=n.getDockedShape()&&n.referencePoint?n.getAbsoluteReferencePoint():n.bounds.center(),o=s.getDockedShape()&&s.referencePoint?s.getAbsoluteReferencePoint():s.bounds.center(),a=t.bounds.center();ORYX.Core.Math.isPointInLine(a.x,a.y,r.x,r.y,o.x,o.y,1)&&(e[i]=t)}}.bind(this)),e.each(function(e){this.removeDocker(e.value)}.bind(this)),e.values().length>0&&this._update(!0),e},_init:function(e){arguments.callee.$._init.apply(this,arguments);var t,i,n,s,r=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");if(r.length>0){r=r[0];var o,a=$A(r.getElementsByTagNameNS(NAMESPACE_SVG,"marker")),h=this;a.each(function(e){try{o=new ORYX.Core.SVG.SVGMarker(e.cloneNode(!0)),h._markers[o.id]=o;var t,i=$A(o.element.getElementsByTagNameNS(NAMESPACE_SVG,"text"));i.each(function(e){t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id}),h._labels[t.id]=t})}catch(n){}})}var l=e.getElementsByTagNameNS(NAMESPACE_SVG,"g");if(l.length<=0)throw"Edge: No g element found.";var c=l[0];c.setAttributeNS(null,"id",null);var d=!0;$A(c.childNodes).each(function(e,r){if(ORYX.Editor.checkClassType(e,SVGPathElement)){e=e.cloneNode(!1);var o=this.id+"_"+r;e.setAttributeNS(null,"id",o),this._paths.push(e);var a=[],h=e.getAttributeNS(null,"marker-start");if(h&&""!==h){h=h.strip(),h=h.replace(/^url\(#/,"");var l=this.id.concat(h.replace(/\)$/,""));e.setAttributeNS(null,"marker-start","url(#"+l+")"),a.push(this._markers[l])}if(h=e.getAttributeNS(null,"marker-mid"),h&&""!==h){h=h.strip(),h=h.replace(/^url\(#/,"");var c=this.id.concat(h.replace(/\)$/,""));e.setAttributeNS(null,"marker-mid","url(#"+c+")"),a.push(this._markers[c])}if(h=e.getAttributeNS(null,"marker-end"),h&&""!==h){h=h.strip(),h=h.replace(/^url\(#/,"");var u=this.id.concat(h.replace(/\)$/,""));e.setAttributeNS(null,"marker-end","url(#"+u+")"),a.push(this._markers[u])}this._markersByPath[o]=a;var g=new PathParser,f=new ORYX.Core.SVG.PointsPathHandler;if(g.setHandler(f),g.parsePath(e),f.points.length<4)throw"Edge: Path has to have two or more points specified.";this._dockersByPath[o]=[];for(var p=0;p<f.points.length;p+=2){var O=f.points[p],m=f.points[p+1];if(d||p>0){var _=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});_.bounds.centerMoveTo(O,m),_.bounds.registerCallback(this._dockerChangedCallback),this.add(_,this.dockers.length),t?(t=Math.min(O,t),i=Math.min(m,i)):(t=O,i=m),n?(n=Math.max(O,n),s=Math.max(m,s)):(n=O,s=m)}}d=!1}}.bind(this)),this.bounds.set(t,i,n,s),(0===this.bounds.width()||0===this.bounds.height())&&(this.bounds.extend({x:0===this.bounds.width()?2:0,y:0===this.bounds.height()?2:0}),this.bounds.moveBy({x:0===this.bounds.width()?-1:0,y:0===this.bounds.height()?-1:0})),this._oldBounds=this.bounds.clone(),this._paths.reverse();var u=[];this._paths.each(function(e){u.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(e))}.bind(this)),this._paths=u,this._paths.each(function(e){var t=e.cloneNode(!1);t.setAttributeNS(null,"id",void 0),t.setAttributeNS(null,"stroke-width",10),t.setAttributeNS(null,"visibility","hidden"),t.setAttributeNS(null,"stroke-dasharray","none"),t.setAttributeNS(null,"stroke","black"),t.setAttributeNS(null,"fill","none"),this._interactionPaths.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(t))}.bind(this)),this._paths.reverse(),this._interactionPaths.reverse();var g=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(g).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});this.node.childNodes[0].childNodes[0].appendChild(t.node),this._labels[t.id]=t}.bind(this)),this.node.childNodes[0].childNodes[0].setAttributeNS(null,"title",this.getStencil().title()),this.propertiesChanged.each(function(e){e.value=!0})},addMarkers:function(e){this._markers.each(function(t){e.ownerDocument.getElementById(t.value.id)||(t.value.element=e.appendChild(t.value.element))})},removeMarkers:function(){var e=this.node.ownerSVGElement;if(e){var t=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");t.length>0&&(t=t[0],this._markers.each(function(e){var i=t.ownerDocument.getElementById(e.value.id);i&&(e.value.element=t.removeChild(e.value.element))}))}},_dockerChanged:function(){this._dockerUpdated=!0},serialize:function(){var e=arguments.callee.$.serialize.apply(this),t="";this._dockersByPath.each(function(e){e.value.each(function(e){var i=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();t=t.concat(i.x+" "+i.y+" ")}),t+=" # "}.bind(this)),e.push({name:"dockers",prefix:"oryx",value:t,type:"literal"});var i=this.dockers.last(),n=i.getDockedShape();n&&e.push({name:"target",prefix:"raziel",value:"#"+ERDF.__stripHashes(n.resourceId),type:"resource"});try{var s=this.getStencil().serialize();s.type&&(s.shape=this,s.data=e,s.result=void 0,s.forceExecution=!0,this._delegateEvent(s),s.result&&(e=s.result))}catch(r){}return e},deserialize:function(e){try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}var n,s=e.find(function(e){return"raziel-target"==e.prefix+"-"+e.name});s&&(n=this.getCanvas().getChildShapeByResourceId(s.value));var r=e.findAll(function(e){return"raziel-outgoing"==e.prefix+"-"+e.name});r.each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t==n?(this.dockers.last().setDockedShape(t),this.dockers.last().setReferencePoint({x:t.bounds.width()/2,y:t.bounds.height()/2})):t instanceof ORYX.Core.Edge&&t.dockers.first().setDockedShape(this))}}.bind(this)),arguments.callee.$.deserialize.apply(this,[e]);var o=e.find(function(e){return"oryx"===e.prefix&&"dockers"===e.name});if(o){var a=o.value.split("#").without("").without(" ");a.each(function(e,t){var i=e.replace(/,/g," ").split(" ").without("");if(0===i.length%2){var n=this._paths[t];if(n){if(0===t)for(;this._dockersByPath[n.id].length>2;)this.removeDocker(this._dockersByPath[n.id][1]);else for(;this._dockersByPath[n.id].length>1;)this.removeDocker(this._dockersByPath[n.id][0]);var s=this._dockersByPath[n.id];if(0===t){var r=parseFloat(i.shift()),o=parseFloat(i.shift());s.first().getDockedShape()?s.first().setReferencePoint({x:r,y:o}):s.first().bounds.centerMoveTo(r,o)}o=parseFloat(i.pop()),r=parseFloat(i.pop()),s.last().getDockedShape()?s.last().setReferencePoint({x:r,y:o}):s.last().bounds.centerMoveTo(r,o);for(var a=0;a<i.length;a++){r=parseFloat(i[a]),o=parseFloat(i[++a]);var h=this.createDocker();h.bounds.centerMoveTo(r,o)}}}}.bind(this))}else this.alignDockers();this._changed()},toString:function(){return this.getStencil().title()+" "+this.id},getTarget:function(){return this.dockers.last()?this.dockers.last().getDockedShape():null},getSource:function(){return this.dockers.first()?this.dockers.first().getDockedShape():null},isDocked:function(){var e=!1;return this.dockers.each(function(t){if(t.isDocked())throw e=!0,$break}),e},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return this.getTarget()&&(e.target={resourceId:this.getTarget().resourceId}),e}},ORYX.Core.Edge=ORYX.Core.Shape.extend(ORYX.Core.Edge),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractPlugin=Clazz.extend({facade:null,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.onLoaded.bind(this))},onLoaded:function(){},onSelectionChanged:function(){},showOverlay:function(e,t,i,n){e instanceof Array||(e=[e]),e=e.map(function(e){var t=e;return"string"==typeof e&&(t=this.facade.getCanvas().getChildShapeByResourceId(e),t=t||this.facade.getCanvas().getChildById(e,!0)),t}.bind(this)).compact(),this.overlayID||(this.overlayID=this.type+ORYX.Editor.provideId()),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:this.overlayID,shapes:e,attributes:t,node:i,nodePosition:n||"NW"})},hideOverlay:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:this.overlayID})},doTransform:function(e,t){if(!t||!e)return"";var i=new DOMParser,n=i.parseFromString(e,"text/xml");source=t,new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(e){xsl=e.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var s=new XSLTProcessor,r=new DOMParser,o=r.parseFromString(xsl,"text/xml");s.importStylesheet(o);try{var a=s.transformToFragment(n,document),h=(new XMLSerializer).serializeToString(a);return h=h.startsWith("<?xml")?h:'<?xml version="1.0" encoding="UTF-8"?>'+h}catch(l){return-1}},openXMLWindow:function(e){window.open("data:application/xml,"+encodeURIComponent(e),"_blank","resizable=yes,width=600,height=600,toolbar=0,scrollbars=yes")},openDownloadWindow:function(e,t){var i=window.open("");if(null!=i){i.document.open(),i.document.write("<html><body>");var n=i.document.createElement("form");i.document.body.appendChild(n);var s=function(e,t){var i=document.createElement("input");return i.name=e,i.type="hidden",i.value=t,i};n.appendChild(s("download",t)),n.appendChild(s("file",e)),n.method="POST",i.document.write("</body></html>"),i.document.close(),n.action=ORYX.PATH+"/download",n.submit()}},getSerializedDOM:function(){var e=DataManager.serializeDOM(this.facade);return e='<?xml version="1.0" encoding="utf-8"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:b3mn="http://b3mn.org/2007/b3mn" xmlns:ext="http://b3mn.org/2007/ext" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:atom="http://b3mn.org/2007/atom+xhtml"><head profile="http://purl.org/NET/erdf/profile"><link rel="schema.dc" href="http://purl.org/dc/elements/1.1/" /><link rel="schema.dcTerms" href="http://purl.org/dc/terms/ " /><link rel="schema.b3mn" href="http://b3mn.org" /><link rel="schema.oryx" href="http://oryx-editor.org/" /><link rel="schema.raziel" href="http://raziel.org/" /><base href="'+location.href.split("?")[0]+'" />'+"</head><body>"+e+"</body></html>"},enableReadOnlyMode:function(){this.facade.disableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange=function(){this.facade.getSelection().length>0&&this.facade.setSelection([])},this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this))},disableReadOnlyMode:function(){this.facade.enableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange&&(this.facade.unregisterOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this)),this._stopSelectionChange=void 0)},getRDFFromDOM:function(){try{var e="";source=ORYX.PATH+"lib/extract-rdf.xsl",new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(t){e=t.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var t=new DOMParser,i=t.parseFromString(this.getSerializedDOM(),"text/xml"),n=t.parseFromString(e,"text/xml"),s=new XSLTProcessor;s.importStylesheet(n);var r=s.transformToFragment(i,document),o=new XMLSerializer;return o.serializeToString(r)}catch(a){return this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_NOTIFICATION_SHOW,ntype:"error",msg:"Error: "+error,title:""}),""}},isStencilSetExtensionLoaded:function(e){return this.facade.getStencilSets().values().any(function(t){return t.extensions().keys().any(function(t){return t==e}.bind(this))}.bind(this))},doLayout:function(e){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LAYOUT,shapes:e})},layoutEdges:function(e,t,i){var n=t.findAll(function(e){return e.dockers.length>2}.bind(this));if(n.length>0){var s=e.absoluteXY(),r={x:s.x-i.x,y:s.y-i.y};s.x+=e.bounds.width()/2,s.y+=e.bounds.height()/2,oldCenter=Object.clone(s),oldCenter.x-=i?i.x:0,oldCenter.y-=i?i.y:0,{x:s.x-e.bounds.width()/2,y:s.y-e.bounds.height()/2},{x:s.x+e.bounds.width()/2,y:s.y+e.bounds.height()/2};var o=function(e,t){var n=e.center().x-t.center().x,s=e.center().y-t.center().y;Math.abs(n)<3?e.moveBy({x:(i.xs?i.xs*(e.center().x-r.x)+i.x+r.x-e.center().x:i.x)-n,y:0}):Math.abs(s)<3&&e.moveBy({x:0,y:(i.ys?i.ys*(e.center().y-r.y)+i.y+r.y-e.center().y:i.y)-s})},a=function(e){var t=e.dockers.first().getDockedShape(),i=e.dockers.last().getDockedShape();return t&&(t=t.absoluteBounds(),t.widen(5)),i&&(i=i.absoluteBounds(),i.widen(20)),e.dockers.any(function(n,s){var r=n.bounds.center();return 0!=s&&s!=e.dockers.length-1&&(t&&t.isIncluded(r)||i&&i.isIncluded(r))})};n.each(function(t){if(t.dockers.first().getDockedShape()===e){var i=t.dockers[1];o(i.bounds,t.dockers.first().bounds)&&i.update()}else if(t.dockers.last().getDockedShape()===e){var n=t.dockers[t.dockers.length-2];o(n.bounds,t.dockers.last().bounds)&&n.update()}return t._update(!0),t.removeUnusedDockers(),a(t)?(this.doLayout(t),void 0):void 0}.bind(this))}t.each(function(e){if(2==e.dockers.length){var t=e.dockers.first().bounds.center(),i=e.dockers.last().bounds.center();(Math.abs(t.x-i.x)<2||Math.abs(t.y-i.y)<2)&&(e.dockers.first().update(),e.dockers.last().update(),this.doLayout(e))}}.bind(this))}}),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractLayouter=ORYX.Plugins.AbstractPlugin.extend({layouted:[],construct:function(){arguments.callee.$.construct.apply(this,arguments),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LAYOUT,this._initLayout.bind(this))},isIncludedInLayout:function(e){return this.layouted instanceof Array||(this.layouted=[this.layouted].compact()),this.layouted.length<=0?!0:this.layouted.any(function(t){return"string"==typeof t?e.getStencil().id().include(t):e instanceof t})},_initLayout:function(e){var t=[e.shapes].flatten().compact(),i=t.findAll(function(e){return this.isIncludedInLayout(e)}.bind(this));i.length>0&&this.layout(i)},layout:function(){throw new Error("Layouter has to implement the layout function.")},getChildShapesWithout:function(e,t){if("function"==typeof e.getChildShapes){var i=e.getChildShapes(!1);return i.findAll(function(e){return!t.member(e.getStencil().id())})}return[]}}),!ORYX)var ORYX={};ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractDragTracker=ORYX.Plugins.AbstractPlugin.extend({shapes:[null],construct:function(){arguments.callee.$.construct.apply(this,arguments),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DRAG_TRACKER_DRAG,function(e){this.isIncludedInShapes(e.shapes)&&this.drag(e.shapes,e.bounds)}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DRAG_TRACKER_RESIZE,function(e){this.isIncludedInShapes(e.shapes)&&this.resize(e.shapes,e.bounds)}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_RESIZE_END,function(e){this.isIncludedInShapes(e.shapes)&&this.resizeEnd(e.shapes)}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DROP_SHAPE,function(e){this.isIncludedInShapes(e.shape)&&this.newShape(e.shape)}.bind(this))},drag:function(){},resize:function(){},resizeEnd:function(){},newShape:function(){},isIncludedInShapes:function(e){return e instanceof Array?(included=!1,e.each(function(e){return this.isIncludedInShapes(e)?(included=!0,void 0):void 0}.bind(this)),included):(this.shapes instanceof Array||(this.shapes=[this.shapes].compact()),this.shapes.length<=0?!0:this.shapes.any(function(t){return"string"==typeof t?e.getStencil().id().include(t):e instanceof t}))}}),function(){function e(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}e.prototype.diff_main=function(e,t,i,n){if("undefined"==typeof n&&(n=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[[0,e]]:[];"undefined"==typeof i&&(i=!0);var s=i,r=this.diff_commonPrefix(e,t),i=e.substring(0,r),e=e.substring(r),t=t.substring(r),r=this.diff_commonSuffix(e,t),o=e.substring(e.length-r),e=e.substring(0,e.length-r),t=t.substring(0,t.length-r),e=this.diff_compute_(e,t,s,n);return i&&e.unshift([0,i]),o&&e.push([0,o]),this.diff_cleanupMerge(e),e},e.prototype.diff_compute_=function(e,t,i,n){if(!e)return[[1,t]];if(!t)return[[-1,e]];var s=e.length>t.length?e:t,r=e.length>t.length?t:e,o=s.indexOf(r);return-1!=o?(i=[[1,s.substring(0,o)],[0,r],[1,s.substring(o+r.length)]],e.length>t.length&&(i[0][0]=i[2][0]=-1),i):1==r.length?[[-1,e],[1,t]]:(s=this.diff_halfMatch_(e,t))?(r=s[0],e=s[1],o=s[2],t=s[3],s=s[4],r=this.diff_main(r,o,i,n),i=this.diff_main(e,t,i,n),r.concat([[0,s]],i)):i&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,n):this.diff_bisect_(e,t,n)},e.prototype.diff_lineMode_=function(e,t,i){var n=this.diff_linesToChars_(e,t),e=n.chars1,t=n.chars2,n=n.lineArray,e=this.diff_main(e,t,!1,i);this.diff_charsToLines_(e,n),this.diff_cleanupSemantic(e),e.push([0,""]);for(var s=n=t=0,r="",o="";t<e.length;){switch(e[t][0]){case 1:s++,o+=e[t][1];break;case-1:n++,r+=e[t][1];break;case 0:if(n>=1&&s>=1){for(e.splice(t-n-s,n+s),t=t-n-s,n=this.diff_main(r,o,!1,i),s=n.length-1;s>=0;s--)e.splice(t,0,n[s]);t+=n.length}n=s=0,o=r=""}t++}return e.pop(),e},e.prototype.diff_bisect_=function(e,t,i){for(var n=e.length,s=t.length,r=Math.ceil((n+s)/2),o=r,a=2*r,h=Array(a),l=Array(a),c=0;a>c;c++)h[c]=-1,l[c]=-1;h[o+1]=0,l[o+1]=0;for(var c=n-s,d=0!=c%2,u=0,g=0,f=0,p=0,O=0;r>O&&!((new Date).getTime()>i);O++){for(var m=-O+u;O-g>=m;m+=2){var _,R=o+m;_=m==-O||m!=O&&h[R-1]<h[R+1]?h[R+1]:h[R-1]+1;for(var E=_-m;n>_&&s>E&&e.charAt(_)==t.charAt(E);)_++,E++;if(h[R]=_,_>n)g+=2;else if(E>s)u+=2;else if(d&&(R=o+c-m,R>=0&&a>R&&-1!=l[R])){var S=n-l[R];if(_>=S)return this.diff_bisectSplit_(e,t,_,E,i)}}for(m=-O+f;O-p>=m;m+=2){for(R=o+m,S=m==-O||m!=O&&l[R-1]<l[R+1]?l[R+1]:l[R-1]+1,_=S-m;n>S&&s>_&&e.charAt(n-S-1)==t.charAt(s-_-1);)S++,_++;if(l[R]=S,S>n)p+=2;else if(_>s)f+=2;else if(!d&&(R=o+c-m,R>=0&&a>R&&-1!=h[R]&&(_=h[R],E=o+_-R,S=n-S,_>=S)))return this.diff_bisectSplit_(e,t,_,E,i)}}return[[-1,e],[1,t]]},e.prototype.diff_bisectSplit_=function(e,t,i,n,s){var r=e.substring(0,i),o=t.substring(0,n),e=e.substring(i),t=t.substring(n),r=this.diff_main(r,o,!1,s),s=this.diff_main(e,t,!1,s);return r.concat(s)},e.prototype.diff_linesToChars_=function(e,t){function i(e){for(var t="",i=0,r=-1,o=n.length;r<e.length-1;){r=e.indexOf("\n",i),-1==r&&(r=e.length-1);var a=e.substring(i,r+1),i=r+1;(s.hasOwnProperty?s.hasOwnProperty(a):void 0!==s[a])?t+=String.fromCharCode(s[a]):(t+=String.fromCharCode(o),s[a]=o,n[o++]=a)}return t}var n=[],s={};n[0]="";var r=i(e),o=i(t);return{chars1:r,chars2:o,lineArray:n}},e.prototype.diff_charsToLines_=function(e,t){for(var i=0;i<e.length;i++){for(var n=e[i][1],s=[],r=0;r<n.length;r++)s[r]=t[n.charCodeAt(r)];e[i][1]=s.join("")}},e.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var i=0,n=Math.min(e.length,t.length),s=n,r=0;s>i;)e.substring(r,s)==t.substring(r,s)?r=i=s:n=s,s=Math.floor((n-i)/2+i);return s},e.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var i=0,n=Math.min(e.length,t.length),s=n,r=0;s>i;)e.substring(e.length-s,e.length-r)==t.substring(t.length-s,t.length-r)?r=i=s:n=s,s=Math.floor((n-i)/2+i);return s},e.prototype.diff_commonOverlap_=function(e,t){var i=e.length,n=t.length;if(0==i||0==n)return 0;if(i>n?e=e.substring(i-n):n>i&&(t=t.substring(0,i)),i=Math.min(i,n),e==t)return i;for(var n=0,s=1;;){var r=e.substring(i-s),r=t.indexOf(r);if(-1==r)return n;s+=r,(0==r||e.substring(i-s)==t.substring(0,s))&&(n=s,s++)}},e.prototype.diff_halfMatch_=function(e,t){function i(e,t,i){for(var n,s,r,a,h=e.substring(i,i+Math.floor(e.length/4)),l=-1,c="";-1!=(l=t.indexOf(h,l+1));){var d=o.diff_commonPrefix(e.substring(i),t.substring(l)),u=o.diff_commonSuffix(e.substring(0,i),t.substring(0,l));c.length<u+d&&(c=t.substring(l-u,l)+t.substring(l,l+d),n=e.substring(0,i-u),s=e.substring(i+d),r=t.substring(0,l-u),a=t.substring(l+d))}return 2*c.length>=e.length?[n,s,r,a,c]:null}if(0>=this.Diff_Timeout)return null;var n=e.length>t.length?e:t,s=e.length>t.length?t:e;if(4>n.length||2*s.length<n.length)return null;var r,o=this,a=i(n,s,Math.ceil(n.length/4)),n=i(n,s,Math.ceil(n.length/2));if(!a&&!n)return null;r=n?a?a[4].length>n[4].length?a:n:n:a;var h;return e.length>t.length?(a=r[0],n=r[1],s=r[2],h=r[3]):(s=r[0],h=r[1],a=r[2],n=r[3]),r=r[4],[a,n,s,h,r]},e.prototype.diff_cleanupSemantic=function(e){for(var t=!1,i=[],n=0,s=null,r=0,o=0,a=0,h=0,l=0;r<e.length;)0==e[r][0]?(i[n++]=r,o=h,a=l,l=h=0,s=e[r][1]):(1==e[r][0]?h+=e[r][1].length:l+=e[r][1].length,s&&s.length<=Math.max(o,a)&&s.length<=Math.max(h,l)&&(e.splice(i[n-1],0,[-1,s]),e[i[n-1]+1][0]=1,n--,n--,r=n>0?i[n-1]:-1,l=h=a=o=0,s=null,t=!0)),r++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),r=1;r<e.length;)-1==e[r-1][0]&&1==e[r][0]&&(t=e[r-1][1],i=e[r][1],n=this.diff_commonOverlap_(t,i),s=this.diff_commonOverlap_(i,t),n>=s?(n>=t.length/2||n>=i.length/2)&&(e.splice(r,0,[0,i.substring(0,n)]),e[r-1][1]=t.substring(0,t.length-n),e[r+1][1]=i.substring(n),r++):(s>=t.length/2||s>=i.length/2)&&(e.splice(r,0,[0,t.substring(0,s)]),e[r-1][0]=1,e[r-1][1]=i.substring(0,i.length-s),e[r+1][0]=-1,e[r+1][1]=t.substring(s),r++),r++),r++},e.prototype.diff_cleanupSemanticLossless=function(t){function i(t,i){if(!t||!i)return 6;var n=t.charAt(t.length-1),s=i.charAt(0),r=n.match(e.nonAlphaNumericRegex_),o=s.match(e.nonAlphaNumericRegex_),a=r&&n.match(e.whitespaceRegex_),h=o&&s.match(e.whitespaceRegex_),n=a&&n.match(e.linebreakRegex_),s=h&&s.match(e.linebreakRegex_),l=n&&t.match(e.blanklineEndRegex_),c=s&&i.match(e.blanklineStartRegex_);return l||c?5:n||s?4:r&&!a&&h?3:a||h?2:r||o?1:0}for(var n=1;n<t.length-1;){if(0==t[n-1][0]&&0==t[n+1][0]){var s=t[n-1][1],r=t[n][1],o=t[n+1][1],a=this.diff_commonSuffix(s,r);if(a)var h=r.substring(r.length-a),s=s.substring(0,s.length-a),r=h+r.substring(0,r.length-a),o=h+o;for(var a=s,h=r,l=o,c=i(s,r)+i(r,o);r.charAt(0)===o.charAt(0);){var s=s+r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1),d=i(s,r)+i(r,o);d>=c&&(c=d,a=s,h=r,l=o)}t[n-1][1]!=a&&(a?t[n-1][1]=a:(t.splice(n-1,1),n--),t[n][1]=h,l?t[n+1][1]=l:(t.splice(n+1,1),n--))}n++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,i=[],n=0,s=null,r=0,o=!1,a=!1,h=!1,l=!1;r<e.length;)0==e[r][0]?(e[r][1].length<this.Diff_EditCost&&(h||l)?(i[n++]=r,o=h,a=l,s=e[r][1]):(n=0,s=null),h=l=!1):(-1==e[r][0]?l=!0:h=!0,s&&(o&&a&&h&&l||s.length<this.Diff_EditCost/2&&3==o+a+h+l)&&(e.splice(i[n-1],0,[-1,s]),e[i[n-1]+1][0]=1,n--,s=null,o&&a?(h=l=!0,n=0):(n--,r=n>0?i[n-1]:-1,h=l=!1),t=!0)),r++;t&&this.diff_cleanupMerge(e)},e.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,i=0,n=0,s=0,r="",o="";i<e.length;)switch(e[i][0]){case 1:s++,o+=e[i][1],i++;break;case-1:n++,r+=e[i][1],i++;break;case 0:n+s>1?(0!==n&&0!==s&&(t=this.diff_commonPrefix(o,r),0!==t&&(i-n-s>0&&0==e[i-n-s-1][0]?e[i-n-s-1][1]+=o.substring(0,t):(e.splice(0,0,[0,o.substring(0,t)]),i++),o=o.substring(t),r=r.substring(t)),t=this.diff_commonSuffix(o,r),0!==t&&(e[i][1]=o.substring(o.length-t)+e[i][1],o=o.substring(0,o.length-t),r=r.substring(0,r.length-t))),0===n?e.splice(i-s,n+s,[1,o]):0===s?e.splice(i-n,n+s,[-1,r]):e.splice(i-n-s,n+s,[-1,r],[1,o]),i=i-n-s+(n?1:0)+(s?1:0)+1):0!==i&&0==e[i-1][0]?(e[i-1][1]+=e[i][1],e.splice(i,1)):i++,n=s=0,o=r=""
}for(""===e[e.length-1][1]&&e.pop(),n=!1,i=1;i<e.length-1;)0==e[i-1][0]&&0==e[i+1][0]&&(e[i][1].substring(e[i][1].length-e[i-1][1].length)==e[i-1][1]?(e[i][1]=e[i-1][1]+e[i][1].substring(0,e[i][1].length-e[i-1][1].length),e[i+1][1]=e[i-1][1]+e[i+1][1],e.splice(i-1,1),n=!0):e[i][1].substring(0,e[i+1][1].length)==e[i+1][1]&&(e[i-1][1]+=e[i+1][1],e[i][1]=e[i][1].substring(e[i+1][1].length)+e[i+1][1],e.splice(i+1,1),n=!0)),i++;n&&this.diff_cleanupMerge(e)},e.prototype.diff_xIndex=function(e,t){var i,n=0,s=0,r=0,o=0;for(i=0;i<e.length&&(1!==e[i][0]&&(n+=e[i][1].length),-1!==e[i][0]&&(s+=e[i][1].length),!(n>t));i++)r=n,o=s;return e.length!=i&&-1===e[i][0]?o:o+(t-r)},e.prototype.diff_prettyHtml=function(e){for(var t=[],i=/&/g,n=/</g,s=/>/g,r=/\n/g,o=0;o<e.length;o++){var a=e[o][0],h=e[o][1],h=h.replace(i,"&amp;").replace(n,"&lt;").replace(s,"&gt;").replace(r,"&para;<br>");switch(a){case 1:t[o]='<ins style="background:#e6ffe6;">'+h+"</ins>";break;case-1:t[o]='<del style="background:#ffe6e6;">'+h+"</del>";break;case 0:t[o]="<span>"+h+"</span>"}}return t.join("")},e.prototype.diff_text1=function(e){for(var t=[],i=0;i<e.length;i++)1!==e[i][0]&&(t[i]=e[i][1]);return t.join("")},e.prototype.diff_text2=function(e){for(var t=[],i=0;i<e.length;i++)-1!==e[i][0]&&(t[i]=e[i][1]);return t.join("")},e.prototype.diff_levenshtein=function(e){for(var t=0,i=0,n=0,s=0;s<e.length;s++){var r=e[s][0],o=e[s][1];switch(r){case 1:i+=o.length;break;case-1:n+=o.length;break;case 0:t+=Math.max(i,n),n=i=0}}return t+=Math.max(i,n)},e.prototype.diff_toDelta=function(e){for(var t=[],i=0;i<e.length;i++)switch(e[i][0]){case 1:t[i]="+"+encodeURI(e[i][1]);break;case-1:t[i]="-"+e[i][1].length;break;case 0:t[i]="="+e[i][1].length}return t.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(e,t){for(var i=[],n=0,s=0,r=t.split(/\t/g),o=0;o<r.length;o++){var a=r[o].substring(1);switch(r[o].charAt(0)){case"+":try{i[n++]=[1,decodeURI(a)]}catch(h){throw Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||0>l)throw Error("Invalid number in diff_fromDelta: "+a);a=e.substring(s,s+=l),i[n++]="="==r[o].charAt(0)?[0,a]:[-1,a];break;default:if(r[o])throw Error("Invalid diff operation in diff_fromDelta: "+r[o])}}if(s!=e.length)throw Error("Delta length ("+s+") does not equal source text length ("+e.length+").");return i},e.prototype.match_main=function(e,t,i){if(null==e||null==t||null==i)throw Error("Null input. (match_main)");return i=Math.max(0,Math.min(i,e.length)),e==t?0:e.length?e.substring(i,i+t.length)==t?i:this.match_bitap_(e,t,i):-1},e.prototype.match_bitap_=function(e,t,i){function n(e,n){var s=e/t.length,o=Math.abs(i-n);return r.Match_Distance?s+o/r.Match_Distance:o?1:s}if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var s=this.match_alphabet_(t),r=this,o=this.Match_Threshold,a=e.indexOf(t,i);-1!=a&&(o=Math.min(n(0,a),o),a=e.lastIndexOf(t,i+t.length),-1!=a&&(o=Math.min(n(0,a),o)));for(var h,l,c,d=1<<t.length-1,a=-1,u=t.length+e.length,g=0;g<t.length;g++){for(h=0,l=u;l>h;)n(g,i+l)<=o?h=l:u=l,l=Math.floor((u-h)/2+h);u=l,h=Math.max(1,i-l+1);var f=Math.min(i+l,e.length)+t.length;for(l=Array(f+2),l[f+1]=(1<<g)-1;f>=h;f--){var p=s[e.charAt(f-1)];if(l[f]=0===g?(1|l[f+1]<<1)&p:1|((1|l[f+1]<<1)&p|(c[f+1]|c[f])<<1)|c[f+1],l[f]&d&&(p=n(g,f-1),o>=p)){if(o=p,a=f-1,!(a>i))break;h=Math.max(1,2*i-a)}}if(n(g+1,i)>o)break;c=l}return a},e.prototype.match_alphabet_=function(e){for(var t={},i=0;i<e.length;i++)t[e.charAt(i)]=0;for(i=0;i<e.length;i++)t[e.charAt(i)]|=1<<e.length-i-1;return t},e.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var i=t.substring(e.start2,e.start2+e.length1),n=0;t.indexOf(i)!=t.lastIndexOf(i)&&i.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)n+=this.Patch_Margin,i=t.substring(e.start2-n,e.start2+e.length1+n);n+=this.Patch_Margin,(i=t.substring(e.start2-n,e.start2))&&e.diffs.unshift([0,i]),(n=t.substring(e.start2+e.length1,e.start2+e.length1+n))&&e.diffs.push([0,n]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+n.length,e.length2+=i.length+n.length}},e.prototype.patch_make=function(t,i,n){var s;if("string"==typeof t&&"string"==typeof i&&"undefined"==typeof n)s=t,i=this.diff_main(s,i,!0),2<i.length&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(t&&"object"==typeof t&&"undefined"==typeof i&&"undefined"==typeof n)i=t,s=this.diff_text1(i);else if("string"==typeof t&&i&&"object"==typeof i&&"undefined"==typeof n)s=t;else{if("string"!=typeof t||"string"!=typeof i||!n||"object"!=typeof n)throw Error("Unknown call format to patch_make.");s=t,i=n}if(0===i.length)return[];for(var n=[],t=new e.patch_obj,r=0,o=0,a=0,h=s,l=0;l<i.length;l++){var c=i[l][0],d=i[l][1];switch(r||0===c||(t.start1=o,t.start2=a),c){case 1:t.diffs[r++]=i[l],t.length2+=d.length,s=s.substring(0,a)+d+s.substring(a);break;case-1:t.length1+=d.length,t.diffs[r++]=i[l],s=s.substring(0,a)+s.substring(a+d.length);break;case 0:d.length<=2*this.Patch_Margin&&r&&i.length!=l+1?(t.diffs[r++]=i[l],t.length1+=d.length,t.length2+=d.length):d.length>=2*this.Patch_Margin&&r&&(this.patch_addContext_(t,h),n.push(t),t=new e.patch_obj,r=0,h=s,o=a)}1!==c&&(o+=d.length),-1!==c&&(a+=d.length)}return r&&(this.patch_addContext_(t,h),n.push(t)),n},e.prototype.patch_deepCopy=function(t){for(var i=[],n=0;n<t.length;n++){var s=t[n],r=new e.patch_obj;r.diffs=[];for(var o=0;o<s.diffs.length;o++)r.diffs[o]=s.diffs[o].slice();r.start1=s.start1,r.start2=s.start2,r.length1=s.length1,r.length2=s.length2,i[n]=r}return i},e.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];var e=this.patch_deepCopy(e),i=this.patch_addPadding(e),t=i+t+i;this.patch_splitMax(e);for(var n=0,s=[],r=0;r<e.length;r++){var o,a=e[r].start2+n,h=this.diff_text1(e[r].diffs),l=-1;if(h.length>this.Match_MaxBits?(o=this.match_main(t,h.substring(0,this.Match_MaxBits),a),-1!=o&&(l=this.match_main(t,h.substring(h.length-this.Match_MaxBits),a+h.length-this.Match_MaxBits),-1==l||o>=l)&&(o=-1)):o=this.match_main(t,h,a),-1==o)s[r]=!1,n-=e[r].length2-e[r].length1;else if(s[r]=!0,n=o-a,a=-1==l?t.substring(o,o+h.length):t.substring(o,l+this.Match_MaxBits),h==a)t=t.substring(0,o)+this.diff_text2(e[r].diffs)+t.substring(o+h.length);else if(a=this.diff_main(h,a,!1),h.length>this.Match_MaxBits&&this.diff_levenshtein(a)/h.length>this.Patch_DeleteThreshold)s[r]=!1;else{this.diff_cleanupSemanticLossless(a);for(var c,h=0,l=0;l<e[r].diffs.length;l++){var d=e[r].diffs[l];0!==d[0]&&(c=this.diff_xIndex(a,h)),1===d[0]?t=t.substring(0,o+c)+d[1]+t.substring(o+c):-1===d[0]&&(t=t.substring(0,o+c)+t.substring(o+this.diff_xIndex(a,h+d[1].length))),-1!==d[0]&&(h+=d[1].length)}}}return t=t.substring(i.length,t.length-i.length),[t,s]},e.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,i="",n=1;t>=n;n++)i+=String.fromCharCode(n);for(n=0;n<e.length;n++)e[n].start1+=t,e[n].start2+=t;var n=e[0],s=n.diffs;if(0==s.length||0!=s[0][0])s.unshift([0,i]),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t;else if(t>s[0][1].length){var r=t-s[0][1].length;s[0][1]=i.substring(s[0][1].length)+s[0][1],n.start1-=r,n.start2-=r,n.length1+=r,n.length2+=r}return n=e[e.length-1],s=n.diffs,0==s.length||0!=s[s.length-1][0]?(s.push([0,i]),n.length1+=t,n.length2+=t):t>s[s.length-1][1].length&&(r=t-s[s.length-1][1].length,s[s.length-1][1]+=i.substring(0,r),n.length1+=r,n.length2+=r),i},e.prototype.patch_splitMax=function(t){for(var i=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=i)){var s=t[n];t.splice(n--,1);for(var r=s.start1,o=s.start2,a="";0!==s.diffs.length;){var h=new e.patch_obj,l=!0;for(h.start1=r-a.length,h.start2=o-a.length,""!==a&&(h.length1=h.length2=a.length,h.diffs.push([0,a]));0!==s.diffs.length&&h.length1<i-this.Patch_Margin;){var a=s.diffs[0][0],c=s.diffs[0][1];1===a?(h.length2+=c.length,o+=c.length,h.diffs.push(s.diffs.shift()),l=!1):-1===a&&1==h.diffs.length&&0==h.diffs[0][0]&&c.length>2*i?(h.length1+=c.length,r+=c.length,l=!1,h.diffs.push([a,c]),s.diffs.shift()):(c=c.substring(0,i-h.length1-this.Patch_Margin),h.length1+=c.length,r+=c.length,0===a?(h.length2+=c.length,o+=c.length):l=!1,h.diffs.push([a,c]),c==s.diffs[0][1]?s.diffs.shift():s.diffs[0][1]=s.diffs[0][1].substring(c.length))}a=this.diff_text2(h.diffs),a=a.substring(a.length-this.Patch_Margin),c=this.diff_text1(s.diffs).substring(0,this.Patch_Margin),""!==c&&(h.length1+=c.length,h.length2+=c.length,0!==h.diffs.length&&0===h.diffs[h.diffs.length-1][0]?h.diffs[h.diffs.length-1][1]+=c:h.diffs.push([0,c])),l||t.splice(++n,0,h)}}},e.prototype.patch_toText=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=e[i];return t.join("")},e.prototype.patch_fromText=function(t){var i=[];if(!t)return i;for(var t=t.split("\n"),n=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;n<t.length;){var r=t[n].match(s);if(!r)throw Error("Invalid patch string: "+t[n]);var o=new e.patch_obj;for(i.push(o),o.start1=parseInt(r[1],10),""===r[2]?(o.start1--,o.length1=1):"0"==r[2]?o.length1=0:(o.start1--,o.length1=parseInt(r[2],10)),o.start2=parseInt(r[3],10),""===r[4]?(o.start2--,o.length2=1):"0"==r[4]?o.length2=0:(o.start2--,o.length2=parseInt(r[4],10)),n++;n<t.length;){r=t[n].charAt(0);try{var a=decodeURI(t[n].substring(1))}catch(h){throw Error("Illegal escape in patch_fromText: "+a)}if("-"==r)o.diffs.push([-1,a]);else if("+"==r)o.diffs.push([1,a]);else if(" "==r)o.diffs.push([0,a]);else{if("@"==r)break;if(""!==r)throw Error('Invalid patch mode "'+r+'" in: '+a)}n++}}return i},e.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},e.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,e=["@@ -"+e+" +"+t+" @@\n"];var i;for(t=0;t<this.diffs.length;t++){switch(this.diffs[t][0]){case 1:i="+";break;case-1:i="-";break;case 0:i=" "}e[t+1]=i+encodeURI(this.diffs[t][1])+"\n"}return e.join("").replace(/%20/g," ")},this.diff_match_patch=e,this.DIFF_DELETE=-1,this.DIFF_INSERT=1,this.DIFF_EQUAL=0}(),Ext.ns("Extensive.grid"),Extensive.grid.ItemDeleter=Ext.extend(Ext.grid.RowSelectionModel,{width:30,sortable:!1,dataIndex:0,menuDisabled:!0,fixed:!0,id:"deleter",initEvents:function(){Extensive.grid.ItemDeleter.superclass.initEvents.call(this),this.grid.on("cellclick",function(e,t,i){if(i==e.getColumnModel().getIndexById("deleter")){var n=e.getStore().getAt(t);e.getStore().remove(n),e.getView().refresh()}})},renderer:function(){return'<div class="extensive-remove" style="width: 15px; height: 16px;"></div>'}}),ImageViewer=Ext.extend(Ext.Window,{initComponent:function(){var e=Ext.id();ORYX.EDITOR.imagePreviewSVG=this.src,this.bodyCfg={id:"imageviewerid",layout:"anchor",autoCreate:!0,closeAction:"close",title:"Image Viewer",plain:!0,modal:!0,collapsible:!1,resizeable:!0,shadow:!0,html:'<iframe id="imageViewFrame" name="imageViewFrame" frameborder="0" scrolling="auto" width="100%" height="400" src="'+ORYX.PATH+"imageview/imageview.html?"+e+'"></iframe>',width:400,height:400,autoScroll:!0,fixedcenter:!0},ImageViewer.superclass.initComponent.apply(this,arguments)},onRender:function(){ImageViewer.superclass.onRender.apply(this,arguments),this.body.on("load",this.onImageLoad,this,{single:!0})},onImageLoad:function(){},setSrc:function(e){this.body.on("load",this.onImageLoad,this,{single:!0}),this.body.dom.src=e},initEvents:function(){ImageViewer.superclass.initEvents.apply(this,arguments),this.resizer&&(this.resizer.preserveRatio=!0)}}),SVGViewer=Ext.extend(Ext.Window,{initComponent:function(){var e=Ext.id();this.bodyCfg={id:"svgviewerid",layout:"anchor",autoCreate:!0,closeAction:"close",title:"SVG Viewer",plain:!0,modal:!0,collapsible:!1,resizeable:!0,shadow:!0,html:'<iframe id="svgViewFrame" name="svgViewFrame" frameborder="0" scrolling="auto" width="100%" height="400" src="'+ORYX.PATH+"localhistory/svgview.html?"+e+'"></iframe>',width:400,height:400,autoScroll:!0,fixedcenter:!0},SVGViewer.superclass.initComponent.apply(this,arguments)},onRender:function(){SVGViewer.superclass.onRender.apply(this,arguments),this.body.on("load",this.onSVGLoad,this,{single:!0})},onSVGLoad:function(){},setSrc:function(e){this.body.on("load",this.onSVGLoad,this,{single:!0}),this.body.dom.src=e},initEvents:function(){SVGViewer.superclass.initEvents.apply(this,arguments),this.resizer&&(this.resizer.preserveRatio=!0)}}),Ext.ux.PanelCollapsedTitlePlugin=function(){var e="x-panel-header-rotated",t=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),i=function(){var i="east"==this.region||"west"==this.region,n="overflow: visible; padding: 0; border: none; background: none;";if(i&&t){this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:"height: 100%; overflow: hidden;"});var s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");this.collapsedHeader.dom.appendChild(r),r.setAttribute("width","100%"),r.setAttribute("height","100%");var o=document.createElementNS(s,"text");"west"==this.region?(o.setAttribute("x",12),o.setAttribute("y",100),o.setAttribute("transform","rotate(270 12 100)")):(o.setAttribute("x",6),o.setAttribute("y",1),o.setAttribute("transform","rotate(90 6 1)")),o.setAttribute("class","x-panel-header "+e),r.appendChild(o),this.collapsedHeaderText=document.createTextNode(this.title),o.appendChild(this.collapsedHeaderText);var a=Ext.fly(o).getStyle("color");o.setAttribute("style",n+";fill: "+a+";")}else{var h="position: relative;";i?h+="white-space: nowrap; writing-mode: tb-rl; top: 1px; left: 3px;":(h+="top: 2px;",n+="padding-left: 4px; margin-right: 18px;"),this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:n,cls:"x-panel-header "+e,html:'<span style="'+h+'">'+this.title+"</span>"}),this.collapsedHeaderText=this.collapsedHeader.first()}this.collapsedIconCls&&this.setCollapsedIconClass(this.collapsedIconCls)};return this.init=function(e){if(e.collapsible){var t="east"==e.region||"west"==e.region;e.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(e){this.rendered&&this.collapsedHeaderText&&(this.collapsedHeaderText.dom?this.collapsedHeaderText.dom.innerHTML=e:this.collapsedHeaderText.replaceData&&(this.collapsedHeaderText.nodeValue=e))}),e.setCollapsedIconClass=function(e){var i=this.collapsedIconCls;if(this.collapsedIconCls=e,this.rendered&&this.collapsedHeader){var n=this.collapsedHeader,s=n.child("img.x-panel-inline-icon");s?this.collapsedIconCls?Ext.fly(s).replaceClass(i,this.collapsedIconCls):Ext.fly(s).remove():this.collapsedIconCls&&Ext.DomHelper.insertBefore(n.dom.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.collapsedIconCls,style:t?"display: block; margin: 1px 2px;":"margin-top: 2px; margin-right: 4px"})}},e.on("render",function(){this.ownerCt.rendered&&this.ownerCt.layout.hasLayout?i.call(e):this.ownerCt.on("afterlayout",i,e,{single:!0})},e)}},this};
