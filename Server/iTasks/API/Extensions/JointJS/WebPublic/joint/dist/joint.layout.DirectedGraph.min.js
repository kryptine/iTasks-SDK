/*! JointJS v0.6.3 - JavaScript diagramming library  2013-09-13 


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){var b=self;b.dagre=a("./index")},{"./index":2}],2:[function(a,b,c){c.dot=a("./lib/dot"),c.layout=a("./lib/layout/layout"),c.util=a("./lib/util"),c.version=a("./lib/version")},{"./lib/dot":7,"./lib/layout/layout":9,"./lib/util":13,"./lib/version":14}],3:[function(a,b){b.exports=function(a){function b(c,e){c in d||(d[c]=!0,e.push(c),a.neighbors(c).forEach(function(a){b(a,e)}))}var c=[],d={};return a.eachNode(function(a){var d=[];b(a,d),d.length>0&&c.push(d)}),c}},{}],4:[function(a,b){var c=a("../data/PriorityQueue");b.exports=function(a,b){var d={},e={},f=new c;if(0===a.nodes().length)return d;a.eachNode(function(a){f.add(a,Number.POSITIVE_INFINITY),d[a]=[]}),f.decrease(a.nodes()[0],0);for(var g,h=!1;f.size()>0;){if(g=f.removeMin(),g in e)d[g].push(e[g]),d[e[g]].push(g);else{if(h)throw new Error("Input graph is not connected:\n"+a.toString());h=!0}a.neighbors(g).forEach(function(a){var c=f.priority(a);if(void 0!==c){var d=b(g,a);c>d&&(e[a]=g,f.decrease(a,d))}})}return d}},{"../data/PriorityQueue":5}],5:[function(a,b){function c(){this._arr=[],this._keyIndices={}}b.exports=c,c.prototype.size=function(){return this._arr.length},c.prototype.keys=function(){return Object.keys(this._keyIndices)},c.prototype.has=function(a){return a in this._keyIndices},c.prototype.priority=function(a){var b=this._keyIndices[a];return void 0!==b?this._arr[b].pri:void 0},c.prototype.add=function(a,b){if(!(a in this._keyIndices)){var c={key:a,pri:b},d=this._arr.length;return this._keyIndices[a]=d,this._arr.push(c),this._decrease(d),!0}return!1},c.prototype.min=function(){return this.size()>0?this._arr[0].key:void 0},c.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var a=this._arr.pop();return delete this._keyIndices[a.key],this._heapify(0),a.key},c.prototype.decrease=function(a,b){var c=this._keyIndices[a];if(b>this._arr[c].pri)throw new Error("New priority is greater than current priority. Key: "+a+" Old: "+this._arr[c].pri+" New: "+b);this._arr[c].pri=b,this._decrease(c)},c.prototype._heapify=function(a){var b=this._arr,c=2*a,d=c+1,e=a;c<b.length&&(e=b[c].pri<b[e].pri?c:e,d<b.length&&(e=b[d].pri<b[e].pri?d:e),e!==a&&(this._swap(a,e),this._heapify(e)))},c.prototype._decrease=function(a){for(var b,c=this._arr[a].pri;a>0&&(b=a>>1,!(this._arr[b].pri<c));)this._swap(a,b),a=b},c.prototype._swap=function(a,b){var c=this._arr,d=this._keyIndices,e=c[a];c[a]=c[b],c[b]=e,d[c[a].key]=a,d[c[b].key]=b}},{}],6:[function(a,b){function c(a){this._size=0,this._keys={},a&&a.forEach(function(a){this.add(a)},this)}b.exports=c,c.prototype.size=function(){return this._size},c.prototype.keys=function(){return Object.keys(this._keys)},c.prototype.has=function(a){return a in this._keys},c.prototype.add=function(a){return a in this._keys?!1:(this._keys[a]=!0,++this._size,!0)},c.prototype.remove=function(a){return a in this._keys?(delete this._keys[a],--this._size,!0):!1}},{}],7:[function(a,b,c){var d=(a("./util"),a("graphlib").Graph,a("graphlib-dot"));c.toGraph=d.parse,c.toGraphArray=d.parseMany,c.write=d.write,c.toObjects=function(a){var b=c.toGraph(a),d=b.nodes().map(function(a){return b.node(a)}),e=b.edges().map(function(a){var c=b.edge(a);return c.source=b.node(b.source(a)),c.target=b.node(b.target(a)),c});return{nodes:d,edges:e}}},{"./util":13,graphlib:27,"graphlib-dot":16}],8:[function(a,b){function c(a,b){f.createTimer();var c=f.createTimer().wrap("Acyclic Phase",d)(a);b>=2&&console.log("Acyclic Phase: reversed "+c+" edge(s)")}function d(a){function b(f){f in d||(d[f]=c[f]=!0,a.outEdges(f).forEach(function(d){var g,h=a.target(d);h in c?(g=a.edge(d),a.delEdge(d),g.reversed=!0,++e,a.addEdge(d,h,f,g)):b(h)}),delete c[f])}var c={},d={},e=0;return a.eachNode(function(a){b(a)}),e}function e(a){a.eachEdge(function(b,c,d,e){e.reversed&&(delete e.reversed,a.delEdge(b),a.addEdge(b,d,c,e))})}var f=a("../util");b.exports=c,b.exports.undo=e},{"../util":13}],9:[function(a,b){var c=a("../util"),d=a("./rank"),f=a("./acyclic"),g=a("graphlib").Digraph;b.exports=function(){function b(){function a(a,c){var d;if(a in c)d=c[a].dagre.id;else{if(!(a+"Id"in c))throw new Error("Edge must have either a "+a+" or "+a+"Id attribute");d=c[a+"Id"],c[a]=b.node(d)}if(!b.hasNode(d))throw new Error(a+" node for '"+e+"' not in node list");return d}var b=new g,c=0;return m.nodes.forEach(function(a){var d="id"in a?a.id:"_N"+c++;a.dagre={id:d,width:a.width,height:a.height},b.addNode(d,a.dagre)}),m.edges.forEach(function(d){var e=a("source",d),f=a("target",d);if(d.dagre={points:[]},e!==f){var g="id"in d?d.id:"_E"+c++;d.dagre.id=g,d.dagre.minLen=d.minLen||1,d.dagre.width=d.width||0,d.dagre.height=d.height||0,b.addEdge(g,e,f,d.dagre)}}),b}function h(){var a=q.rankSep();try{if(!m.nodes.length)return;var c=b();c.eachEdge(function(a,b,c,d){d.minLen*=2}),q.rankSep(a/2),f(c,m.debugLevel),d(c,m.debugLevel),i(c),o.run(c),p.run(c),j(c),k(c),f.undo(c)}finally{q.rankSep(a)}return q}function i(a){var b=0;a.eachEdge(function(c,d,e,f){var g=a.node(d).rank,h=a.node(e).rank;if(h>g+1){for(var i=d,j=g+1,k=0;h>j;++j,++k){var l="_D"+ ++b,m={width:f.width,height:f.height,edge:{id:c,source:d,target:e,attrs:f},rank:j,dummy:!0};0===k?m.index=0:j+1===h&&(m.index=1),a.addNode(l,m),a.addEdge(null,i,l,{}),i=l}a.addEdge(null,i,e,{}),a.delEdge(c)}})}function j(a){a.eachNode(function(b,c){if(c.dummy&&"index"in c){var d=c.edge;a.hasEdge(d.id)||a.addEdge(d.id,d.source,d.target,d.attrs);var e=a.edge(d.id).points;e[c.index]={x:c.x,y:c.y,ul:c.ul,ur:c.ur,dl:c.dl,dr:c.dr},a.delNode(b)}})}function k(a){a.eachEdge(function(a,b,c,d){d.reversed&&d.points.reverse()})}function l(a){return function(){return arguments.length?(a.apply(null,arguments),q):a()}}var m={nodes:[],edges:[],debugLevel:0},n=c.createTimer(),o=a("./order")(),p=a("./position")(),q={};return q.nodes=c.propertyAccessor(q,m,"nodes"),q.edges=c.propertyAccessor(q,m,"edges"),q.orderIters=l(o.iterations),q.nodeSep=l(p.nodeSep),q.edgeSep=l(p.edgeSep),q.universalSep=l(p.universalSep),q.rankSep=l(p.rankSep),q.rankDir=l(p.rankDir),q.debugAlignment=l(p.debugAlignment),q.debugLevel=c.propertyAccessor(q,m,"debugLevel",function(a){n.enabled(a),o.debugLevel(a),p.debugLevel(a)}),q.run=n.wrap("Total layout",h),q._normalize=i,q}},{"../util":13,"./acyclic":8,"./order":10,"./position":11,"./rank":12,graphlib:27}],10:[function(a,b){function c(a){var b={};return a.forEach(function(a,c){b[a]=c}),b}var d=a("../util");b.exports=function(){function a(a){var c=b(a),d=j(c),e=k(a,c);m.debugLevel>=2&&console.log("Order phase start cross count: "+e);var f,h,i;for(h=0,i=0;4>i&&h<m.iterations;++h,++i)f=g(a,h,c),e>f&&(d=j(c),e=f,i=0),m.debugLevel>=3&&console.log("Order phase iter "+h+" cross count: "+e);return d.forEach(function(b){b.forEach(function(b,c){a.node(b).order=c})}),m.debugLevel>=2&&(console.log("Order iterations: "+h),console.log("Order phase best cross count: "+e)),m.debugLevel>=4&&(console.log("Final layering:"),d.forEach(function(a,b){console.log("Layer: "+b,a)})),d}function b(a){var b=[];return a.eachNode(function(a,c){var d=b[c.rank]||(b[c.rank]=[]);d.push(a)}),b}function e(a){return function(b){var c=[];return a.inEdges(b).forEach(function(b){c.push(a.source(b))}),c}}function f(a){return function(b){var c=[];return a.outEdges(b).forEach(function(b){c.push(a.target(b))}),c}}function g(a,b,d){var g;if(0===b%2)for(g=1;g<d.length;++g)h(d[g],e(a),c(d[g-1]));else for(g=d.length-2;g>=0;--g)h(d[g],f(a),c(d[g+1]));return k(a,d)}function h(a,b,d){var e=c(a),f=i(a,b,d),g=a.filter(function(a){return-1!==f[a]});g.sort(function(a,b){return f[a]-f[b]||e[a]-e[b]});for(var h=a.length-1;h>=0;--h)-1!==f[a[h]]&&(a[h]=g.pop())}function i(a,b,c){var e={};return a.forEach(function(a){var f=b(a),g=-1;f.length>0&&(g=d.sum(f.map(function(a){return c[a]}))/f.length),e[a]=g}),e}function j(a){return a.map(function(a){return a.slice(0)})}function k(a,b){var c,d=0;return b.forEach(function(b){c&&(d+=l(a,c,b)),c=b}),d}function l(a,b,d){var e=c(d),f=[];b.forEach(function(b){var c=[];a.outEdges(b).forEach(function(b){c.push(e[a.target(b)])}),c.sort(function(a,b){return a-b}),f=f.concat(c)});for(var g=1;g<d.length;)g<<=1;var h=2*g-1;g-=1;for(var i=[],j=0;h>j;++j)i[j]=0;var k=0;return f.forEach(function(a){var b=a+g;for(++i[b];b>0;)b%2&&(k+=i[b+1]),b=b-1>>1,++i[b]}),k}var m={iterations:24,debugLevel:0},n=d.createTimer(),o={};return o.iterations=d.propertyAccessor(o,m,"iterations"),o.debugLevel=d.propertyAccessor(o,m,"debugLevel",function(a){n.enabled(a)}),o._initOrder=b,o.run=n.wrap("Order Phase",a),o.crossCount=k,o.bilayerCrossCount=l,o}},{"../util":13}],11:[function(a,b){var c=a("../util");b.exports=function(){function a(a){var b=[];a.eachNode(function(a,c){var d=b[c.rank]||(b[c.rank]=[]);d[c.order]=a});var g=d(a,b),h={};["u","d"].forEach(function(c){"d"===c&&b.reverse(),["l","r"].forEach(function(d){"r"===d&&k(b);var i=c+d,l=e(a,b,g,"u"===c?"predecessors":"successors");h[i]=f(a,b,l.pos,l.root,l.align),s.debugLevel>=3&&r(c+d,a,b,h[i]),"r"===d&&j(h[i]),"r"===d&&k(b)}),"d"===c&&b.reverse()}),i(a,b,h),a.eachNode(function(b){var c=[];for(var d in h)p(d,a,b,h[d][b]),c.push(h[d][b]);c.sort(function(a,b){return a-b}),o(a,b,(c[1]+c[2])/2)});var n=c.min(a.nodes().map(function(b){return o(a,b)-l(a,b)/2}));a.eachNode(function(b){o(a,b,o(a,b)-n)});var t=0;b.forEach(function(b){var d=c.max(b.map(function(b){return m(a,b)}));t+=d/2,b.forEach(function(b){q(a,b,t)}),t+=d/2+s.rankSep})}function b(a,b){return b>a?a.toString().length+":"+a+"-"+b:b.toString().length+":"+b+"-"+a}function d(a,c){var d={},e={};if(c.length<=2)return d;c[1].forEach(function(a,b){e[a]=b});for(var f=1;f<c.length-1;++f)for(var g=c[f],h=c[f+1],i=0,j=0,k=0;k<h.length;++k){var l=h[k];e[l]=k;var m=void 0;if(a.node(l).dummy){var n=a.predecessors(l)[0];a.node(n).dummy&&(m=e[n])}if(void 0===m&&k===h.length-1&&(m=g.length-1),void 0!==m){for(;k>=j;++j)a.predecessors(h[j]).forEach(function(a){var c=e[a];(i>c||c>m)&&(d[b(h[j],a)]=!0)});i=m}}return d}function e(a,c,d,e){var f={},g={},h={};return c.forEach(function(a){a.forEach(function(a,b){g[a]=a,h[a]=a,f[a]=b})}),c.forEach(function(c){var i=-1;c.forEach(function(c){var j,k=a[e](c);k.length>0&&(k.sort(function(a,b){return f[a]-f[b]}),j=(k.length-1)/2,k.slice(Math.floor(j),Math.ceil(j)+1).forEach(function(a){h[c]===c&&!d[b(a,c)]&&i<f[a]&&(h[a]=c,h[c]=g[c]=g[a],i=f[a])}))})}),{pos:f,root:g,align:h}}function f(a,b,d,e,f){function g(a,b,c){j[a][b]=b in j[a]?Math.min(j[a][b],c):c}function h(b){if(!(b in m)){m[b]=0;var c=b;do{if(d[c]>0){var j=e[l[c]];h(j),i[b]===b&&(i[b]=i[j]);var k=n(a,l[c])+n(a,c);i[b]!==i[j]?g(i[j],i[b],m[b]-m[j]-k):m[b]=Math.max(m[b],m[j]+k)}c=f[c]}while(c!==b)}}var i={},j={},k={},l={},m={};return b.forEach(function(a){a.forEach(function(b,c){i[b]=b,j[b]={},c>0&&(l[b]=a[c-1])})}),c.values(e).forEach(function(a){h(a)}),b.forEach(function(a){a.forEach(function(a){if(m[a]=m[e[a]],a===e[a]&&a===i[a]){var b=0;a in j&&Object.keys(j[a]).length>0&&(b=c.min(Object.keys(j[a]).map(function(b){return j[a][b]+(b in k?k[b]:0)}))),k[a]=b}})}),b.forEach(function(a){a.forEach(function(a){m[a]+=k[i[e[a]]]||0})}),m}function g(a,b,d){return c.min(b.map(function(a){var b=a[0];return d[b]}))}function h(a,b,d){return c.max(b.map(function(a){var b=a[a.length-1];return d[b]}))}function i(a,b,c){var d,e={},f={},i={},j=Number.POSITIVE_INFINITY;for(var k in c){var l=c[k];e[k]=g(a,b,l),f[k]=h(a,b,l);var m=f[k]-e[k];j>m&&(j=m,d=k)}["u","d"].forEach(function(a){["l","r"].forEach(function(b){var c=a+b;i[c]="l"===b?e[d]-e[c]:f[d]-f[c]})});for(var k in c)a.eachNode(function(a){c[k][a]+=i[k]})}function j(a){for(var b in a)a[b]=-a[b]}function k(a){a.forEach(function(a){a.reverse()})}function l(a,b){switch(s.rankDir){case"LR":return a.node(b).height;default:return a.node(b).width}}function m(a,b){switch(s.rankDir){case"LR":return a.node(b).width;default:return a.node(b).height}}function n(a,b){if(null!==s.universalSep)return s.universalSep;var c=l(a,b),d=a.node(b).dummy?s.edgeSep:s.nodeSep;return(c+d)/2}function o(a,b,c){switch(s.rankDir){case"LR":if(arguments.length<3)return a.node(b).y;a.node(b).y=c;break;default:if(arguments.length<3)return a.node(b).x;a.node(b).x=c}}function p(a,b,c,d){switch(s.rankDir){case"LR":if(arguments.length<3)return b.node(c)[a];b.node(c)[a]=d;break;default:if(arguments.length<3)return b.node(c)[a];b.node(c)[a]=d}}function q(a,b,c){switch(s.rankDir){case"LR":if(arguments.length<3)return a.node(b).x;a.node(b).x=c;break;default:if(arguments.length<3)return a.node(b).y;a.node(b).y=c}}function r(a,b,c,d){c.forEach(function(c,e){var f,g;c.forEach(function(c){var h=d[c];if(f){var i=n(b,f)+n(b,c);i>h-g&&console.log("Position phase: sep violation. Align: "+a+". Layer: "+e+". "+"U: "+f+" V: "+c+". Actual sep: "+(h-g)+" Expected sep: "+i)}f=c,g=h})})}var s={nodeSep:50,edgeSep:10,universalSep:null,rankSep:30,rankDir:"TB",debugLevel:0},t=c.createTimer(),u={};return u.nodeSep=c.propertyAccessor(u,s,"nodeSep"),u.edgeSep=c.propertyAccessor(u,s,"edgeSep"),u.universalSep=c.propertyAccessor(u,s,"universalSep"),u.rankSep=c.propertyAccessor(u,s,"rankSep"),u.rankDir=c.propertyAccessor(u,s,"rankDir"),u.debugLevel=c.propertyAccessor(u,s,"debugLevel",function(a){t.enabled(a)}),u.run=t.wrap("Position Phase",a),u}},{"../util":13}],12:[function(a,b){function c(a){var b={},c=new i;for(a.eachNode(function(d){c.add(d,a.inEdges(d).length),b[d]=0});c.size()>0;){var d=c.min();if(c.priority(d)>0)throw new Error("Input graph is not acyclic: "+a.toString());c.removeMin();var e=b[d];a.node(d).rank=e,a.outEdges(d).forEach(function(d){var f=a.target(d);b[f]=Math.max(b[f],e+(a.edge(d).minLen||1)),c.decrease(f,c.priority(f)-1)})}}function d(a){function b(b){return Math.abs(a.node(b.u).rank-a.node(b.v).rank)-b.len}function c(){var a,c=Number.POSITIVE_INFINITY;return e.forEach(function(e){if(d.has(e.u)!==d.has(e.v)){var f=b(e);c>f&&(a=d.has(e.u)?{treeNode:e.v,graphNode:e.u,len:-e.len}:{treeNode:e.u,graphNode:e.v,len:e.len},c=f)}}),a}var d=new j(a.nodes()),e=[],g={};a.eachEdge(function(a,b,c,d){var h=f(b,c);h in g||e.push(g[h]={u:b,v:c,len:1}),g[h].len=Math.max(g[h].len,d.minLen||1)}),d.remove(a.nodes()[0]);for(;d.size()>0;){var h=c();d.remove(h.graphNode),a.node(h.graphNode).rank=a.node(h.treeNode).rank+h.len}}function e(a){var b=g.min(a.nodes().map(function(b){return a.node(b).rank}));a.eachNode(function(a,c){c.rank-=b})}function f(a,b){return b>a?a.length+":"+a+"-"+b:b.length+":"+b+"-"+a}var g=a("../util"),h=a("../algo/components"),i=(a("../algo/prim"),a("../data/PriorityQueue")),j=a("../data/Set");b.exports=function(a,b){var f=g.createTimer(b>=1);f.wrap("Rank phase",function(){c(a),h(a).forEach(function(b){var c=a.subgraph(b);d(c),e(c)})})()}},{"../algo/components":3,"../algo/prim":4,"../data/PriorityQueue":5,"../data/Set":6,"../util":13}],13:[function(a,b,c){c.mergeAttributes=function(a,b){Object.keys(a).forEach(function(c){b[c]=a[c]})},c.min=function(a){return Math.min.apply(null,a)},c.max=function(a){return Math.max.apply(null,a)},c.all=function(a,b){for(var c=0;c<a.length;++c)if(!b(a[c]))return!1;return!0},c.sum=function(a){return a.reduce(function(a,b){return a+b},0)},c.concat=function(a){return Array.prototype.concat.apply([],a)},c.values=function(a){return Object.keys(a).map(function(b){return a[b]})},c.union=function(a){for(var b={},c=0;c<a.length;++c)for(var d=a[c],e=0;e<d.length;++e){var f=d[e];b[f]=f}var g=[];for(var h in b)g.push(b[h]);return g},c.intersectRect=function(a,b){var c,d,e=a.x,f=a.y,g=b.x-e,h=b.y-f,i=a.width/2,j=a.height/2;return Math.abs(h)*i>Math.abs(g)*j?(0>h&&(j=-j),c=0===h?0:j*g/h,d=j):(0>g&&(i=-i),c=i,d=0===g?0:i*h/g),{x:e+c,y:f+d}},c.pointStr=function(a){return a.x+","+a.y},c.createTimer=function(a){var b={};return a=a||!1,b.enabled=function(c){return arguments.length?(a=c,b):a},b.wrap=function(b,c){return function(){var d=a?(new Date).getTime():null;try{return c.apply(null,arguments)}finally{d&&console.log(b+" time: "+((new Date).getTime()-d)+"ms")}}},b},c.propertyAccessor=function(a,b,c,d){return function(e){return arguments.length?(b[c]=e,d&&d(e),a):b[c]}}},{}],14:[function(a,b){b.exports="0.2.0"},{}],15:[function(a,b){b.exports=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var b={parse:function(b,c){function d(a){O>M||(M>O&&(O=M,P=[]),P.push(a))}function e(){var a,b;if(b=f(),null!==b)for(a=[];null!==b;)a.push(b),b=f();else a=null;return a}function f(){var a,c,e,f,h,i,j,k,l,m,n,o,p,q,r,s;for(q=M,r=M,a=[],c=G();null!==c;)a.push(c),c=G();if(null!==a)if(s=M,c=C(),null!==c?(e=G(),null!==e?c=[c,e]:(c=null,M=s)):(c=null,M=s),c=null!==c?c:"",null!==c)if(e=D(),null!==e){for(f=[],h=G();null!==h;)f.push(h),h=G();if(null!==f)if(h=w(),h=null!==h?h:"",null!==h){for(i=[],j=G();null!==j;)i.push(j),j=G();if(null!==i)if(123===b.charCodeAt(M)?(j="{",M++):(j=null,0===N&&d('"{"')),null!==j){for(k=[],l=G();null!==l;)k.push(l),l=G();if(null!==k)if(l=g(),l=null!==l?l:"",null!==l){for(m=[],n=G();null!==n;)m.push(n),n=G();if(null!==m)if(125===b.charCodeAt(M)?(n="}",M++):(n=null,0===N&&d('"}"')),null!==n){for(o=[],p=G();null!==p;)o.push(p),p=G();null!==o?a=[a,c,e,f,h,i,j,k,l,m,n,o]:(a=null,M=r)}else a=null,M=r;else a=null,M=r}else a=null,M=r;else a=null,M=r}else a=null,M=r;else a=null,M=r}else a=null,M=r;else a=null,M=r}else a=null,M=r;else a=null,M=r;else a=null,M=r;return null!==a&&(a=function(a,b,c,d){return{type:b,id:c,stmts:d}}(q,a[2],a[4],a[8])),null===a&&(M=q),a}function g(){var a,c,e,f,g,i,j,k,l,m,n;if(l=M,m=M,a=h(),null!==a){for(c=[],e=G();null!==e;)c.push(e),e=G();if(null!==c)if(59===b.charCodeAt(M)?(e=";",M++):(e=null,0===N&&d('";"')),e=null!==e?e:"",null!==e){for(f=[],n=M,g=[],i=G();null!==i;)g.push(i),i=G();if(null!==g)if(i=h(),null!==i){for(j=[],k=G();null!==k;)j.push(k),k=G();null!==j?(59===b.charCodeAt(M)?(k=";",M++):(k=null,0===N&&d('";"')),k=null!==k?k:"",null!==k?g=[g,i,j,k]:(g=null,M=n)):(g=null,M=n)}else g=null,M=n;else g=null,M=n;for(;null!==g;){for(f.push(g),n=M,g=[],i=G();null!==i;)g.push(i),i=G();if(null!==g)if(i=h(),null!==i){for(j=[],k=G();null!==k;)j.push(k),k=G();null!==j?(59===b.charCodeAt(M)?(k=";",M++):(k=null,0===N&&d('";"')),k=null!==k?k:"",null!==k?g=[g,i,j,k]:(g=null,M=n)):(g=null,M=n)}else g=null,M=n;else g=null,M=n}null!==f?a=[a,c,e,f]:(a=null,M=m)}else a=null,M=m;else a=null,M=m}else a=null,M=m;return null!==a&&(a=function(a,b,c){for(var d=[b],e=0;e<c.length;++e)d.push(c[e][1]);return d}(l,a[0],a[3])),null===a&&(M=l),a}function h(){var a;return a=i(),null===a&&(a=l(),null===a&&(a=m(),null===a&&(a=j(),null===a&&(a=k())))),a}function i(){var a,b,c,d,e;if(d=M,e=M,a=z(),null===a&&(a=x(),null===a&&(a=y())),null!==a){for(b=[],c=G();null!==c;)b.push(c),c=G();null!==b?(c=n(),null!==c?a=[a,b,c]:(a=null,M=e)):(a=null,M=e)}else a=null,M=e;return null!==a&&(a=function(a,b,c){return{type:"attr",attrType:b,attrs:c||{}}}(d,a[0],a[2])),null===a&&(M=d),a}function j(){var a,c,e,f,g,h,i;if(h=M,i=M,a=w(),null!==a){for(c=[],e=G();null!==e;)c.push(e),e=G();if(null!==c)if(61===b.charCodeAt(M)?(e="=",M++):(e=null,0===N&&d('"="')),null!==e){for(f=[],g=G();null!==g;)f.push(g),g=G();null!==f?(g=w(),null!==g?a=[a,c,e,f,g]:(a=null,M=i)):(a=null,M=i)}else a=null,M=i;else a=null,M=i}else a=null,M=i;return null!==a&&(a=function(a,b,c){var d={};return d[b]=c,{type:"inlineAttr",attrs:d}}(h,a[0],a[4])),null===a&&(M=h),a}function k(){var a,b,c,d,e;if(d=M,e=M,a=t(),null!==a){for(b=[],c=G();null!==c;)b.push(c),c=G();null!==b?(c=n(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,M=e)):(a=null,M=e)}else a=null,M=e;return null!==a&&(a=function(a,b,c){return{type:"node",id:b,attrs:c||{}}}(d,a[0],a[2])),null===a&&(M=d),a}function l(){var a,b,c,d,e,f,g;if(f=M,g=M,a=s(),null!==a){for(b=[],c=G();null!==c;)b.push(c),c=G();if(null!==b)if(c=q(),null!==c){for(d=[],e=G();null!==e;)d.push(e),e=G();null!==d?(e=n(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,M=g)):(a=null,M=g)}else a=null,M=g;else a=null,M=g}else a=null,M=g;return null!==a&&(a=function(a,b,c,d){for(var e=[b],f=0;f<c.length;++f)e.push(c[f]);return{type:"edge",elems:e,attrs:d||{}}}(f,a[0],a[2],a[4])),null===a&&(M=f),a}function m(){var a,c,e,f,h,i,j,k,l,m;if(j=M,k=M,l=M,a=B(),null!==a){for(c=[],e=G();null!==e;)c.push(e),e=G();if(null!==c){if(m=M,e=w(),null!==e){for(f=[],h=G();null!==h;)f.push(h),h=G();null!==f?e=[e,f]:(e=null,M=m)}else e=null,M=m;e=null!==e?e:"",null!==e?a=[a,c,e]:(a=null,M=l)}else a=null,M=l}else a=null,M=l;if(a=null!==a?a:"",null!==a)if(123===b.charCodeAt(M)?(c="{",M++):(c=null,0===N&&d('"{"')),null!==c){for(e=[],f=G();null!==f;)e.push(f),f=G();if(null!==e)if(f=g(),f=null!==f?f:"",null!==f){for(h=[],i=G();null!==i;)h.push(i),i=G();null!==h?(125===b.charCodeAt(M)?(i="}",M++):(i=null,0===N&&d('"}"')),null!==i?a=[a,c,e,f,h,i]:(a=null,M=k)):(a=null,M=k)}else a=null,M=k;else a=null,M=k}else a=null,M=k;else a=null,M=k;return null!==a&&(a=function(a,b,c){return b=b[2]||[],{type:"subgraph",id:b[0],stmts:c}}(j,a[0],a[3])),null===a&&(M=j),a}function n(){var a,b,c,d,e,f,g;if(e=M,f=M,a=o(),null!==a){for(b=[],g=M,c=[],d=G();null!==d;)c.push(d),d=G();for(null!==c?(d=o(),null!==d?c=[c,d]:(c=null,M=g)):(c=null,M=g);null!==c;){for(b.push(c),g=M,c=[],d=G();null!==d;)c.push(d),d=G();null!==c?(d=o(),null!==d?c=[c,d]:(c=null,M=g)):(c=null,M=g)}null!==b?a=[a,b]:(a=null,M=f)}else a=null,M=f;return null!==a&&(a=function(a,b,c){for(var d=b,e=0;e<c.length;++e)d=J(d,c[e][1]);return d}(e,a[0],a[1])),null===a&&(M=e),a}function o(){var a,c,e,f,g,h,i;if(h=M,i=M,91===b.charCodeAt(M)?(a="[",M++):(a=null,0===N&&d('"["')),null!==a){for(c=[],e=G();null!==e;)c.push(e),e=G();if(null!==c)if(e=p(),e=null!==e?e:"",null!==e){for(f=[],g=G();null!==g;)f.push(g),g=G();null!==f?(93===b.charCodeAt(M)?(g="]",M++):(g=null,0===N&&d('"]"')),null!==g?a=[a,c,e,f,g]:(a=null,M=i)):(a=null,M=i)}else a=null,M=i;else a=null,M=i}else a=null,M=i;return null!==a&&(a=function(a,b){return b}(h,a[2])),null===a&&(M=h),a}function p(){var a,c,e,f,g,h,i,j,k;if(i=M,j=M,a=r(),null!==a){for(c=[],k=M,e=[],f=G();null!==f;)e.push(f),f=G();if(null!==e)if(44===b.charCodeAt(M)?(f=",",M++):(f=null,0===N&&d('","')),f=null!==f?f:"",null!==f){for(g=[],h=G();null!==h;)g.push(h),h=G();null!==g?(h=r(),null!==h?e=[e,f,g,h]:(e=null,M=k)):(e=null,M=k)}else e=null,M=k;else e=null,M=k;for(;null!==e;){for(c.push(e),k=M,e=[],f=G();null!==f;)e.push(f),f=G();if(null!==e)if(44===b.charCodeAt(M)?(f=",",M++):(f=null,0===N&&d('","')),f=null!==f?f:"",null!==f){for(g=[],h=G();null!==h;)g.push(h),h=G();null!==g?(h=r(),null!==h?e=[e,f,g,h]:(e=null,M=k)):(e=null,M=k)}else e=null,M=k;else e=null,M=k}null!==c?a=[a,c]:(a=null,M=j)}else a=null,M=j;return null!==a&&(a=function(a,b,c){for(var d=b,e=0;e<c.length;++e)d=J(d,c[e][3]);return d}(i,a[0],a[1])),null===a&&(M=i),a}function q(){var a,c,e,f,g,h,i,j;if(h=M,i=M,j=M,"--"===b.substr(M,2)?(a="--",M+=2):(a=null,0===N&&d('"--"')),null!==a?(c=function(){return L}(M)?null:"",null!==c?a=[a,c]:(a=null,M=j)):(a=null,M=j),null===a&&(j=M,"->"===b.substr(M,2)?(a="->",M+=2):(a=null,0===N&&d('"->"')),null!==a?(c=function(){return L}(M)?"":null,null!==c?a=[a,c]:(a=null,M=j)):(a=null,M=j)),null!==a){for(c=[],e=G();null!==e;)c.push(e),e=G();if(null!==c)if(e=s(),null!==e){for(f=[],g=G();null!==g;)f.push(g),g=G();null!==f?(g=q(),g=null!==g?g:"",null!==g?a=[a,c,e,f,g]:(a=null,M=i)):(a=null,M=i)}else a=null,M=i;else a=null,M=i}else a=null,M=i;return null!==a&&(a=function(a,b,c){for(var d=[b],e=0;e<c.length;++e)d.push(c[e]);return d}(h,a[2],a[4])),null===a&&(M=h),a}function r(){var a,c,e,f,g,h,i,j;if(h=M,i=M,a=w(),null!==a){for(j=M,c=[],e=G();null!==e;)c.push(e),e=G();if(null!==c)if(61===b.charCodeAt(M)?(e="=",M++):(e=null,0===N&&d('"="')),null!==e){for(f=[],g=G();null!==g;)f.push(g),g=G();null!==f?(g=w(),null!==g?c=[c,e,f,g]:(c=null,M=j)):(c=null,M=j)}else c=null,M=j;else c=null,M=j;c=null!==c?c:"",null!==c?a=[a,c]:(a=null,M=i)}else a=null,M=i;return null!==a&&(a=function(a,b,c){var d={};return d[b]=c[3],d}(h,a[0],a[1])),null===a&&(M=h),a}function s(){var a,b;return a=m(),null===a&&(b=M,a=t(),null!==a&&(a=function(a,b){return{type:"node",id:b,attrs:{}}}(b,a)),null===a&&(M=b)),a}function t(){var a,b,c,d,e;if(d=M,e=M,a=w(),null!==a){for(b=[],c=G();null!==c;)b.push(c),c=G();null!==b?(c=u(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,M=e)):(a=null,M=e)}else a=null,M=e;return null!==a&&(a=function(a,b){return b}(d,a[0])),null===a&&(M=d),a}function u(){var a,c,e,f,g,h,i,j,k;if(j=M,58===b.charCodeAt(M)?(a=":",M++):(a=null,0===N&&d('":"')),null!==a){for(c=[],e=G();null!==e;)c.push(e),e=G();if(null!==c)if(e=w(),null!==e){for(f=[],g=G();null!==g;)f.push(g),g=G();if(null!==f){if(k=M,58===b.charCodeAt(M)?(g=":",M++):(g=null,0===N&&d('":"')),null!==g){for(h=[],i=G();null!==i;)h.push(i),i=G();null!==h?(i=v(),null!==i?g=[g,h,i]:(g=null,M=k)):(g=null,M=k)}else g=null,M=k;g=null!==g?g:"",null!==g?a=[a,c,e,f,g]:(a=null,M=j)}else a=null,M=j}else a=null,M=j;else a=null,M=j}else a=null,M=j;return a}function v(){var a;return 110===b.charCodeAt(M)?(a="n",M++):(a=null,0===N&&d('"n"')),null===a&&("ne"===b.substr(M,2)?(a="ne",M+=2):(a=null,0===N&&d('"ne"')),null===a&&(101===b.charCodeAt(M)?(a="e",M++):(a=null,0===N&&d('"e"')),null===a&&("se"===b.substr(M,2)?(a="se",M+=2):(a=null,0===N&&d('"se"')),null===a&&(115===b.charCodeAt(M)?(a="s",M++):(a=null,0===N&&d('"s"')),null===a&&("sw"===b.substr(M,2)?(a="sw",M+=2):(a=null,0===N&&d('"sw"')),null===a&&(119===b.charCodeAt(M)?(a="w",M++):(a=null,0===N&&d('"w"')),null===a&&("nw"===b.substr(M,2)?(a="nw",M+=2):(a=null,0===N&&d('"nw"')),null===a&&(99===b.charCodeAt(M)?(a="c",M++):(a=null,0===N&&d('"c"')),null===a&&(95===b.charCodeAt(M)?(a="_",M++):(a=null,0===N&&d('"_"'))))))))))),a}function w(){var a,c,e,f,g,h,i,j,k;if(N++,h=M,i=M,/^[a-zA-Z\u0200-\u0377_]/.test(b.charAt(M))?(a=b.charAt(M),M++):(a=null,0===N&&d("[a-zA-Z\\u0200-\\u0377_]")),null!==a){for(c=[],/^[a-zA-Z\u0200-\u0377_0-9]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d("[a-zA-Z\\u0200-\\u0377_0-9]"));null!==e;)c.push(e),/^[a-zA-Z\u0200-\u0377_0-9]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d("[a-zA-Z\\u0200-\\u0377_0-9]"));null!==c?a=[a,c]:(a=null,M=i)}else a=null,M=i;if(null!==a&&(a=function(a,b,c){return b+c.join("")}(h,a[0],a[1])),null===a&&(M=h),null===a){if(h=M,i=M,45===b.charCodeAt(M)?(a="-",M++):(a=null,0===N&&d('"-"')),a=null!==a?a:"",null!==a)if(46===b.charCodeAt(M)?(c=".",M++):(c=null,0===N&&d('"."')),null!==c){if(/^[0-9]/.test(b.charAt(M))?(f=b.charAt(M),M++):(f=null,0===N&&d("[0-9]")),null!==f)for(e=[];null!==f;)e.push(f),/^[0-9]/.test(b.charAt(M))?(f=b.charAt(M),M++):(f=null,0===N&&d("[0-9]"));else e=null;null!==e?a=[a,c,e]:(a=null,M=i)}else a=null,M=i;else a=null,M=i;if(null!==a&&(a=function(a,b,c,d){return b+c+d.join("")}(h,a[0],a[1],a[2])),null===a&&(M=h),null===a){if(h=M,i=M,45===b.charCodeAt(M)?(a="-",M++):(a=null,0===N&&d('"-"')),a=null!==a?a:"",null!==a){if(/^[0-9]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d("[0-9]")),null!==e)for(c=[];null!==e;)c.push(e),/^[0-9]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d("[0-9]"));else c=null;if(null!==c){if(j=M,46===b.charCodeAt(M)?(e=".",M++):(e=null,0===N&&d('"."')),null!==e){for(f=[],/^[0-9]/.test(b.charAt(M))?(g=b.charAt(M),M++):(g=null,0===N&&d("[0-9]"));null!==g;)f.push(g),/^[0-9]/.test(b.charAt(M))?(g=b.charAt(M),M++):(g=null,0===N&&d("[0-9]"));null!==f?e=[e,f]:(e=null,M=j)}else e=null,M=j;e=null!==e?e:"",null!==e?a=[a,c,e]:(a=null,M=i)}else a=null,M=i}else a=null,M=i;if(null!==a&&(a=function(a,b,c,d){return b+c.join("")+(d[0]||"")+(d[1]||[]).join("")}(h,a[0],a[1],a[2])),null===a&&(M=h),null===a){if(h=M,i=M,34===b.charCodeAt(M)?(a='"',M++):(a=null,0===N&&d('"\\""')),null!==a){for(c=[],j=M,'\\"'===b.substr(M,2)?(e='\\"',M+=2):(e=null,0===N&&d('"\\\\\\""')),null!==e&&(e=function(){return'"'}(j)),null===e&&(M=j),null===e&&(j=M,k=M,92===b.charCodeAt(M)?(e="\\",M++):(e=null,0===N&&d('"\\\\"')),null!==e?(/^[^"]/.test(b.charAt(M))?(f=b.charAt(M),M++):(f=null,0===N&&d('[^"]')),null!==f?e=[e,f]:(e=null,M=k)):(e=null,M=k),null!==e&&(e=function(a,b){return"\\"+b}(j,e[1])),null===e&&(M=j),null===e&&(/^[^"]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d('[^"]'))));null!==e;)c.push(e),j=M,'\\"'===b.substr(M,2)?(e='\\"',M+=2):(e=null,0===N&&d('"\\\\\\""')),null!==e&&(e=function(){return'"'}(j)),null===e&&(M=j),null===e&&(j=M,k=M,92===b.charCodeAt(M)?(e="\\",M++):(e=null,0===N&&d('"\\\\"')),null!==e?(/^[^"]/.test(b.charAt(M))?(f=b.charAt(M),M++):(f=null,0===N&&d('[^"]')),null!==f?e=[e,f]:(e=null,M=k)):(e=null,M=k),null!==e&&(e=function(a,b){return"\\"+b}(j,e[1])),null===e&&(M=j),null===e&&(/^[^"]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d('[^"]'))));null!==c?(34===b.charCodeAt(M)?(e='"',M++):(e=null,0===N&&d('"\\""')),null!==e?a=[a,c,e]:(a=null,M=i)):(a=null,M=i)}else a=null,M=i;null!==a&&(a=function(a,b){return b.join("")}(h,a[1])),null===a&&(M=h)}}}return N--,0===N&&null===a&&d("identifier"),a}function x(){var a,c;return c=M,"node"===b.substr(M,4).toLowerCase()?(a=b.substr(M,4),M+=4):(a=null,0===N&&d('"node"')),null!==a&&(a=function(a,b){return b.toLowerCase()}(c,a)),null===a&&(M=c),a}function y(){var a,c;return c=M,"edge"===b.substr(M,4).toLowerCase()?(a=b.substr(M,4),M+=4):(a=null,0===N&&d('"edge"')),null!==a&&(a=function(a,b){return b.toLowerCase()}(c,a)),null===a&&(M=c),a}function z(){var a,c;return c=M,"graph"===b.substr(M,5).toLowerCase()?(a=b.substr(M,5),M+=5):(a=null,0===N&&d('"graph"')),null!==a&&(a=function(a,b){return b.toLowerCase()}(c,a)),null===a&&(M=c),a}function A(){var a,c;return c=M,"digraph"===b.substr(M,7).toLowerCase()?(a=b.substr(M,7),M+=7):(a=null,0===N&&d('"digraph"')),null!==a&&(a=function(a,b){return b.toLowerCase()}(c,a)),null===a&&(M=c),a}function B(){var a,c;return c=M,"subgraph"===b.substr(M,8).toLowerCase()?(a=b.substr(M,8),M+=8):(a=null,0===N&&d('"subgraph"')),null!==a&&(a=function(a,b){return b.toLowerCase()}(c,a)),null===a&&(M=c),a}function C(){var a,c;return c=M,"strict"===b.substr(M,6).toLowerCase()?(a=b.substr(M,6),M+=6):(a=null,0===N&&d('"strict"')),null!==a&&(a=function(a,b){return b.toLowerCase()}(c,a)),null===a&&(M=c),a}function D(){var a,b;return a=z(),null===a&&(b=M,a=A(),null!==a&&(a=function(a,b){return L="digraph"===b,b}(b,a)),null===a&&(M=b)),a}function E(){var a,c;if(N++,/^[ \t\r\n]/.test(b.charAt(M))?(c=b.charAt(M),M++):(c=null,0===N&&d("[ \\t\\r\\n]")),null!==c)for(a=[];null!==c;)a.push(c),/^[ \t\r\n]/.test(b.charAt(M))?(c=b.charAt(M),M++):(c=null,0===N&&d("[ \\t\\r\\n]"));else a=null;return N--,0===N&&null===a&&d("whitespace"),a}function F(){var a,c,e,f,g,h,i;if(N++,g=M,"//"===b.substr(M,2)?(a="//",M+=2):(a=null,0===N&&d('"//"')),null!==a){for(c=[],/^[^\n]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d("[^\\n]"));null!==e;)c.push(e),/^[^\n]/.test(b.charAt(M))?(e=b.charAt(M),M++):(e=null,0===N&&d("[^\\n]"));null!==c?a=[a,c]:(a=null,M=g)}else a=null,M=g;if(null===a)if(g=M,"/*"===b.substr(M,2)?(a="/*",M+=2):(a=null,0===N&&d('"/*"')),null!==a){for(c=[],h=M,i=M,N++,"*/"===b.substr(M,2)?(e="*/",M+=2):(e=null,0===N&&d('"*/"')),N--,null===e?e="":(e=null,M=i),null!==e?(b.length>M?(f=b.charAt(M),M++):(f=null,0===N&&d("any character")),null!==f?e=[e,f]:(e=null,M=h)):(e=null,M=h);null!==e;)c.push(e),h=M,i=M,N++,"*/"===b.substr(M,2)?(e="*/",M+=2):(e=null,0===N&&d('"*/"')),N--,null===e?e="":(e=null,M=i),null!==e?(b.length>M?(f=b.charAt(M),M++):(f=null,0===N&&d("any character")),null!==f?e=[e,f]:(e=null,M=h)):(e=null,M=h);null!==c?("*/"===b.substr(M,2)?(e="*/",M+=2):(e=null,0===N&&d('"*/"')),null!==e?a=[a,c,e]:(a=null,M=g)):(a=null,M=g)}else a=null,M=g;return N--,0===N&&null===a&&d("comment"),a
}function G(){var a;return a=E(),null===a&&(a=F()),a}function H(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function I(){for(var a=1,c=1,d=!1,e=0;e<Math.max(M,O);e++){var f=b.charAt(e);"\n"===f?(d||a++,c=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,c=1,d=!0):(c++,d=!1)}return{line:a,column:c}}function J(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}var K={start:e,graphStmt:f,stmtList:g,stmt:h,attrStmt:i,inlineAttrStmt:j,nodeStmt:k,edgeStmt:l,subgraphStmt:m,attrList:n,attrListBlock:o,aList:p,edgeRHS:q,idDef:r,nodeIdOrSubgraph:s,nodeId:t,port:u,compassPt:v,id:w,node:x,edge:y,graph:z,digraph:A,subgraph:B,strict:C,graphType:D,whitespace:E,comment:F,_:G};if(void 0!==c){if(void 0===K[c])throw new Error("Invalid rule name: "+a(c)+".")}else c="start";var L,M=0,N=0,O=0,P=[],Q=K[c]();if(null===Q||M!==b.length){var R=Math.max(M,O),S=R<b.length?b.charAt(R):null,T=I();throw new this.SyntaxError(H(P),S,R,T.line,T.column)}return Q},toSource:function(){return this._source}};return b.SyntaxError=function(b,c,d,e,f){function g(b,c){var d,e;switch(b.length){case 0:d="end of input";break;case 1:d=b[0];break;default:d=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}return e=c?a(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=b,this.found=c,this.message=g(b,c),this.offset=d,this.line=e,this.column=f},b.SyntaxError.prototype=Error.prototype,b}()},{}],16:[function(a,b,c){var d=a("./parse"),e=a("./write");c.parse=c.decode=d,c.parseMany=d.parseMany,c.write=c.encode=e,c.type="dot",c.buffer=!1},{"./parse":17,"./write":19}],17:[function(a,b,c){function d(a){return e(a)[0]}function e(a){var b=i.parse(a);return b.map(function(a){return f(a)})}function f(a){function b(a,b){f.hasNode(a)||(f.addNode(a,k.get("node",{id:a})),void 0===f.node(a).label&&(f.node(a).label=a)),b&&g.mergeAttributes(b,f.node(a))}function c(a,b,c){var d=a+"-"+b,e=j[d];e||(e=j[d]=0),j[d]++;var h=c.id||d+"-"+e,i={};g.mergeAttributes(k.get("edge",c),i),g.mergeAttributes({id:h},i),f.addEdge(h,a,b,i)}function d(a){function b(a){e.push(a)}var c,d={},e=[];for(b(a);0!==e.length;)switch(c=e.pop(),c.type){case"node":d[c.id]=!0;break;case"edge":c.elems.forEach(b);break;case"subgraph":c.stmts.forEach(b)}return Object.keys(d)}function e(a){var f=a.attrs;switch(a.type){case"node":b(a.id,f);break;case"edge":var g,h;a.elems.forEach(function(a){switch(e(a),a.type){case"node":h=[a.id];break;case"subgraph":h=d(a);break;default:throw new Error("Unsupported type incident on edge: "+a.type)}g&&g.forEach(function(a){h.forEach(function(b){c(a,b,f),i&&c(b,a,f)})}),g=h});break;case"subgraph":k.enterSubDigraph(),a.stmts&&a.stmts.forEach(function(a){e(a)}),k.exitSubDigraph();break;case"attr":k.set(a.attrType,f);break;default:throw new Error("Unsupported statement type: "+a.type)}}var f=new h,i="graph"===a.type;f.type=a.type;var j={},k={_default:{},get:function(a,b){if("undefined"!=typeof this._default[a]){var c={};return g.mergeAttributes(this._default[a],c),g.mergeAttributes(b,c),c}return b},set:function(a,b){this._default[a]=this.get(a,b)},enterSubDigraph:function(){function a(){}a.prototype=this._default;var b=new a;this._default=b},exitSubDigraph:function(){this._default=Object.getPrototypeOf(this._default)}};return a.stmts&&a.stmts.forEach(function(a){e(a)}),f}var g=a("./util"),h=a("graphlib").Digraph,i=a("./dot-grammar");b.exports=d,b.exports.parseMany=e,c.toObjects=function(a){var b=c.toDigraph(a),d=b.nodes().map(function(a){return b.node(a)}),e=b.edges().map(function(a){var c=b.edge(a);return c.source=b.node(b.source(a)),c.target=b.node(b.target(a)),c});return{nodes:d,edges:e}}},{"./dot-grammar":15,"./util":18,graphlib:20}],18:[function(a,b,c){c.mergeAttributes=function(a,b){Object.keys(a).forEach(function(c){b[c]=a[c]})},c.min=function(a){return Math.min.apply(null,a)},c.max=function(a){return Math.max.apply(null,a)},c.all=function(a,b){for(var c=0;c<a.length;++c)if(!b(a[c]))return!1;return!0},c.sum=function(a){return a.reduce(function(a,b){return a+b},0)},c.concat=function(a){return Array.prototype.concat.apply([],a)},c.values=function(a){return Object.keys(a).map(function(b){return a[b]})},c.union=function(a){for(var b={},c=0;c<a.length;++c)for(var d=a[c],e=0;e<d.length;++e){var f=d[e];b[f]=f}var g=[];for(var h in b)g.push(b[h]);return g},c.intersectRect=function(a,b){var c,d,e=a.x,f=a.y,g=b.x-e,h=b.y-f,i=a.width/2,j=a.height/2;return Math.abs(h)*i>Math.abs(g)*j?(0>h&&(j=-j),c=0===h?0:j*g/h,d=j):(0>g&&(i=-i),c=i,d=0===g?0:i*h/g),{x:e+c,y:f+d}},c.pointStr=function(a){return a.x+","+a.y},c.createTimer=function(a){var b={};return a=a||!1,b.enabled=function(c){return arguments.length?(a=c,b):a},b.wrap=function(b,c){return function(){var d=a?(new Date).getTime():null;try{return c.apply(null,arguments)}finally{d&&console.log(b+" time: "+((new Date).getTime()-d)+"ms")}}},b},c.propertyAccessor=function(a,b,c,d){return function(e){return arguments.length?(b[c]=e,d&&d(e),a):b[c]}}},{}],19:[function(a,b){function c(a){var b="digraph"==a.type?"->":"--",c=(a.type||"digraph")+" {\n";return a.nodes().forEach(function(b){c+=f(b,a.node(b))}),a.eachEdge(function(a,d,e,f){c+=g(a,b,d,e,f)}),c+="}\n"}function d(a){return'"'+a.toString().replace(/"/g,'\\"')+'"'}function e(a){return"[object Object]"===Object.prototype.toString.call(a)||"[object Array]"===Object.prototype.toString.call(a)?d(JSON.stringify(a)):d(a)}function f(a,b){var c=d(a),f="    "+d(a),g=!1;for(var h in b)"label"!=h&&"id"!=h||d(b[h])==c||(g?f+=",":(f+=" [",g=!0),f+=d(h)+"="+e(b[h]));return g&&(f+="]"),f+="\n"}function g(a,b,c,f,g){d(a);var h="    "+d(c)+" "+b+" "+d(f),i=!1;for(var j in g)i?h+=",":(h+=" [",i=!0),h+=d(j)+"="+e(g[j]);return i&&(h+="]"),h+="\n"}b.exports=c},{}],20:[function(a,b,c){c.Digraph=a("./lib/Digraph"),c.alg=a("./lib/alg"),c.version=a("./lib/version"),c.Graph=c.Digraph},{"./lib/Digraph":21,"./lib/alg":22,"./lib/version":26}],21:[function(a,b){function c(){this._nodes={},this._inEdges={},this._outEdges={},this._edges={},this._nextEdgeId=0}function d(a,b,c){var d=a[b];d||(d=a[b]={count:0,edges:{}}),d.count++,d.edges[c]=!0}function e(a,b,c){var d=a[b];0===--d.count?delete a[b]:delete d.edges[c]}var f=a("./util");b.exports=c,c.prototype.subgraph=function(a){var b=new c,d=this;return a.forEach(function(a){b.addNode(a,d.node(a))}),f.values(this._edges).forEach(function(a){b.hasNode(a.source)&&b.hasNode(a.target)&&b.addEdge(a.id,a.source,a.target,d.edge(a.id))}),b},c.prototype.order=function(){return Object.keys(this._nodes).length},c.prototype.size=function(){return Object.keys(this._edges).length},c.prototype.hasNode=function(a){return a in this._nodes},c.prototype.node=function(a){return this._strictGetNode(a).value},c.prototype.nodes=function(){var a=[];return this.eachNode(function(b){a.push(b)}),a},c.prototype.eachNode=function(a){for(var b in this._nodes){var c=this._nodes[b];a(c.id,c.value)}},c.prototype.successors=function(a){return this._strictGetNode(a),Object.keys(this._outEdges[a]).map(function(a){return this._nodes[a].id},this)},c.prototype.predecessors=function(a){return this._strictGetNode(a),Object.keys(this._inEdges[a]).map(function(a){return this._nodes[a].id},this)},c.prototype.neighbors=function(a){this._strictGetNode(a);var b={};return Object.keys(this._outEdges[a]).map(function(a){b[a]=!0}),Object.keys(this._inEdges[a]).map(function(a){b[a]=!0}),Object.keys(b).map(function(a){return this._nodes[a].id},this)},c.prototype.sources=function(){var a=this;return this._filterNodes(function(b){return 0===a.inEdges(b).length})},c.prototype.sinks=function(){var a=this;return this._filterNodes(function(b){return 0===a.outEdges(b).length})},c.prototype.hasEdge=function(a){return a in this._edges},c.prototype.edge=function(a){return this._strictGetEdge(a).value},c.prototype.edges=function(a,b){var c,d;return arguments.length?1===arguments.length?f.mergeKeys([this.inEdges(a),this.outEdges(a)]):2===arguments.length?(this._strictGetNode(a),this._strictGetNode(b),d=this._outEdges[a],c=b in d?Object.keys(d[b].edges):[],c.map(function(a){return this._edges[a].id},this)):void 0:(c=[],this.eachEdge(function(a){c.push(a)}),c)},c.prototype.eachEdge=function(a){for(var b in this._edges){var c=this._edges[b];a(c.id,c.source,c.target,c.value)}},c.prototype.source=function(a){return this._strictGetEdge(a).source},c.prototype.target=function(a){return this._strictGetEdge(a).target},c.prototype.inEdges=function(a){return this._strictGetNode(a),f.concat(f.values(this._inEdges[a]).map(function(a){return Object.keys(a.edges)},this))},c.prototype.outEdges=function(a){return this._strictGetNode(a),f.concat(f.values(this._outEdges[a]).map(function(a){return Object.keys(a.edges)},this))},c.prototype.equals=function(a){var b=this;return b.order()===a.order()&&b.size()===a.size()&&f.all(b.nodes(),function(c){return a.hasNode(c)&&b.node(c)===a.node(c)})&&f.all(b.edges(),function(c){return a.hasEdge(c)&&b.edge(c)===a.edge(c)})},c.prototype.toString=function(){var a=this,b="GRAPH:\n";return b+="    Nodes:\n",Object.keys(this._nodes).forEach(function(c){b+="        "+c+": "+JSON.stringify(a._nodes[c].value)+"\n"}),b+="    Edges:\n",Object.keys(this._edges).forEach(function(c){var d=a._edges[c];b+="        "+c+" ("+d.source+" -> "+d.target+"): "+JSON.stringify(a._edges[c].value)+"\n"}),b},c.prototype.addNode=function(a,b){if(this.hasNode(a))throw new Error("Graph already has node '"+a+"':\n"+this.toString());this._nodes[a]={id:a,value:b},this._inEdges[a]={},this._outEdges[a]={}},c.prototype.delNode=function(a){this._strictGetNode(a);var b=this;this.edges(a).forEach(function(a){b.delEdge(a)}),delete this._inEdges[a],delete this._outEdges[a],delete this._nodes[a]},c.prototype.addEdge=function(a,b,c,e){if(this._strictGetNode(b),this._strictGetNode(c),null===a)a="_ANON-"+ ++this._nextEdgeId;else if(this.hasEdge(a))throw new Error("Graph already has edge '"+a+"':\n"+this.toString());this._edges[a]={id:a,source:b,target:c,value:e},d(this._inEdges[c],b,a),d(this._outEdges[b],c,a)},c.prototype.delEdge=function(a){var b=this._strictGetEdge(a);e(this._inEdges[b.target],b.source,a),e(this._outEdges[b.source],b.target,a),delete this._edges[a]},c.prototype._strictGetNode=function(a){var b=this._nodes[a];if(void 0===b)throw new Error("Node '"+a+"' is not in graph:\n"+this.toString());return b},c.prototype._strictGetEdge=function(a){var b=this._edges[a];if(void 0===b)throw new Error("Edge '"+a+"' is not in graph:\n"+this.toString());return b},c.prototype._filterNodes=function(a){var b=[];return this.eachNode(function(c){a(c)&&b.push(c)}),b}},{"./util":25}],22:[function(a,b){b.exports={isAcyclic:a("./alg/isAcyclic"),topsort:a("./alg/topsort")}},{"./alg/isAcyclic":23,"./alg/topsort":24}],23:[function(a,b){function c(a){try{d(a)}catch(b){if(b instanceof d.CycleException)return!1;throw b}return!0}var d=a("./topsort");b.exports=c},{"./topsort":24}],24:[function(a,b){function c(a){function b(g){if(g in e)throw new d;g in c||(e[g]=!0,c[g]=!0,a.predecessors(g).forEach(function(a){b(a)}),delete e[g],f.push(g))}var c={},e={},f=[],g=a.sinks();if(0!==a.order()&&0===g.length)throw new d;return a.sinks().forEach(function(a){b(a)}),f}function d(){}b.exports=c,c.CycleException=d,d.prototype.toString=function(){return"Graph has at least one cycle"}},{}],25:[function(a,b,c){c.all=function(a,b){for(var c=0;c<a.length;++c)if(!b(a[c]))return!1;return!0},c.values=function(a){return Object.keys(a).map(function(b){return a[b]})},c.concat=function(a){return Array.prototype.concat.apply([],a)},c.mergeKeys=function(a){var b={};return a.forEach(function(a){a.forEach(function(a){b[a]=a})}),c.values(b)}},{}],26:[function(a,b){b.exports="0.0.3"},{}],27:[function(a,b,c){c.Digraph=a("./lib/Digraph"),c.alg={isAcyclic:a("./lib/alg/isAcyclic"),findCycles:a("./lib/alg/findCycles"),tarjan:a("./lib/alg/tarjan"),topsort:a("./lib/alg/topsort")},c.data={PriorityQueue:a("./lib/data/PriorityQueue")},c.version=a("./lib/version")},{"./lib/Digraph":28,"./lib/alg/findCycles":29,"./lib/alg/isAcyclic":30,"./lib/alg/tarjan":31,"./lib/alg/topsort":32,"./lib/data/PriorityQueue":33,"./lib/version":35}],28:[function(a,b){function c(){this._value=void 0,this._nodes={},this._inEdges={},this._outEdges={},this._edges={},this._nextEdgeId=0}function d(a,b,c){var d=a[b];d||(d=a[b]={count:0,edges:{}}),d.count++,d.edges[c]=!0}function e(a,b,c){var d=a[b];0===--d.count?delete a[b]:delete d.edges[c]}var f=a("./util");b.exports=c,c.prototype.subgraph=function(a){var b=new c,d=this;return a.forEach(function(a){b.addNode(a,d.node(a))}),f.values(this._edges).forEach(function(a){b.hasNode(a.source)&&b.hasNode(a.target)&&b.addEdge(a.id,a.source,a.target,d.edge(a.id))}),b},c.prototype.order=function(){return Object.keys(this._nodes).length},c.prototype.size=function(){return Object.keys(this._edges).length},c.prototype.graph=function(a){return 0===arguments.length?this._value:(this._value=a,void 0)},c.prototype.hasNode=function(a){return a in this._nodes},c.prototype.node=function(a,b){var c=this._strictGetNode(a);return 1===arguments.length?c.value:(c.value=b,void 0)},c.prototype.nodes=function(){var a=[];return this.eachNode(function(b){a.push(b)}),a},c.prototype.eachNode=function(a){for(var b in this._nodes){var c=this._nodes[b];a(c.id,c.value)}},c.prototype.successors=function(a){return this._strictGetNode(a),Object.keys(this._outEdges[a]).map(function(a){return this._nodes[a].id},this)},c.prototype.predecessors=function(a){return this._strictGetNode(a),Object.keys(this._inEdges[a]).map(function(a){return this._nodes[a].id},this)},c.prototype.neighbors=function(a){this._strictGetNode(a);var b={};return Object.keys(this._outEdges[a]).map(function(a){b[a]=!0}),Object.keys(this._inEdges[a]).map(function(a){b[a]=!0}),Object.keys(b).map(function(a){return this._nodes[a].id},this)},c.prototype.sources=function(){var a=this;return this._filterNodes(function(b){return 0===a.inEdges(b).length})},c.prototype.sinks=function(){var a=this;return this._filterNodes(function(b){return 0===a.outEdges(b).length})},c.prototype.hasEdge=function(a){return a in this._edges},c.prototype.edge=function(a,b){var c=this._strictGetEdge(a);return 1===arguments.length?c.value:(c.value=b,void 0)},c.prototype.edges=function(){if(1===arguments.length)throw new Error("Digraph.edges() cannot be called with 1 argument. Use Digraph.incidentEdges() instead.");if(arguments.length>1)throw new Error("Digraph.edges() cannot be called with more than 1 argument. Use Digraph.outEdges() instead.");var a=[];return this.eachEdge(function(b){a.push(b)}),a},c.prototype.eachEdge=function(a){for(var b in this._edges){var c=this._edges[b];a(c.id,c.source,c.target,c.value)}},c.prototype.source=function(a){return this._strictGetEdge(a).source},c.prototype.target=function(a){return this._strictGetEdge(a).target},c.prototype.inEdges=function(a,b){this._strictGetNode(a);var c=f.concat(f.values(this._inEdges[a]).map(function(a){return Object.keys(a.edges)},this));return arguments.length>1&&(this._strictGetNode(b),c=c.filter(function(a){return this.source(a)===b},this)),c},c.prototype.outEdges=function(a,b){this._strictGetNode(a);var c=f.concat(f.values(this._outEdges[a]).map(function(a){return Object.keys(a.edges)},this));return arguments.length>1&&(this._strictGetNode(b),c=c.filter(function(a){return this.target(a)===b},this)),c},c.prototype.incidentEdges=function(a,b){return arguments.length>1?f.mergeKeys([this.outEdges(a,b),this.outEdges(b,a)]):f.mergeKeys([this.inEdges(a),this.outEdges(a)])},c.prototype.equals=function(a){var b=this;return b.order()===a.order()&&b.size()===a.size()&&f.all(b.nodes(),function(c){return a.hasNode(c)&&b.node(c)===a.node(c)})&&f.all(b.edges(),function(c){return a.hasEdge(c)&&b.edge(c)===a.edge(c)})},c.prototype.toString=function(){var a=this,b="GRAPH: "+JSON.stringify(a._value)+"\n";return b+="    Nodes:\n",Object.keys(this._nodes).forEach(function(c){b+="        "+c+": "+JSON.stringify(a._nodes[c].value)+"\n"}),b+="    Edges:\n",Object.keys(this._edges).forEach(function(c){var d=a._edges[c];b+="        "+c+" ("+d.source+" -> "+d.target+"): "+JSON.stringify(a._edges[c].value)+"\n"}),b},c.prototype.addNode=function(a,b){if(this.hasNode(a))throw new Error("Graph already has node '"+a+"':\n"+this.toString());this._nodes[a]={id:a,value:b},this._inEdges[a]={},this._outEdges[a]={}},c.prototype.delNode=function(a){this._strictGetNode(a);var b=this;this.incidentEdges(a).forEach(function(a){b.delEdge(a)}),delete this._inEdges[a],delete this._outEdges[a],delete this._nodes[a]},c.prototype.addEdge=function(a,b,c,e){if(this._strictGetNode(b),this._strictGetNode(c),null===a)a="_ANON-"+ ++this._nextEdgeId;else if(this.hasEdge(a))throw new Error("Graph already has edge '"+a+"':\n"+this.toString());this._edges[a]={id:a,source:b,target:c,value:e},d(this._inEdges[c],b,a),d(this._outEdges[b],c,a)},c.prototype.delEdge=function(a){var b=this._strictGetEdge(a);e(this._inEdges[b.target],b.source,a),e(this._outEdges[b.source],b.target,a),delete this._edges[a]},c.prototype._strictGetNode=function(a){var b=this._nodes[a];if(void 0===b)throw new Error("Node '"+a+"' is not in graph:\n"+this.toString());return b},c.prototype._strictGetEdge=function(a){var b=this._edges[a];if(void 0===b)throw new Error("Edge '"+a+"' is not in graph:\n"+this.toString());return b},c.prototype._filterNodes=function(a){var b=[];return this.eachNode(function(c){a(c)&&b.push(c)}),b}},{"./util":34}],29:[function(a,b){function c(a){return d(a).filter(function(a){return a.length>1})}var d=a("./tarjan");b.exports=c},{"./tarjan":31}],30:[function(a,b){function c(a){try{d(a)}catch(b){if(b instanceof d.CycleException)return!1;throw b}return!0}var d=a("./topsort");b.exports=c},{"./topsort":32}],31:[function(a,b){function c(a){function b(f){var g=e[f]={onStack:!0,lowlink:c,index:c++};if(d.push(f),a.successors(f).forEach(function(a){a in e?e[a].onStack&&(g.lowlink=Math.min(g.lowlink,e[a].index)):(b(a),g.lowlink=Math.min(g.lowlink,e[a].lowlink))}),g.lowlink===g.index){var h,i=[];do h=d.pop(),e[h].onStack=!1,i.push(h);while(f!==h);results.push(i)}}var c=0,d=[],e={};return results=[],a.nodes().forEach(function(a){a in e||b(a)}),results}b.exports=c},{}],32:[function(a,b){function c(a){function b(g){if(g in e)throw new d;g in c||(e[g]=!0,c[g]=!0,a.predecessors(g).forEach(function(a){b(a)}),delete e[g],f.push(g))}var c={},e={},f=[],g=a.sinks();if(0!==a.order()&&0===g.length)throw new d;return a.sinks().forEach(function(a){b(a)}),f}function d(){}b.exports=c,c.CycleException=d,d.prototype.toString=function(){return"Graph has at least one cycle"}},{}],33:[function(a,b){function c(){this._arr=[],this._keyIndices={}}b.exports=c,c.prototype.size=function(){return this._arr.length},c.prototype.keys=function(){return this._arr.map(function(a){return a.key})},c.prototype.has=function(a){return a in this._keyIndices},c.prototype.priority=function(a){var b=this._keyIndices[a];return void 0!==b?this._arr[b].priority:void 0},c.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},c.prototype.add=function(a,b){if(!(a in this._keyIndices)){var c={key:a,priority:b},d=this._arr.length;return this._keyIndices[a]=d,this._arr.push(c),this._decrease(d),!0}return!1},c.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var a=this._arr.pop();return delete this._keyIndices[a.key],this._heapify(0),a.key},c.prototype.decrease=function(a,b){var c=this._keyIndices[a];if(b>this._arr[c].priority)throw new Error("New priority is greater than current priority. Key: "+a+" Old: "+this._arr[c].priority+" New: "+b);this._arr[c].priority=b,this._decrease(c)},c.prototype._heapify=function(a){var b=this._arr,c=2*a,d=c+1,e=a;c<b.length&&(e=b[c].priority<b[e].priority?c:e,d<b.length&&(e=b[d].priority<b[e].priority?d:e),e!==a&&(this._swap(a,e),this._heapify(e)))},c.prototype._decrease=function(a){for(var b,c=this._arr,d=c[a].priority;a>0&&(b=a>>1,!(c[b].priority<d));)this._swap(a,b),a=b},c.prototype._swap=function(a,b){var c=this._arr,d=this._keyIndices,e=c[a];c[a]=c[b],c[b]=e,d[c[a].key]=a,d[c[b].key]=b}},{}],34:[function(a,b,c){c.all=function(a,b){for(var c=0;c<a.length;++c)if(!b(a[c]))return!1;return!0},c.values=function(a){return Object.keys(a).map(function(b){return a[b]})},c.concat=function(a){return Array.prototype.concat.apply([],a)},c.mergeKeys=function(a){var b={};return a.forEach(function(a){a.forEach(function(a){b[a]=a})}),c.values(b)}},{}],35:[function(a,b){b.exports="0.1.0"},{}]},{},[1]),joint.layout.DirectedGraph={layout:function(a,b){b=b||{};var c=this._prepareData(a),d=dagre.layout().nodes(c.nodeData).edges(c.edgeData);b.debugLevel&&d.debugLevel(b.debugLevel),b.rankDir&&d.rankDir(b.rankDir),b.rankSep&&d.rankSep(b.rankSep),b.edgeSep&&d.edgeSep(b.edgeSep),b.nodeSep&&d.nodeSep(b.nodeSep),d.run(),_.each(c.nodeData,function(b){a.get("cells").get(b.id).set("position",{x:b.dagre.x,y:b.dagre.y})}),b.setLinkVertices&&_.each(c.edgeData,function(b){a.get("cells").get(b.id).set("vertices",b.dagre.points)})},_prepareData:function(){var a=[],b=[],c={},d={};return graph.get("cells").each(function(b){if(b instanceof joint.dia.Element&&!c[b.id]){var d={id:b.id,inEdges:[],outEdges:[],width:b.get("size").width,height:b.get("size").height};a.push(d),c[b.id]=d}}),graph.get("cells").each(function(a){if(a instanceof joint.dia.Link){var e,f=a.get("source").id,g=a.get("target").id,h=c[f],i=c[g];d[a.id]?e=d[a.id]:(e={id:a.id,source:h,target:i,label:"fooedge"},d[a.id]=e,b.push(e)),_.contains(h.outEdges,e)||h.outEdges.push(e),_.contains(i.inEdges,e)||i.inEdges.push(e)}}),{nodeData:a,edgeData:b}}};